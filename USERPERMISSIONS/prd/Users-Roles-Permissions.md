# EX Platform - Users, Roles & Permissions PRD

## æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£å®šä¹‰ EX Platform çš„ç”¨æˆ·è§’è‰²æƒé™ç³»ç»Ÿï¼ˆRBACï¼‰ï¼Œæ¶µç›– Identity â†’ User â†’ MID ä¸‰å±‚èº«ä»½æ¨¡å‹ã€MID çº§è§’è‰²ã€ä¸¤å±‚æƒé™æ¨¡å‹ï¼ˆé¡µé¢ + æ“ä½œï¼‰ï¼Œä»¥åŠç”¨æˆ·ç®¡ç†åŠŸèƒ½ã€‚

**æ ¸å¿ƒè®¾è®¡ç†å¿µï¼š**

- âœ… **ä¸‰å±‚èº«ä»½æ¨¡å‹**ï¼šIdentityï¼ˆè‡ªç„¶äºº/å‡­è¯ï¼‰â†’ Userï¼ˆMID å†…èº«ä»½/è§’è‰²ï¼‰â†’ MIDï¼ˆå•†æˆ·ï¼‰
- âœ… **æƒé™ç»™ User**ï¼šè§’è‰²å’Œæƒé™æŒ‚åœ¨ Userï¼ˆUIDï¼‰ä¸Šï¼Œä¸åœ¨ Identityï¼ˆIIDï¼‰ä¸Š
- âœ… **æ‰å¹³ MID ç»“æ„**ï¼šæœ¬æœŸä¸å¼•å…¥ Organisation å±‚
- âœ… **è‡ªå®šä¹‰è§’è‰²**ï¼šæœ¬æœŸåªæ”¯æŒè‡ªå®šä¹‰è§’è‰²ï¼Œä¸æä¾›é¢„è®¾è§’è‰²æ¨¡æ¿
- âœ… **å¤šè§’è‰²æ”¯æŒ**ï¼šä¸€ä¸ª User åœ¨åŒä¸€ä¸ª MID ä¸‹å¯æ‹¥æœ‰å¤šä¸ªè§’è‰²
- âœ… **ä¸¤å±‚æƒé™**ï¼šé¡µé¢æƒé™ï¼ˆæ¨¡å—çº§ï¼‰+ æ“ä½œæƒé™ï¼ˆæŸ¥é˜… / æ“ä½œ / å¯¼å‡ºï¼Œä¸‰é€‰å¤šé€‰ï¼‰
- âœ… **å®‰å…¨éªŒè¯æ–¹å¼**ï¼šäº¤æ˜“æ¨¡å—å¯é…ç½®éªŒè¯æ–¹å¼ï¼ˆSelf è‡ªå·±éªŒè¯ / Designated å‘ç»™æŒ‡å®šæ‰‹æœºå·ï¼‰
- âœ… **ä¸€ä¸ª Identity å¤šä¸ª MID**ï¼šä¸€ä¸ªè‡ªç„¶äººå¯åœ¨å¤šä¸ª MID ä¸‹æ‹¥æœ‰ä¸åŒ Userï¼Œå„è‡ªç‹¬ç«‹è§’è‰²
- âœ… **å¤šç«¯æ³¨å†Œ**ï¼šåŒä¸€æ‰‹æœºå·/é‚®ç®±å¯åˆ†åˆ«æ³¨å†Œ MPï¼ˆå•†æˆ·ç«¯ï¼‰å’Œ TPï¼ˆç§Ÿæˆ·ç«¯ï¼‰ï¼Œå„è‡ªç‹¬ç«‹ Identity

**Phase 2 è§„åˆ’ï¼ˆæœ¬æœŸä¸åšï¼‰ï¼š**

- âŒ Organisation å±‚ï¼ˆOrg â†’ MID ä¸¤å±‚ç»“æ„ï¼‰
- âŒ æ•°æ®æƒé™ï¼ˆèµ„æºå®ä¾‹çº§ï¼Œåœ¨ä¸šåŠ¡å±‚å¤„ç†ï¼‰
- âŒ æ‰‹æœºå·/é‚®ç®±åˆå¹¶ï¼ˆå¤šå‡­è¯åˆå¹¶åˆ°åŒä¸€ Identityï¼‰
- âŒ æ“ä½œæƒé™ç»†åŒ–ï¼ˆCRUD çº§ï¼šCreate/Edit/Delete/Manage ç‹¬ç«‹æ§åˆ¶ï¼‰
- âŒ é¢„è®¾è§’è‰²æ¨¡æ¿
- âŒ Maker-Checker å®¡æ‰¹æµï¼ˆæ“ä½œäººæäº¤ â†’ å®¡æ‰¹äººéªŒè¯ï¼‰

**å…³è”æ–‡æ¡£ï¼š** [Users.md](./Users.md)ï¼ˆç”¨æˆ·ç³»ç»Ÿ PRDï¼‰

---

## ç›®å½•

1. [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#1-ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
2. [Scope ä¸åˆ†æœŸ](#2-scope-ä¸åˆ†æœŸ)
3. [Identity-User-MID å…³ç³»](#3-identity-user-mid-å…³ç³»)
4. [è§’è‰²ä½“ç³»](#4-è§’è‰²ä½“ç³»)
5. [ä¸¤å±‚æƒé™æ¨¡å‹](#5-ä¸¤å±‚æƒé™æ¨¡å‹)
6. [æƒé™é…ç½®æµç¨‹](#6-æƒé™é…ç½®æµç¨‹)
7. [ç”¨æˆ·ç®¡ç†](#7-ç”¨æˆ·ç®¡ç†)
8. [é‰´æƒæµç¨‹](#8-é‰´æƒæµç¨‹)
9. [æ”¯ä»˜å¯†ç ï¼ˆPayment Passwordï¼‰](#9-æ”¯ä»˜å¯†ç payment-password)
10. [çŠ¶æ€æœº](#10-çŠ¶æ€æœº)

---

## 1. ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### 1.1 æ•´ä½“æ¶æ„

```mermaid
graph TB
    subgraph "Identity å±‚ï¼ˆè‡ªç„¶äººï¼‰"
        I[Identity<br/>IID / å‡­è¯ / å¯†ç  / 2FA]
    end

    subgraph "User å±‚ï¼ˆMID å†…èº«ä»½ï¼‰"
        U1[User UID-001<br/>MID-001 / Account Holder]
        U2[User UID-002<br/>MID-002 / Member]
    end

    subgraph "å•†æˆ·å±‚"
        M1[MID-001 ABC Trading]
        M2[MID-002 XYZ Corp]
    end

    subgraph "è§’è‰²å±‚"
        MR1[MID-001 è§’è‰²<br/>ç®¡ç†å‘˜ / äº¤æ˜“å‘˜ / è´¢åŠ¡...]
        MR2[MID-002 è§’è‰²<br/>æŸ¥çœ‹è€…...]
    end

    subgraph "æƒé™å±‚"
        P1[é¡µé¢æƒé™<br/>æ¨¡å—å¯è§æ€§]
        P2[æ“ä½œæƒé™<br/>æŸ¥é˜… / æ“ä½œ / å¯¼å‡ºï¼ˆå¤šé€‰ï¼‰]
    end

    I --> U1
    I --> U2

    U1 --> M1
    U2 --> M2

    U1 -->|æ‹¥æœ‰| MR1
    U2 -->|æ‹¥æœ‰| MR2

    MR1 --> P1
    MR1 --> P2
    MR2 --> P1
    MR2 --> P2
```

### 1.2 Identity-User-MID å…³ç³»æ¨¡å‹

![1770987980814](image/Users-Roles-Permissions/1770987980814.png)

```mermaid
erDiagram
    IDENTITY ||--o{ CREDENTIAL : "æ‹¥æœ‰å‡­è¯"
    IDENTITY ||--o{ USER : "åœ¨MIDä¸­çš„èº«ä»½"
    USER ||--o{ USER_ROLE : "æ‹¥æœ‰è§’è‰²"
    MID ||--o{ USER : "åŒ…å«ç”¨æˆ·"
    MID ||--o{ MID_ROLE : "å®šä¹‰è§’è‰²"
    MID_ROLE ||--o{ USER_ROLE : "è¢«åˆ†é…"
    MID_ROLE ||--o{ ROLE_PERMISSION : "åŒ…å«æƒé™"

    IDENTITY {
        string identity_id PK "IIDï¼Œå…¨å±€å”¯ä¸€"
        string nickname "æ˜µç§°"
        string password_hash "ç™»å½•å¯†ç "
        string totp_secret "2FA å¯†é’¥"
        string status "ACTIVE / SUSPENDED"
    }
    CREDENTIAL {
        string credential_id PK
        string identity_id FK
        string type "email / mobile"
        string value "atest.com / 86138xxxx"
        boolean verified "æ˜¯å¦å·²éªŒè¯"
    }
    USER {
        string user_id PK "UIDï¼ŒMIDå†…å”¯ä¸€"
        string identity_id FK "æ‰€å± Identity"
        string mid_id FK "æ‰€å± MID"
        string role_type "Account Holder / Member"
        string status "ACTIVE / DISABLED"
    }
    MID {
        string mid_id PK
        string mid_name
        string status
    }
    MID_ROLE {
        string role_id PK
        string mid_id FK
        string role_name
        string description
        string status "ACTIVE / DISABLED"
    }
    ROLE_PERMISSION {
        string role_id FK
        string module "æ¨¡å—æ ‡è¯†"
        boolean can_view "æŸ¥é˜…æƒé™"
        boolean can_operate "æ“ä½œæƒé™ï¼ˆå¢åˆ æ”¹ï¼‰"
        boolean can_export "å¯¼å‡ºæƒé™"
        string verification "self / designatedï¼ˆäº¤æ˜“æ¨¡å—ï¼‰"
        string designated_phone "æŒ‡å®šæ‰‹æœºå·ï¼ˆå½“ verification=designatedï¼‰"
    }
```

**ä¸‰å±‚èŒè´£åˆ’åˆ†ï¼š**

| å±‚çº§                    | å®ä½“       | æ ‡è¯† | èŒè´£                                                                                         | çŠ¶æ€                  |
| ----------------------- | ---------- | ---- | -------------------------------------------------------------------------------------------- | --------------------- |
| **Identity å±‚**   | Identity   | IID  | ä»£è¡¨ä¸€ä¸ªè‡ªç„¶äººã€‚æ‹¥æœ‰ï¼šç™»å½•å‡­è¯ï¼ˆé‚®ç®±/æ‰‹æœºå·ï¼‰ã€å¯†ç ã€2FAã€æ˜µç§°ã€è¯­è¨€åå¥½                     | ACTIVE / SUSPENDED    |
| **Credential å±‚** | Credential | â€”   | Identity çš„ç™»å½•å‡­è¯ï¼Œä¸€ä¸ª Identity å¯æœ‰å¤šä¸ªå‡­è¯ï¼ˆå¤šé‚®ç®±/å¤šæ‰‹æœºå·ï¼‰                           | verified / unverified |
| **User å±‚**       | User       | UID  | ä»£è¡¨è¯¥è‡ªç„¶äººåœ¨æŸä¸ª MID ä¸‹çš„æˆå‘˜èº«ä»½ã€‚æ‰¿è½½ï¼šè§’è‰²ã€æƒé™ã€‚ä¸€ä¸ª Identity åŠ å…¥ä¸€ä¸ª MID æ—¶è‡ªåŠ¨ç”Ÿæˆ | ACTIVE / DISABLED     |
| **å•†æˆ·å±‚**        | MID        | MID  | å•†æˆ·/ä¼ä¸š                                                                                    | â€”                    |

**æ ¸å¿ƒå…³ç³»ï¼š**

- Identity : User = **1 : N**ï¼ˆä¸€ä¸ªè‡ªç„¶äººå¯åœ¨å¤šä¸ª MID ä¸‹æœ‰ä¸åŒ Userï¼‰
- User : MID = **N : 1**ï¼ˆæ¯ä¸ª User åªå±äºä¸€ä¸ª MIDï¼‰
- Identity : Credential = **1 : N**ï¼ˆä¸€ä¸ª Identity å¯æœ‰å¤šä¸ªé‚®ç®±/æ‰‹æœºå·ï¼‰
- **æƒé™æŒ‚åœ¨ User ä¸Š**ï¼Œä¸åœ¨ Identity ä¸Šã€‚Identity åªç®¡ç™»å½•å’Œå®‰å…¨è®¾ç½®

### 1.3 å¤šç«¯æ³¨å†Œè¯´æ˜

åŒä¸€æ‰‹æœºå·/é‚®ç®±å¯ä»¥åˆ†åˆ«åœ¨ MPï¼ˆå•†æˆ·ç«¯ï¼‰å’Œ TPï¼ˆç§Ÿæˆ·ç«¯ï¼‰æ³¨å†Œï¼Œå„è‡ªåˆ›å»ºç‹¬ç«‹çš„ Identityï¼š

```
æ‰‹æœºå· +86 138****5678
â”œâ”€â”€ MP æ³¨å†Œ â†’ Identity IID-001 (MP)
â”‚   â””â”€â”€ User UID-001 â†’ MID-001 (ABC Trading) / Account Holder
â”‚
â””â”€â”€ TP æ³¨å†Œ â†’ Identity IID-002 (TP)
    â””â”€â”€ User UID-010 â†’ MID-T01 (Fulunited Limited) / Account Holder
```

- MP å’Œ TP æ˜¯**ç‹¬ç«‹çš„ Identity**ï¼Œå„è‡ªæœ‰ç‹¬ç«‹çš„å¯†ç ã€2FA
- ç™»å½•æ—¶é€‰æ‹©ç«¯ï¼ˆMP / TPï¼‰ï¼Œè¿›å…¥å¯¹åº”çš„ Identity å’Œ User ä½“ç³»
- æœ¬æœŸä¸æ”¯æŒ MP å’Œ TP çš„ Identity åˆå¹¶

---

## 2. Scope ä¸åˆ†æœŸ

### 2.1 æœ¬æœŸ Scope

| ç»´åº¦               | In Scope                                                                           | Out of Scopeï¼ˆPhase 2ï¼‰                         |
| ------------------ | ---------------------------------------------------------------------------------- | ----------------------------------------------- |
| **èº«ä»½æ¨¡å‹** | Identity â†’ User â†’ MID ä¸‰å±‚ï¼›æƒé™æŒ‚åœ¨ Userï¼ˆUIDï¼‰ä¸Š                               | Organisation å±‚ï¼ˆOrg â†’ MIDï¼‰                   |
| **è§’è‰²**     | MID çº§è‡ªå®šä¹‰è§’è‰²ï¼›ä¸€ä¸ª User å¯æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼›ä¸€ä¸ª Identity å¯åœ¨å¤šä¸ª MID æœ‰ä¸åŒ User | é¢„è®¾è§’è‰²æ¨¡æ¿ï¼›è§’è‰²ç»§æ‰¿                          |
| **é¡µé¢æƒé™** | æŒ‰æ¨¡å—æ§åˆ¶å¯è§æ€§                                                                   | æŒ‰å­èœå•/æŒ‰é’®çº§æ§åˆ¶                             |
| **æ“ä½œæƒé™** | ä¸‰é¡¹ç‹¬ç«‹å¤šé€‰ï¼šæŸ¥é˜…ï¼ˆViewï¼‰/ æ“ä½œï¼ˆOperateï¼‰/ å¯¼å‡ºï¼ˆExportï¼‰                        | ç»†ç²’åº¦ CRUDï¼ˆCreate/Edit/Delete/Manage ç‹¬ç«‹æ§åˆ¶ï¼‰ |
| **å®‰å…¨éªŒè¯** | äº¤æ˜“æ¨¡å—å¯é…ç½®éªŒè¯æ–¹å¼ï¼šSelfï¼ˆè‡ªå·±éªŒè¯ï¼‰/ Designatedï¼ˆå‘ç»™æŒ‡å®šæ‰‹æœºå·ï¼‰              | Maker-Checker å®¡æ‰¹æµ                              |
| **æ•°æ®æƒé™** | â€”ï¼ˆåœ¨ä¸šåŠ¡å±‚å¤„ç†ï¼‰                                                                 | èµ„æºå®ä¾‹çº§ï¼ˆALL/OWN/ASSIGNEDï¼‰ï¼›Location æƒé™     |
| **ç”¨æˆ·ç®¡ç†** | é‚€è¯·ç”¨æˆ·ï¼ˆIdentityï¼‰ã€åˆ†é…è§’è‰²ï¼ˆUserï¼‰ã€çŠ¶æ€ç®¡ç†                                   | Department / Manager å­—æ®µï¼›HRIS é›†æˆ              |
| **è´¦å·åˆå¹¶** | â€”                                                                                 | æ‰‹æœºå·/é‚®ç®±åˆå¹¶ï¼ˆå¤šå‡­è¯åˆå¹¶åˆ°åŒä¸€ Identityï¼‰    |
| **å·¥ä½œå°**   | æ ¹æ®æƒé™åŠ¨æ€ç”Ÿæˆ                                                                   | â€”                                              |

### 2.2 åˆ†æœŸè§„åˆ’

```
Phase 1ï¼ˆæœ¬æœŸï¼‰ï¼š
â”œâ”€â”€ Identity â†’ User â†’ MID ä¸‰å±‚èº«ä»½æ¨¡å‹
â”œâ”€â”€ MID çº§è‡ªå®šä¹‰è§’è‰²ï¼ˆæƒé™ç»™ Userï¼‰
â”œâ”€â”€ ä¸¤å±‚æƒé™ï¼šé¡µé¢ï¼ˆæ¨¡å—çº§ï¼‰+ æ“ä½œï¼ˆæŸ¥é˜…/æ“ä½œ/å¯¼å‡ºï¼Œä¸‰é€‰å¤šé€‰ï¼‰
â”œâ”€â”€ å®‰å…¨éªŒè¯æ–¹å¼ï¼šäº¤æ˜“æ¨¡å—å¯é…ç½® Self / Designatedï¼ˆæŒ‡å®šæ‰‹æœºå·ï¼‰
â”œâ”€â”€ ç”¨æˆ·ç®¡ç†ï¼šé‚€è¯·ã€çŠ¶æ€ã€è§’è‰²åˆ†é…
â”œâ”€â”€ æ”¯ä»˜å¯†ç ï¼ˆæŒ‰ User + MID ç»´åº¦ï¼‰
â””â”€â”€ å·¥ä½œå°æ ¹æ®æƒé™åŠ¨æ€ç”Ÿæˆ

Phase 2ï¼ˆåæœŸï¼‰ï¼š
â”œâ”€â”€ Organisation å±‚ï¼ˆOrg â†’ MID ä¸¤å±‚ç»“æ„ï¼‰
â”œâ”€â”€ æ•°æ®æƒé™ï¼ˆALL / OWN / ASSIGNEDï¼‰
â”œâ”€â”€ æ“ä½œæƒé™ç»†åŒ–ï¼šæ“ä½œ â†’ Create/Edit/Delete/Manage ç‹¬ç«‹æ§åˆ¶
â”œâ”€â”€ æ‰‹æœºå·/é‚®ç®±åˆå¹¶ï¼ˆå¤šå‡­è¯åˆå¹¶åˆ°åŒä¸€ Identityï¼‰
â”œâ”€â”€ é¢„è®¾è§’è‰²æ¨¡æ¿
â”œâ”€â”€ Maker-Checker å®¡æ‰¹æµï¼ˆæ“ä½œäººæäº¤ â†’ å®¡æ‰¹äººéªŒè¯ï¼‰
â””â”€â”€ Department / Manager ç­‰ç»„ç»‡å­—æ®µ
```

---

## 3. Identity-User-MID å…³ç³»

### 3.1 ç»“æ„è¯´æ˜

é‡‡ç”¨ä¸‰å±‚èº«ä»½æ¨¡å‹ï¼Œæ—  Organisation å±‚ï¼š

```
Identityï¼ˆè‡ªç„¶äººï¼‰
â”œâ”€â”€ æ‹¥æœ‰å‡­è¯ï¼šemail atest.com, mobile 86138xxxx
â”œâ”€â”€ æ‹¥æœ‰å®‰å…¨è®¾ç½®ï¼šå¯†ç ã€2FA
â”‚
â”œâ”€â”€ User UID-001 â†’ MID-001 (ABC Trading) / Account Holder
â”‚   â””â”€â”€ è§’è‰²: ç®¡ç†å‘˜ï¼ˆæ‰€æœ‰æ¨¡å—å¯æ“ä½œï¼‰
â”‚
â””â”€â”€ User UID-002 â†’ MID-002 (XYZ Corp) / Member
    â””â”€â”€ è§’è‰²: æŸ¥çœ‹è€…ï¼ˆæ‰€æœ‰æ¨¡å—ä»…æŸ¥é˜…ï¼‰
```

```mermaid
graph LR
    subgraph "Identity: å¼ ä¸‰ (IID-001)"
        I1["zhang@test.com<br/>+86 138****5678"]
    end

    subgraph "MID-001: ABC Trading"
        U1["User UID-001 / Account Holder<br/>è§’è‰²: ç®¡ç†å‘˜ âœ… å¯æ“ä½œ"]
    end

    subgraph "MID-002: XYZ Corp"
        U2["User UID-002 / Member<br/>è§’è‰²: æŸ¥çœ‹è€… ğŸ‘ ä»…æŸ¥é˜…"]
    end

    I1 --> U1
    I1 --> U2
```

**å…³é”®åŒºåˆ«ï¼š**

| æ“ä½œ                          | åœ¨å“ªä¸€å±‚              | è¯´æ˜                                                            |
| ----------------------------- | --------------------- | --------------------------------------------------------------- |
| ç™»å½•ã€ä¿®æ”¹å¯†ç ã€ä¿®æ”¹å‡­è¯ã€2FA | **Identity å±‚** | éªŒè¯ç å‘åˆ° Identity è‡ªå·±çš„å‡­è¯                                  |
| æŸ¥çœ‹æ¨¡å—ã€æ‰§è¡Œæ“ä½œã€ç®¡ç†ç”¨æˆ·  | **User å±‚**     | ç”± User åœ¨è¯¥ MID ä¸‹çš„è§’è‰²å†³å®š                                   |
| å†»ç»“/è§£å†»æˆå‘˜                 | **User å±‚**     | Account Holder å¯ç¦ç”¨æŸä¸ª Userï¼ˆUIDï¼‰ï¼Œä¸å½±å“ Identity å…¨å±€çŠ¶æ€ |
| å°ç¦è‡ªç„¶äºº                    | **Identity å±‚** | å¹³å°çº§æ“ä½œï¼ŒIdentity è¢« SUSPENDED åæ‰€æœ‰ User å‡ä¸å¯ç”¨          |

### 3.2 Account Holderï¼ˆå¼€æˆ·äººï¼‰

æ¯ä¸ª MID æ³¨å†Œæ—¶ï¼Œæ³¨å†Œäººçš„ User è‡ªåŠ¨æ ‡è®°ä¸º **Account Holder**ï¼ˆrole_type = Account Holderï¼‰ã€‚Account Holder æ˜¯ User ä¸Šçš„ç‰¹æ®Šèº«ä»½æ ‡è®°ï¼Œæ‹¥æœ‰ä»¥ä¸‹å›ºæœ‰æƒé™ï¼š

| èƒ½åŠ›                   | è¯´æ˜                                            |
| ---------------------- | ----------------------------------------------- |
| **æ‰€æœ‰æ¨¡å—è®¿é—®** | å¯è§æ‰€æœ‰æ¨¡å—ï¼Œå¯æ“ä½œ                            |
| **ç”¨æˆ·ç®¡ç†**     | é‚€è¯·/ç§»é™¤ç”¨æˆ·ã€åˆ†é…è§’è‰²                         |
| **è§’è‰²ç®¡ç†**     | åˆ›å»º/ç¼–è¾‘/åˆ é™¤è§’è‰²                              |
| **MID è®¾ç½®**     | ä¼ä¸šä¿¡æ¯ã€é€šçŸ¥ã€ç³»ç»Ÿé…ç½®                        |
| **ä¸å¯ç§»é™¤**     | Account Holder ä¸èƒ½è¢«å…¶ä»–äººç§»é™¤æˆ–é™çº§           |
| **å¯è½¬è®©**       | Account Holder å¯å°†è¯¥èº«ä»½è½¬è®©ç»™ MID å†…å…¶ä»– User |

> Account Holder ä¹‹å¤–çš„æ‰€æœ‰ Userï¼Œæƒé™å®Œå…¨ç”±è§’è‰²å†³å®šã€‚

### 3.3 ä¸€ä¸ª Identity å¤šä¸ª MID

ä¸€ä¸ªè‡ªç„¶äººï¼ˆIdentityï¼‰åŠ å…¥å¤šä¸ª MID æ—¶ï¼Œç³»ç»Ÿä¸ºæ¯ä¸ª MID è‡ªåŠ¨ç”Ÿæˆç‹¬ç«‹çš„ Userï¼ˆUIDï¼‰ï¼š

```
Identity å¼ ä¸‰ (IID-001, zhang@test.com)
â”œâ”€â”€ User UID-001 â†’ MID-001: ABC Trading
â”‚   â”œâ”€â”€ role_type: Account Holder
â”‚   â”œâ”€â”€ è§’è‰²: ç®¡ç†å‘˜ï¼ˆæ‰€æœ‰æ¨¡å—å¯æ“ä½œï¼‰
â”‚   â””â”€â”€ è§’è‰²: è´¢åŠ¡ï¼ˆAssets + Transfer Out å¯æ“ä½œï¼‰
â”‚
â””â”€â”€ User UID-002 â†’ MID-002: XYZ Corp
    â”œâ”€â”€ role_type: Member
    â””â”€â”€ è§’è‰²: æŸ¥çœ‹è€…ï¼ˆæ‰€æœ‰æ¨¡å—ä»…æŸ¥é˜…ï¼‰

â†’ ç™»å½•åï¼ˆIdentity çº§ï¼‰ï¼Œé€‰æ‹© MIDï¼Œåˆ‡æ¢åˆ°å¯¹åº” User
â†’ æƒé™æŒ‰å½“å‰ User åœ¨è¯¥ MID ä¸‹çš„è§’è‰²è®¡ç®—
â†’ å¤šè§’è‰²æƒé™åˆå¹¶ï¼šå–å¹¶é›†ï¼ˆUnionï¼‰
```

### 3.4 å¤šä¸ª Identity åœ¨åŒä¸€ MID

ä¸åŒè‡ªç„¶äººåŠ å…¥åŒä¸€ä¸ª MIDï¼Œå„è‡ªæ‹¥æœ‰ç‹¬ç«‹çš„ Userï¼š

```
MID-001: ABC Trading
â”œâ”€â”€ User UID-001 (Identity A å¼ ä¸‰) / Account Holder
â”œâ”€â”€ User UID-003 (Identity B æå››) / Member â†’ è§’è‰²: Admin
â””â”€â”€ User UID-005 (Identity C ç‹äº”) / Member â†’ è§’è‰²: æŸ¥çœ‹è€…
```

> **çº¦æŸï¼š** ä¸€ä¸ª Identity åœ¨åŒä¸€ä¸ª MID ä¸‹åªèƒ½æœ‰ä¸€ä¸ª Userï¼ˆ1:1 per MIDï¼‰ã€‚

---

## 4. è§’è‰²ä½“ç³»ï¼ˆMP ç«¯ï¼‰

> æœ¬ç« èŠ‚å…ˆå®šä¹‰ MPï¼ˆå•†æˆ·ç«¯ï¼‰çš„è§’è‰²å’Œæƒé™ã€‚TP ç«¯è§’è‰²åç»­è¡¥å……ã€‚

### 4.1 è§’è‰²åˆ†ç±»

| åˆ†ç±»                       | è¯´æ˜                                | æœ¬æœŸæ”¯æŒ   |
| -------------------------- | ----------------------------------- | ---------- |
| **Account Holder**   | MID æ³¨å†Œæ—¶è‡ªåŠ¨åˆ›å»ºï¼Œå›ºæœ‰å…¨éƒ¨æƒé™    | âœ…ï¼ˆå›ºæœ‰ï¼‰ |
| **MID çº§è‡ªå®šä¹‰è§’è‰²** | åœ¨ MID ä¸‹åˆ›å»ºï¼Œæ§åˆ¶é¡µé¢ + æ“ä½œæƒé™  | âœ…         |
| **é¢„è®¾è§’è‰²æ¨¡æ¿**     | ç³»ç»Ÿé¢„è®¾çš„è§’è‰²ï¼ˆå¦‚ Admin / Viewerï¼‰ | âŒ Phase 2 |

### 4.2 è§’è‰²å±æ€§

| å±æ€§                  | è¯´æ˜                       |
| --------------------- | -------------------------- |
| **role_id**     | å”¯ä¸€æ ‡è¯†                   |
| **mid_id**      | æ‰€å± MID                   |
| **role_name**   | è§’è‰²åç§°ï¼ˆå¦‚"äº¤æ˜“ç®¡ç†å‘˜"ï¼‰ |
| **description** | è§’è‰²æè¿°ï¼ˆå¯é€‰ï¼‰           |
| **permissions** | è¯¥è§’è‰²æ‹¥æœ‰çš„æƒé™åˆ—è¡¨       |
| **created_by**  | åˆ›å»ºäºº                     |
| **created_at**  | åˆ›å»ºæ—¶é—´                   |
| **status**      | Active / Disabled          |

### 4.3 åˆ›å»ºè‡ªå®šä¹‰è§’è‰²æµç¨‹

```mermaid
flowchart TD
    A[Account Holder æˆ–æœ‰è§’è‰²ç®¡ç†æƒé™çš„ç”¨æˆ·<br/>è¿›å…¥ Settings â†’ Roles & Permissions] --> B[ç‚¹å‡» åˆ›å»ºè§’è‰²]

    B --> C[Step 1: è§’è‰²è¯¦æƒ…]
    C --> C1[è¾“å…¥è§’è‰²åç§°<br/>å¦‚: äº¤æ˜“ç®¡ç†å‘˜]
    C1 --> C2[è¾“å…¥è§’è‰²æè¿°<br/>å¯é€‰]

    C2 --> D[Step 2: é…ç½®æƒé™]
    D --> D1["é€‰æ‹©å¯è®¿é—®çš„æ¨¡å—ï¼ˆé¡µé¢æƒé™ï¼‰"]
    D1 --> D2["å¯¹æ¯ä¸ªå·²é€‰æ¨¡å—å‹¾é€‰æ“ä½œæƒé™<br/>â˜‘ æŸ¥é˜… â˜‘ æ“ä½œ â˜‘ å¯¼å‡ºï¼ˆä¸‰é€‰å¤šé€‰ï¼‰"]
    D2 --> D3{"è¯¥æ¨¡å—æ˜¯å¦ä¸ºäº¤æ˜“æ¨¡å—ï¼Ÿ<br/>ï¼ˆæ¶‰åŠèµ„é‡‘æ“ä½œï¼‰"}
    D3 -->|æ˜¯| D4["é…ç½®å®‰å…¨éªŒè¯æ–¹å¼<br/>Selfï¼ˆè‡ªå·±éªŒè¯ï¼‰/ Designatedï¼ˆæŒ‡å®šæ‰‹æœºå·ï¼‰"]
    D3 -->|å¦| E
    D4 --> E[ä¿å­˜è§’è‰²]
```

---

## 5. ä¸¤å±‚æƒé™æ¨¡å‹ï¼ˆMP ç«¯ï¼‰

### 5.1 æƒé™å±‚æ¬¡

```mermaid
graph TD
    subgraph "Layer 1: é¡µé¢æƒé™ï¼ˆæ¨¡å—çº§ï¼‰"
        P1["User èƒ½çœ‹åˆ°å“ªäº›æ¨¡å—ï¼Ÿ"]
        P1a["Assets âœ…"]
        P1b["Transfer In âœ…"]
        P1c["Transfer Out âŒ"]
        P1d["Cards âŒ"]
    end

    subgraph "Layer 2: æ“ä½œæƒé™ï¼ˆä¸‰é€‰å¤šé€‰ï¼‰"
        P2["åœ¨å¯è§æ¨¡å—å†…èƒ½åšä»€ä¹ˆï¼Ÿ"]
        P2a["Assets â†’ â˜‘æŸ¥é˜… â˜‘æ“ä½œ â˜‘å¯¼å‡º"]
        P2b["Transfer In â†’ â˜‘æŸ¥é˜… â˜æ“ä½œ â˜å¯¼å‡º"]
    end

    subgraph "å®‰å…¨éªŒè¯ï¼ˆäº¤æ˜“æ¨¡å—ï¼‰"
        V1["æœ‰æ“ä½œæƒé™çš„äº¤æ˜“æ¨¡å—"]
        V1a["Assets â†’ Selfï¼ˆè‡ªå·±éªŒè¯ï¼‰"]
        V1b["Transfer Out â†’ Designatedï¼ˆ+86 138xxxxï¼‰"]
    end

    P1 --> P2
    P2 --> V1
```

> **æ•°æ®æƒé™** ä¸åœ¨ RBAC å±‚å¤„ç†ï¼Œç”±å„ä¸šåŠ¡æ¨¡å—åœ¨ä¸šåŠ¡é€»è¾‘å±‚è‡ªè¡Œå®ç°ï¼ˆå¦‚æŒ‰åˆ›å»ºäººè¿‡æ»¤ã€æŒ‰åˆ†é…çš„èµ„æºè¿‡æ»¤ç­‰ï¼‰ã€‚

### 5.2 Layer 1: é¡µé¢æƒé™ â€” MP ç«¯æ¨¡å—æ¸…å•

æ§åˆ¶ User èƒ½çœ‹åˆ°å“ªäº›æ¨¡å—ã€‚ä¸å¯è§çš„æ¨¡å—åœ¨å·¦ä¾§å¯¼èˆªèœå•ä¸­éšè—ã€‚

**æƒé™ç²’åº¦ï¼šèœå•åˆ†ç»„çº§**ï¼ˆä¸ç»†åˆ°å­èœå•é¡µé¢ï¼‰

> **Dashboard** æ‰€æœ‰äººéƒ½æœ‰ï¼Œä¸å—æƒé™æ§åˆ¶ï¼Œä½†å†…å®¹æ ¹æ®æƒé™åŠ¨æ€ç”Ÿæˆã€‚

| # | æ¨¡å—åˆ†ç»„                  | åŒ…å«å­èœå•                                            | è¯´æ˜                                                                                              | æƒé™æ ‡è¯†         |
| - | ------------------------- | ----------------------------------------------------- | ------------------------------------------------------------------------------------------------- | ---------------- |
| 1 | **Assets**          | Fiat Accounts / Crypto Wallet / Exchange              | è‡ªæœ‰èµ„äº§ç®¡ç†ï¼šä½™é¢æŸ¥çœ‹ã€åŒåå……æã€æ¢æ±‡ï¼ˆFXï¼‰ã€æ³•è½¬æ•°ï¼ˆOn-Rampï¼‰ã€æ•°è½¬æ³•ï¼ˆOff-Rampï¼‰               | `assets`       |
| 2 | **Transfer In**     | Collection Tools / Remitter / Payins / Onramp         | è½¬è´¦æ”¶æ¬¾ï¼šæ”¶æ¬¾å·¥å…·ç®¡ç†ï¼ˆGlobal Account/VA + åŠ å¯†åœ°å€ï¼‰ã€æ±‡æ¬¾äººç»´æŠ¤ã€æ‰€æœ‰å…¥é‡‘è®°å½•ã€æ³•å¸æ”¶æ¬¾è‡ªåŠ¨æ¢U | `transfer_in`  |
| 3 | **Checkout**        | Online Payment / Invoice / Subscription               | æ”¶å•ï¼šåœ¨çº¿æ”¯ä»˜è®¢å•ã€è´¦å•æ”¯ä»˜ã€è®¢é˜…æ”¯ä»˜                                                            | `checkout`     |
| 4 | **Transfer Out**    | Beneficiary / Payouts / OffRamp / Remittance Orders   | è½¬è´¦ä»˜æ¬¾ï¼šæ”¶æ¬¾äººç®¡ç†ã€æ‰€æœ‰å‡ºé‡‘ï¼ˆæ³•å¸+é“¾ä¸Š+åŒåæç°æå¸ï¼‰ã€æ•°å¸â†’æ³•å¸ç›´ä»˜ã€æ”¶â†’æ¢â†’ä»˜ä¸€å•åˆ°åº•      | `transfer_out` |
| 5 | **Cards**           | Cards Management / Card Transactions                  | å‘å¡ï¼šå¼€å¡ã€å……å€¼ã€å†»ç»“ã€æ³¨é”€ã€å¡äº¤æ˜“è®°å½•                                                          | `cards`        |
| 6 | **Trade Documents** | Trade Documents / Order Files / Shop Management       | è´¸æ˜“å•æ®ï¼šå‘ç¥¨/åˆåŒ/æå•ç®¡ç†ã€è®¢å•æ–‡ä»¶ã€ç”µå•†åº—é“ºç»‘å®š                                              | `trade_docs`   |
| 7 | **Reports**         | Reports / Downloads                                   | æŠ¥è¡¨ä¸ä¸‹è½½ä¸­å¿ƒ                                                                                    | `reports`      |
| 8 | **Developer**       | API Keys / Webhooks                                   | å¼€å‘è€…ï¼šAPIå¯†é’¥ç®¡ç†ã€Webhooké…ç½®                                                                  | `developer`    |
| 9 | **Settings**        | Company Profile / Roles & Permissions / Notifications | è®¾ç½®ï¼šä¼ä¸šä¿¡æ¯ã€è§’è‰²æƒé™ç®¡ç†ã€é€šçŸ¥é…ç½®                                                            | `settings`     |

### 5.3 Layer 2: æ“ä½œæƒé™ï¼ˆä¸¤çº§ï¼‰

åœ¨å¯è§æ¨¡å—å†…ï¼Œæ§åˆ¶ User èƒ½æ‰§è¡Œçš„æ“ä½œèŒƒå›´ã€‚

| æ“ä½œçº§åˆ«                      | æ ‡è¯†          | è¯´æ˜                                                              |
| ----------------------------- | ------------- | ----------------------------------------------------------------- |
| **ä»…æŸ¥é˜…ï¼ˆView Onlyï¼‰** | `view_only` | åªèƒ½æŸ¥çœ‹åˆ—è¡¨ã€è¯¦æƒ…ã€æŠ¥è¡¨ã€‚æ‰€æœ‰åˆ›å»º/ç¼–è¾‘/åˆ é™¤/å®¡æ‰¹æŒ‰é’®å‡éšè—æˆ–ç½®ç° |
| **å¯æ“ä½œï¼ˆOperableï¼‰**  | `operable`  | å¯æ‰§è¡Œè¯¥æ¨¡å—å†…çš„æ‰€æœ‰æ“ä½œï¼ˆåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€å¯¼å‡ºç­‰ï¼‰              |

**å…·ä½“åŒºåˆ«ï¼š**

| èƒ½åŠ›      | ä»…æŸ¥é˜… | å¯æ“ä½œ |
| --------- | ------ | ------ |
| æŸ¥çœ‹åˆ—è¡¨  | âœ…     | âœ…     |
| æŸ¥çœ‹è¯¦æƒ…  | âœ…     | âœ…     |
| å¯¼å‡ºæ•°æ®  | âŒ     | âœ…     |
| åˆ›å»º/å‘èµ· | âŒ     | âœ…     |
| ç¼–è¾‘/ä¿®æ”¹ | âŒ     | âœ…     |
| åˆ é™¤/ä½œåºŸ | âŒ     | âœ…     |

**æƒé™æ ‡è¯†æ ¼å¼ï¼š** `{module}:{op_level}`

```
ç¤ºä¾‹:
assets:operable          â€” Assetsï¼Œå¯æ“ä½œ
transfer_in:view_only    â€” Transfer Inï¼Œä»…æŸ¥é˜…
transfer_out:operable    â€” Transfer Outï¼Œå¯æ“ä½œ
settings:operable        â€” Settingsï¼ˆå«è§’è‰²ç®¡ç†ï¼‰ï¼Œå¯æ“ä½œ
```

> **Phase 2 å‘åå…¼å®¹ï¼š** `operable` å°†æ‹†åˆ†ä¸º `create` / `edit` / `delete` / `manage` / `export`ã€‚

### 5.4 MP è§’è‰²é…ç½®ç¤ºä¾‹

#### è§’è‰² 1: è´¢åŠ¡ä¸»ç®¡

è´Ÿè´£èµ„é‡‘ç®¡ç†å’Œå‡ºå…¥é‡‘æ“ä½œï¼Œå¯æŸ¥çœ‹æŠ¥è¡¨ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¨¡å—               â”‚ æ“ä½œçº§åˆ«          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Assets             â”‚ âœ… å¯æ“ä½œ        â”‚  â† å……å€¼/æç°/æ¢æ±‡
â”‚ Transfer In        â”‚ âœ… å¯æ“ä½œ        â”‚  â† ç®¡ç†æ”¶æ¬¾å·¥å…·ã€æŸ¥çœ‹å…¥é‡‘
â”‚ Checkout           â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚  â† åªçœ‹æ”¶å•è®¢å•
â”‚ Transfer Out       â”‚ âœ… å¯æ“ä½œ        â”‚  â† å‘èµ·ä»˜æ¬¾/æ±‡æ¬¾
â”‚ Cards              â”‚ âŒ               â”‚
â”‚ Trade Documents    â”‚ âŒ               â”‚
â”‚ Reports            â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚  â† æŸ¥çœ‹æŠ¥è¡¨ï¼Œä¸å¯å¯¼å‡º
â”‚ Developer          â”‚ âŒ               â”‚
â”‚ Settings           â”‚ âŒ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è§’è‰² 2: è¿è¥ä¸“å‘˜

è´Ÿè´£æ”¶æ¬¾å’Œæ”¶å•ä¸šåŠ¡ï¼Œç®¡ç†è´¸æ˜“å•æ®ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¨¡å—               â”‚ æ“ä½œçº§åˆ«          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Assets             â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚  â† åªçœ‹ä½™é¢
â”‚ Transfer In        â”‚ âœ… å¯æ“ä½œ        â”‚  â† ç®¡ç†æ”¶æ¬¾å·¥å…·ã€æ±‡æ¬¾äºº
â”‚ Checkout           â”‚ âœ… å¯æ“ä½œ        â”‚  â† ç®¡ç†æ”¶å•è®¢å•
â”‚ Transfer Out       â”‚ âŒ               â”‚
â”‚ Cards              â”‚ âŒ               â”‚
â”‚ Trade Documents    â”‚ âœ… å¯æ“ä½œ        â”‚  â† ç®¡ç†è´¸æ˜“å•æ®/åº—é“º
â”‚ Reports            â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚
â”‚ Developer          â”‚ âŒ               â”‚
â”‚ Settings           â”‚ âŒ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è§’è‰² 3: å¡ä¸šåŠ¡ç®¡ç†å‘˜

ä¸“é—¨è´Ÿè´£å‘å¡å’Œå¡äº¤æ˜“ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¨¡å—               â”‚ æ“ä½œçº§åˆ«          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Assets             â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚  â† æŸ¥çœ‹ä½™é¢ï¼ˆå¡å……å€¼éœ€è¦ï¼‰
â”‚ Transfer In        â”‚ âŒ               â”‚
â”‚ Checkout           â”‚ âŒ               â”‚
â”‚ Transfer Out       â”‚ âŒ               â”‚
â”‚ Cards              â”‚ âœ… å¯æ“ä½œ        â”‚  â† å¼€å¡/å……å€¼/å†»ç»“/æ³¨é”€
â”‚ Trade Documents    â”‚ âŒ               â”‚
â”‚ Reports            â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚
â”‚ Developer          â”‚ âŒ               â”‚
â”‚ Settings           â”‚ âŒ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è§’è‰² 4: æŠ€æœ¯å¯¹æ¥

è´Ÿè´£ API é›†æˆå’Œ Webhook é…ç½®ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¨¡å—               â”‚ æ“ä½œçº§åˆ«          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Assets             â”‚ âŒ               â”‚
â”‚ Transfer In        â”‚ âŒ               â”‚
â”‚ Checkout           â”‚ âŒ               â”‚
â”‚ Transfer Out       â”‚ âŒ               â”‚
â”‚ Cards              â”‚ âŒ               â”‚
â”‚ Trade Documents    â”‚ âŒ               â”‚
â”‚ Reports            â”‚ âŒ               â”‚
â”‚ Developer          â”‚ âœ… å¯æ“ä½œ        â”‚  â† API Keys / Webhooks
â”‚ Settings           â”‚ âŒ               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### è§’è‰² 5: å…¨å±€æŸ¥çœ‹è€…

åªè¯»æƒé™ï¼ŒæŸ¥çœ‹æ‰€æœ‰æ¨¡å—ä½†ä¸èƒ½æ“ä½œã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¨¡å—               â”‚ æ“ä½œçº§åˆ«          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Assets             â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚
â”‚ Transfer In        â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚
â”‚ Checkout           â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚
â”‚ Transfer Out       â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚
â”‚ Cards              â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚
â”‚ Trade Documents    â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚
â”‚ Reports            â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚
â”‚ Developer          â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚
â”‚ Settings           â”‚ ğŸ‘ ä»…æŸ¥é˜…        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.5 Account Holder æƒé™ï¼ˆå›ºæœ‰ï¼‰

Account Holder ä¸é€šè¿‡è§’è‰²é…ç½®æƒé™ï¼Œå›ºæœ‰å…¨éƒ¨æ¨¡å—çš„å¯æ“ä½œæƒé™ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ¨¡å—               â”‚ æ“ä½œçº§åˆ«          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Assets             â”‚ âœ… å¯æ“ä½œ        â”‚
â”‚ Transfer In        â”‚ âœ… å¯æ“ä½œ        â”‚
â”‚ Checkout           â”‚ âœ… å¯æ“ä½œ        â”‚
â”‚ Transfer Out       â”‚ âœ… å¯æ“ä½œ        â”‚
â”‚ Cards              â”‚ âœ… å¯æ“ä½œ        â”‚
â”‚ Trade Documents    â”‚ âœ… å¯æ“ä½œ        â”‚
â”‚ Reports            â”‚ âœ… å¯æ“ä½œ        â”‚
â”‚ Developer          â”‚ âœ… å¯æ“ä½œ        â”‚
â”‚ Settings           â”‚ âœ… å¯æ“ä½œ        â”‚  â† å«è§’è‰²ç®¡ç†ã€ç”¨æˆ·ç®¡ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

+ å›ºæœ‰èƒ½åŠ›ï¼šé‚€è¯·/ç§»é™¤ç”¨æˆ·ã€åˆ›å»º/åˆ é™¤è§’è‰²ã€è½¬è®© Account Holder
```

### 5.6 å¤šè§’è‰²æƒé™åˆå¹¶

ä¸€ä¸ª User åœ¨åŒä¸€ä¸ª MID ä¸‹å¯æ‹¥æœ‰å¤šä¸ªè§’è‰²ï¼Œæƒé™åˆå¹¶è§„åˆ™ï¼š

```
æœ€ç»ˆæƒé™ = è§’è‰²1æƒé™ âˆª è§’è‰²2æƒé™ âˆª ...
```

| åœºæ™¯     | è§„åˆ™                                                    |
| -------- | ------------------------------------------------------- |
| é¡µé¢æƒé™ | å¹¶é›†ï¼šä»»ä¸€è§’è‰²æœ‰è¯¥æ¨¡å—æƒé™å³å¯è§                        |
| æ“ä½œæƒé™ | å–æœ€é«˜çº§åˆ«ï¼šå¯æ“ä½œ > ä»…æŸ¥é˜…ï¼ˆä»»ä¸€è§’è‰²ä¸º"å¯æ“ä½œ"å³ç”Ÿæ•ˆï¼‰ |

**ç¤ºä¾‹ï¼š**

```
User å¼ ä¸‰ åœ¨ MID-001 ä¸‹åŒæ—¶æ‹¥æœ‰"è´¢åŠ¡ä¸»ç®¡"å’Œ"è¿è¥ä¸“å‘˜"ä¸¤ä¸ªè§’è‰²ï¼š

è´¢åŠ¡ä¸»ç®¡:  Assets âœ…å¯æ“ä½œ, Transfer In âœ…å¯æ“ä½œ, Checkout ğŸ‘ä»…æŸ¥é˜…, Transfer Out âœ…å¯æ“ä½œ, Reports ğŸ‘ä»…æŸ¥é˜…
è¿è¥ä¸“å‘˜:  Assets ğŸ‘ä»…æŸ¥é˜…, Transfer In âœ…å¯æ“ä½œ, Checkout âœ…å¯æ“ä½œ, Trade Docs âœ…å¯æ“ä½œ, Reports ğŸ‘ä»…æŸ¥é˜…

åˆå¹¶åå¼ ä¸‰çš„æƒé™:
  Assets        â†’ âœ… å¯æ“ä½œï¼ˆå–æœ€é«˜ï¼‰
  Transfer In   â†’ âœ… å¯æ“ä½œ
  Checkout      â†’ âœ… å¯æ“ä½œï¼ˆå–æœ€é«˜ï¼‰
  Transfer Out  â†’ âœ… å¯æ“ä½œ
  Cards         â†’ âŒ
  Trade Docs    â†’ âœ… å¯æ“ä½œ
  Reports       â†’ ğŸ‘ ä»…æŸ¥é˜…
  Developer     â†’ âŒ
  Settings      â†’ âŒ
```

---

## 6. æƒé™é…ç½®æµç¨‹

### 6.1 åˆ›å»ºè§’è‰²

```mermaid
flowchart TD
    A[Account Holder æˆ–æœ‰æƒé™çš„ç”¨æˆ·<br/>è¿›å…¥ Settings â†’ è§’è‰²ç®¡ç†] --> B[ç‚¹å‡» åˆ›å»ºè§’è‰²]

    B --> C[Step 1: è§’è‰²è¯¦æƒ…]
    C --> C1[è¾“å…¥è§’è‰²åç§°]
    C1 --> C2[è¾“å…¥è§’è‰²æè¿°<br/>å¯é€‰]

    C2 --> D[Step 2: é…ç½®æƒé™]
    D --> D1["é€‰æ‹©å¯è®¿é—®çš„æ¨¡å—<br/>â˜‘ äº¤æ˜“ä¸­å¿ƒ â˜‘ å®¢æˆ·ä¸­å¿ƒ â˜ æ¸…ç»“ç®—ä¸­å¿ƒ ..."]
    D1 --> D2["å¯¹æ¯ä¸ªå·²é€‰æ¨¡å—è®¾ç½®æ“ä½œçº§åˆ«<br/>ä»…æŸ¥é˜… / å¯æ“ä½œ"]

    D2 --> E[ä¿å­˜è§’è‰²]
```

### 6.2 åˆ†é…è§’è‰²ç»™ç”¨æˆ·

```mermaid
flowchart TD
    A[è¿›å…¥ Settings â†’ ç”¨æˆ·ç®¡ç†] --> B{æ“ä½œç±»å‹}

    B -->|é‚€è¯·æ–°ç”¨æˆ·| C[è¾“å…¥é‚®ç®±/æ‰‹æœºå·]
    B -->|ç¼–è¾‘ç°æœ‰ç”¨æˆ·| D[é€‰æ‹©ç”¨æˆ·]

    C --> E[åˆ†é…è§’è‰²]
    D --> E

    E --> F[é€‰æ‹©è¯¥ MID ä¸‹çš„è§’è‰²<br/>å¯å¤šé€‰]
    F --> G[ä¿å­˜]

    G --> H{æ˜¯æ–°ç”¨æˆ·å—}
    H -->|æ˜¯| I[å‘é€é‚€è¯·<br/>é‚®ä»¶/çŸ­ä¿¡]
    H -->|å¦| J[æƒé™ç«‹å³ç”Ÿæ•ˆ]
```

### 6.3 æƒé™é…ç½® UI ç¤ºæ„

**åˆ›å»ºè§’è‰² - Step 2: é…ç½®æƒé™**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ›å»ºè§’è‰²                                       âœ•   â”‚
â”‚                                                     â”‚
â”‚  â— è§’è‰²è¯¦æƒ…  âœ“                                      â”‚
â”‚  â— é…ç½®æƒé™  â†                                      â”‚
â”‚                                                     â”‚
â”‚  é€‰æ‹©å¯è®¿é—®çš„æ¨¡å—ï¼Œå¹¶è®¾ç½®æ“ä½œçº§åˆ«ï¼š                 â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ¨¡å—             â”‚ æ“ä½œçº§åˆ«                     â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â˜‘ Assets         â”‚ â—‹ ä»…æŸ¥é˜…  â— å¯æ“ä½œ          â”‚  â”‚
â”‚  â”‚ â˜‘ Transfer In    â”‚ â— ä»…æŸ¥é˜…  â—‹ å¯æ“ä½œ          â”‚  â”‚
â”‚  â”‚ â˜‘ Transfer Out   â”‚ â—‹ ä»…æŸ¥é˜…  â— å¯æ“ä½œ          â”‚  â”‚
â”‚  â”‚ â˜ Checkout       â”‚ â€”                            â”‚  â”‚
â”‚  â”‚ â˜ Cards          â”‚ â€”                            â”‚  â”‚
â”‚  â”‚ â˜‘ Reports        â”‚ â— ä»…æŸ¥é˜…  â—‹ å¯æ“ä½œ          â”‚  â”‚
â”‚  â”‚ â˜ Trade Docs     â”‚ â€”                            â”‚  â”‚
â”‚  â”‚ â˜ Developer      â”‚ â€”                            â”‚  â”‚
â”‚  â”‚ â˜ Settings       â”‚ â€”                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                     â”‚
â”‚  ğŸ’¡ ä»…æŸ¥é˜… = åªèƒ½æŸ¥çœ‹åˆ—è¡¨å’Œè¯¦æƒ…                    â”‚
â”‚     å¯æ“ä½œ = å¯æ‰§è¡Œæ‰€æœ‰æ“ä½œï¼ˆåˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ç­‰ï¼‰  â”‚
â”‚                                                     â”‚
â”‚                          [å–æ¶ˆ]  [ä¿å­˜è§’è‰²]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 7. ç”¨æˆ·ç®¡ç†

### 7.1 ç”¨æˆ·ç®¡ç†åŠŸèƒ½æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”¨æˆ·ç®¡ç†                           [+ é‚€è¯·ç”¨æˆ·]    â”‚
â”‚                                                     â”‚
â”‚  ğŸ” æœç´¢ç”¨æˆ·åæˆ–é‚®ç®±                                â”‚
â”‚  [è§’è‰² â–¾]  [çŠ¶æ€ â–¾]                                 â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ç”¨æˆ·              è§’è‰²              çŠ¶æ€    Â·Â·Â· â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ å¼ ä¸‰              Account Holder    Active  Â·Â·Â· â”‚â”‚
â”‚  â”‚ zhang@test.com                                  â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ æå››              äº¤æ˜“ç®¡ç†å‘˜         Active  Â·Â·Â· â”‚â”‚
â”‚  â”‚ li@test.com       è´¢åŠ¡                          â”‚â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚ ç‹äº”              [å·²é‚€è¯·]           Invited Â·Â·Â· â”‚â”‚
â”‚  â”‚ wang@test.com                                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 é‚€è¯·ç”¨æˆ·æµç¨‹

```mermaid
flowchart TD
    A[ç‚¹å‡» é‚€è¯·ç”¨æˆ·] --> B[è¾“å…¥é‚®ç®±æˆ–æ‰‹æœºå·]
    B --> C[è¾“å…¥æ˜¾ç¤ºåç§°]
    C --> D[é€‰æ‹©è§’è‰²<br/>å¯å¤šé€‰]

    D --> E[ç‚¹å‡» å‘é€é‚€è¯·]
    E --> F[ç³»ç»Ÿå‘é€é‚€è¯·é‚®ä»¶/çŸ­ä¿¡]

    F --> G{è¢«é‚€è¯·äººæ˜¯å¦å·²æ³¨å†Œ}
    G -->|å·²æ³¨å†Œ| H[ç™»å½•ååœ¨é€šçŸ¥ä¸­çœ‹åˆ°é‚€è¯·]
    G -->|æœªæ³¨å†Œ| I[é€šè¿‡é“¾æ¥æ³¨å†Œå¹¶ç™»å½•]

    H --> J{æ¥å—é‚€è¯·}
    I --> J

    J -->|æ¥å—| K[ç”¨æˆ·åŠ å…¥ MID<br/>è·å¾—åˆ†é…çš„è§’è‰²å’Œæƒé™]
    J -->|æ‹’ç»| L[é‚€è¯·å¤±æ•ˆ]
```

### 7.3 ç”¨æˆ·çŠ¶æ€ç®¡ç†

| çŠ¶æ€                | è¯´æ˜                   | å¯æ‰§è¡Œæ“ä½œ                  |
| ------------------- | ---------------------- | --------------------------- |
| **Active**    | æ­£å¸¸ä½¿ç”¨               | Suspend / Remove / ä¿®æ”¹è§’è‰² |
| **Suspended** | æš‚åœï¼ˆä¿ç•™æ•°æ®å’Œè§’è‰²ï¼‰ | Activate / Remove           |
| **Removed**   | å·²ç§»é™¤ï¼ˆè§’è‰²æ¸…ç©ºï¼‰     | Re-invite                   |

**é‚€è¯·çŠ¶æ€ï¼š**

| çŠ¶æ€               | è¯´æ˜                 |
| ------------------ | -------------------- |
| **Invited**  | å·²å‘é€é‚€è¯·ï¼Œç­‰å¾…æ¥å— |
| **Accepted** | å·²æ¥å—é‚€è¯·           |
| **Expired**  | é‚€è¯·è¶…è¿‡ 7 å¤©æœªæ¥å—  |

### 7.4 ç”¨æˆ·æ“ä½œèœå•

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿®æ”¹è§’è‰²           â”‚
â”‚ æš‚åœç”¨æˆ·           â”‚
â”‚ ç§»é™¤ç”¨æˆ·           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. é‰´æƒæµç¨‹

### 8.1 é¡µé¢è®¿é—®é‰´æƒ

```mermaid
flowchart TD
    A[ç”¨æˆ·è®¿é—®æŸæ¨¡å—] --> B[è·å–ç”¨æˆ·åœ¨å½“å‰ MID ä¸‹çš„æ‰€æœ‰è§’è‰²]
    B --> C[åˆå¹¶æ‰€æœ‰è§’è‰²çš„é¡µé¢æƒé™<br/>å–å¹¶é›†]
    C --> D{è¯¥æ¨¡å—åœ¨æƒé™åˆ—è¡¨ä¸­}

    D -->|æ˜¯| E[å…è®¸è®¿é—®<br/>æ¸²æŸ“é¡µé¢]
    D -->|å¦| F[æ‹’ç»è®¿é—®<br/>æ˜¾ç¤ºæ— æƒé™æç¤º]
```

### 8.2 æ“ä½œé‰´æƒ

```mermaid
flowchart TD
    A[ç”¨æˆ·æ‰§è¡ŒæŸæ“ä½œ<br/>å¦‚: åˆ›å»ºæ”¶æ¬¾å•] --> B[è·å–ç”¨æˆ·åœ¨å½“å‰ MID ä¸‹çš„æ‰€æœ‰è§’è‰²]
    B --> C[åˆå¹¶æ‰€æœ‰è§’è‰²çš„æ“ä½œæƒé™<br/>å–æœ€é«˜çº§åˆ«]
    C --> D{æ£€æŸ¥è¯¥æ¨¡å—çš„æ“ä½œçº§åˆ«}

    D -->|å¯æ“ä½œ| E[å…è®¸æ“ä½œ]
    D -->|ä»…æŸ¥é˜…| F[æ‹’ç»æ“ä½œ<br/>å†™æ“ä½œæŒ‰é’®ç½®ç°æˆ–éšè—]
```

### 8.3 å®Œæ•´é‰´æƒé“¾è·¯

```mermaid
flowchart TD
    A[è¯·æ±‚] --> B[èº«ä»½è®¤è¯<br/>JWT / Session â†’ Identity IID]
    B --> C[è·å–å½“å‰ MID]
    C --> D[è§£æ User<br/>Identity + MID â†’ User UID]
    D --> E[è·å– User åœ¨å½“å‰ MID çš„æ‰€æœ‰è§’è‰²]
    E --> F[åˆå¹¶æ‰€æœ‰è§’è‰²æƒé™<br/>å–å¹¶é›†]

    F --> G{é¡µé¢æƒé™æ£€æŸ¥}
    G -->|é€šè¿‡| H{æ“ä½œæƒé™æ£€æŸ¥}
    G -->|ä¸é€šè¿‡| X[403 Forbidden]

    H -->|é€šè¿‡| I[æ‰§è¡Œè¯·æ±‚]
    H -->|ä¸é€šè¿‡| X
```

---

## 9. æ”¯ä»˜å¯†ç ï¼ˆPayment Passwordï¼‰

### 9.1 æ¦‚è¿°

æ”¯ä»˜å¯†ç æ˜¯ä¸€ä¸ª **æŒ‰ Userï¼ˆUIDï¼‰+ MID ç»´åº¦** è®¾ç½®çš„ 6 ä½æ•°å­— PINï¼Œç”¨äºåœ¨ç”¨æˆ·æ‰§è¡Œæ•æ„Ÿèµ„é‡‘æ“ä½œï¼ˆå¦‚å‘èµ·ä»˜æ¬¾ã€è½¬è´¦ã€æç°ç­‰ï¼‰æ—¶è¿›è¡ŒäºŒæ¬¡èº«ä»½éªŒè¯ã€‚

**æ ¸å¿ƒè§„åˆ™ï¼š**

- æ”¯ä»˜å¯†ç æŒ‰ User + MID ç‹¬ç«‹è®¾ç½®ï¼ŒåŒä¸€ Identity åœ¨ä¸åŒ MID ä¸‹çš„ä¸åŒ User å¯ä»¥æœ‰ä¸åŒçš„æ”¯ä»˜å¯†ç 
- æ”¯ä»˜å¯†ç æ˜¯ **å¯é€‰çš„**ï¼Œä¸å¼ºåˆ¶è®¾ç½®
- æ”¯ä»˜å¯†ç çš„è®¾ç½®å…¥å£åœ¨ Settings â†’ Security â†’ Payment password

### 9.2 è®¾ç½®å‰ææ¡ä»¶

ç”¨æˆ·å¿…é¡» **åŒæ—¶æ»¡è¶³** ä»¥ä¸‹æ¡ä»¶ï¼Œæ‰èƒ½çœ‹åˆ°å¹¶è®¾ç½®æŸä¸ª MID çš„æ”¯ä»˜å¯†ç ï¼š

| æ¡ä»¶                                        | è¯´æ˜                                                                                 |
| ------------------------------------------- | ------------------------------------------------------------------------------------ |
| **æ‹¥æœ‰è¯¥ MID çš„èµ„é‡‘æ“ä½œç›¸å…³é¡µé¢æƒé™** | ç”¨æˆ·åœ¨è¯¥ MID ä¸‹çš„è§’è‰²åŒ…å«æ¶‰åŠèµ„é‡‘æ“ä½œçš„æ¨¡å—ï¼ˆå¦‚ Payoutsã€Transfer Outã€Exchange ç­‰ï¼‰ |
| **è¯¥é¡µé¢æƒé™ä¸º"å¯æ“ä½œ"**              | ä»…æ‹¥æœ‰"ä»…æŸ¥é˜…"æƒé™çš„ç”¨æˆ·æ— éœ€è®¾ç½®æ”¯ä»˜å¯†ç ï¼Œå› ä¸ºæ— æ³•å‘èµ·ä»»ä½•èµ„é‡‘æ“ä½œ                   |

```
åˆ¤æ–­é€»è¾‘ï¼š

IF user.hasRole(mid)
   AND user.hasModulePermission(mid, [Payouts | Transfer Out | Exchange | ...])
   AND user.getOperationLevel(mid, module) == "operable"
THEN
   æ˜¾ç¤ºè¯¥ MID çš„æ”¯ä»˜å¯†ç è®¾ç½®å…¥å£
ELSE
   éšè—è¯¥ MID çš„æ”¯ä»˜å¯†ç è®¾ç½®å…¥å£
```

### 9.3 è®¾ç½®æµç¨‹

```mermaid
flowchart TD
    A[ç”¨æˆ·è¿›å…¥ Security â†’ Payment password] --> B[ç³»ç»Ÿåˆ—å‡ºç”¨æˆ·æœ‰èµ„é‡‘æ“ä½œæƒé™çš„ MID]
    B --> C[ç”¨æˆ·é€‰æ‹©æŸä¸ª MID ç‚¹å‡» Set up]
    C --> D[Step 1 éªŒè¯ç™»å½•å¯†ç ]
    D --> E{éªŒè¯é€šè¿‡}
    E -->|æ˜¯| F[Step 2 è¾“å…¥ 6 ä½æ•°å­— PIN]
    E -->|å¦| G[æç¤ºå¯†ç é”™è¯¯]
    F --> H[ç¡®è®¤ PIN å†æ¬¡è¾“å…¥]
    H --> I{ä¸¤æ¬¡è¾“å…¥ä¸€è‡´}
    I -->|æ˜¯| J[ä¿å­˜æˆåŠŸ çŠ¶æ€æ›´æ–°ä¸º Set]
    I -->|å¦| K[æç¤ºä¸ä¸€è‡´ é‡æ–°è¾“å…¥]
```

### 9.4 æƒé™å˜æ›´åœºæ™¯

#### åœºæ™¯ Aï¼šç”¨æˆ·å·²è®¾ç½®æ”¯ä»˜å¯†ç ï¼Œåç»­å¤±å»èµ„é‡‘æ“ä½œæƒé™

| é¡¹ç›®                   | è¯´æ˜                                                         |
| ---------------------- | ------------------------------------------------------------ |
| **è§¦å‘æ¡ä»¶**     | è§’è‰²è¢«ä¿®æ”¹ã€è§’è‰²è¢«ç§»é™¤ã€ç”¨æˆ·è¢«é™çº§ä¸º"ä»…æŸ¥é˜…"                 |
| **æ”¯ä»˜å¯†ç çŠ¶æ€** | ä¿ç•™ï¼Œä¸è‡ªåŠ¨åˆ é™¤                                             |
| **å®‰å…¨å½±å“**     | **æ— **ã€‚ç”¨æˆ·å·²æ— æ³•è¿›å…¥èµ„é‡‘æ“ä½œé¡µé¢ï¼Œæ”¯ä»˜å¯†ç ä¸ä¼šè¢«è§¦å‘ |
| **UI è¡¨ç°**      | Security é¡µé¢ä¸å†æ˜¾ç¤ºè¯¥ MID çš„æ”¯ä»˜å¯†ç å…¥å£                   |
| **æ¢å¤æƒé™å**   | æ”¯ä»˜å¯†ç è‡ªåŠ¨æ¢å¤ç”Ÿæ•ˆï¼Œæ— éœ€é‡æ–°è®¾ç½®                           |

#### åœºæ™¯ Bï¼šç”¨æˆ·åŸæ¥æ— æƒé™ï¼Œåç»­è·å¾—èµ„é‡‘æ“ä½œæƒé™

| é¡¹ç›®                   | è¯´æ˜                                                                   |
| ---------------------- | ---------------------------------------------------------------------- |
| **è§¦å‘æ¡ä»¶**     | è¢«åˆ†é…äº†åŒ…å«èµ„é‡‘æ“ä½œæ¨¡å—ä¸”ä¸º"å¯æ“ä½œ"çš„è§’è‰²                             |
| **æ”¯ä»˜å¯†ç çŠ¶æ€** | æœªè®¾ç½®ï¼ˆNot setï¼‰                                                      |
| **UI è¡¨ç°**      | Security é¡µé¢å‡ºç°è¯¥ MID çš„æ”¯ä»˜å¯†ç å…¥å£ï¼Œæ˜¾ç¤º "Not set" + "Set up" æŒ‰é’® |
| **æ˜¯å¦å¼ºåˆ¶è®¾ç½®** | å¦ã€‚ç”¨æˆ·å¯ä»¥é€‰æ‹©ä¸è®¾ç½®                                                 |

#### åœºæ™¯ Cï¼šç”¨æˆ·æœªè®¾ç½®æ”¯ä»˜å¯†ç ï¼Œä½†æœ‰èµ„é‡‘æ“ä½œæƒé™

| é¡¹ç›®               | è¯´æ˜                                                     |
| ------------------ | -------------------------------------------------------- |
| **éªŒè¯æ–¹å¼** | å›é€€åˆ°æ‰‹æœºå·/é‚®ç®±éªŒè¯ç ä½œä¸ºå®‰å…¨éªŒè¯æ–¹å¼                  |
| **ç”¨æˆ·ä½“éªŒ** | å‘èµ·èµ„é‡‘æ“ä½œæ—¶ï¼Œç³»ç»Ÿå‘é€éªŒè¯ç åˆ°ç”¨æˆ·å·²éªŒè¯çš„æ‰‹æœºå·æˆ–é‚®ç®± |
| **å®‰å…¨ç­‰çº§** | å¯æ¥å—ï¼Œä½†å»ºè®®ç”¨æˆ·è®¾ç½®æ”¯ä»˜å¯†ç ä»¥è·å¾—æ›´ä¾¿æ·çš„éªŒè¯ä½“éªŒ     |

### 9.5 èµ„é‡‘æ“ä½œéªŒè¯æµç¨‹

```mermaid
flowchart TD
    A[ç”¨æˆ·å‘èµ·èµ„é‡‘æ“ä½œ] --> B{ç”¨æˆ·æ˜¯å¦è®¾ç½®äº†è¯¥ MID çš„æ”¯ä»˜å¯†ç }
    B -->|å·²è®¾ç½®| C[å¼¹çª—: è¯·è¾“å…¥æ”¯ä»˜å¯†ç ]
    B -->|æœªè®¾ç½®| D[å¼¹çª—: è¯·è¾“å…¥éªŒè¯ç ]

    C --> E{æ”¯ä»˜å¯†ç æ­£ç¡®}
    E -->|æ˜¯| F[æ“ä½œç»§ç»­æ‰§è¡Œ]
    E -->|å¦| G[æç¤ºé”™è¯¯ å¯é‡è¯•]
    G --> G1{è¿ç»­é”™è¯¯ >= 5 æ¬¡}
    G1 -->|æ˜¯| G2[é”å®š 30 åˆ†é’Ÿ]
    G1 -->|å¦| C

    D --> D1[å‘é€éªŒè¯ç åˆ°æ‰‹æœºå·æˆ–é‚®ç®±]
    D1 --> D2{éªŒè¯ç æ­£ç¡®}
    D2 -->|æ˜¯| F
    D2 -->|å¦| D3[æç¤ºé”™è¯¯ å¯é‡è¯•]
```

### 9.6 æ•°æ®æ¨¡å‹

```
PAYMENT_PASSWORD {
    string user_id FK        -- User IDï¼ˆUIDï¼ŒMID å†…èº«ä»½ï¼‰
    string mid_id FK         -- MID ID
    string password_hash     -- åŠ å¯†å­˜å‚¨çš„ 6 ä½ PIN
    datetime created_at      -- åˆ›å»ºæ—¶é—´
    datetime updated_at      -- æœ€åä¿®æ”¹æ—¶é—´
    int fail_count           -- è¿ç»­å¤±è´¥æ¬¡æ•°
    datetime locked_until    -- é”å®šæˆªæ­¢æ—¶é—´ï¼ˆNULL = æœªé”å®šï¼‰
}

ä¸»é”®: (user_id, mid_id)
```

### 9.7 å®‰å…¨è§„åˆ™

| è§„åˆ™                       | è¯´æ˜                                            |
| -------------------------- | ----------------------------------------------- |
| **å­˜å‚¨**             | æ”¯ä»˜å¯†ç å¿…é¡»åŠ å¯†å­˜å‚¨ï¼ˆbcrypt/argon2ï¼‰ï¼Œä¸å¯æ˜æ–‡ |
| **è¿ç»­é”™è¯¯é”å®š**     | è¿ç»­è¾“é”™ 5 æ¬¡ï¼Œé”å®š 30 åˆ†é’Ÿ                     |
| **ä¿®æ”¹æ”¯ä»˜å¯†ç **     | éœ€å…ˆéªŒè¯ç™»å½•å¯†ç                                 |
| **å¿˜è®°æ”¯ä»˜å¯†ç **     | é€šè¿‡ç™»å½•å¯†ç  + æ‰‹æœºå·/é‚®ç®±éªŒè¯ç é‡ç½®            |
| **ä¸ç™»å½•å¯†ç çš„å…³ç³»** | æ”¯ä»˜å¯†ç ç‹¬ç«‹äºç™»å½•å¯†ç ï¼Œå»ºè®®ä¸è¦è®¾ç½®ç›¸åŒçš„å€¼    |

---

## 10. çŠ¶æ€æœº

### 10.1 Identity çŠ¶æ€

```
ACTIVE â†â†’ SUSPENDEDï¼ˆå¹³å°çº§å°ç¦ï¼‰
```

| çŠ¶æ€                | è¯´æ˜                                         |
| ------------------- | -------------------------------------------- |
| **ACTIVE**    | æ­£å¸¸ä½¿ç”¨ï¼Œå¯ç™»å½•                             |
| **SUSPENDED** | å¹³å°çº§å°ç¦ï¼Œè¯¥ Identity ä¸‹æ‰€æœ‰ User å‡ä¸å¯ç”¨ |

### 10.2 User çŠ¶æ€ï¼ˆMID å†…ï¼‰

```
ACTIVE â†â†’ DISABLEDï¼ˆAccount Holder æ“ä½œï¼‰
              â†“
          REMOVED
```

| çŠ¶æ€               | è¯´æ˜                                                             |
| ------------------ | ---------------------------------------------------------------- |
| **ACTIVE**   | æ­£å¸¸ä½¿ç”¨ï¼Œæƒé™ç”Ÿæ•ˆ                                               |
| **DISABLED** | Account Holder ç¦ç”¨è¯¥ Userï¼Œæƒé™ä¸ç”Ÿæ•ˆï¼Œä¸å½±å“ Identity å…¨å±€çŠ¶æ€ |
| **REMOVED**  | å·²ä» MID ç§»é™¤ï¼Œè§’è‰²æ¸…ç©º                                          |

### 10.3 è§’è‰²çŠ¶æ€

```
ACTIVE â†â†’ DISABLED
    â†“
  DELETED
```

| çŠ¶æ€               | è¯´æ˜                           |
| ------------------ | ------------------------------ |
| **ACTIVE**   | æ­£å¸¸ä½¿ç”¨ï¼Œæƒé™ç”Ÿæ•ˆ             |
| **DISABLED** | å·²ç¦ç”¨ï¼Œæƒé™ä¸ç”Ÿæ•ˆï¼Œä½†ä¿ç•™é…ç½® |
| **DELETED**  | å·²åˆ é™¤ï¼Œä¸å¯æ¢å¤               |

**åˆ é™¤è§’è‰²è§„åˆ™ï¼š**

- å¦‚æœè§’è‰²ä¸‹è¿˜æœ‰ Userï¼Œéœ€å…ˆç§»é™¤æ‰€æœ‰ User æˆ–å°† User è¿ç§»åˆ°å…¶ä»–è§’è‰²
- åˆ é™¤åä¸å¯æ¢å¤

### 10.4 é‚€è¯·çŠ¶æ€

```
INVITED â†’ ACCEPTED
    â†“
  EXPIREDï¼ˆ7å¤©æœªå¤„ç†ï¼‰
```

---

## é™„å½•

### A. æƒé™æ ‡è¯†å‘½åè§„èŒƒ

**æœ¬æœŸæ ¼å¼ï¼š**

```
æ ¼å¼: {module}:{op_level}

MP ç«¯ module:
  assets | transfer_in | checkout | transfer_out | cards | trade_docs | reports | developer | settings

TP ç«¯ moduleï¼ˆåç»­è¡¥å……ï¼‰:
  client | transaction | settlement | treasury | channel | partner | developer | ticket | data | risk | settings

op_level: view_only | operable

ç¤ºä¾‹ï¼ˆMPï¼‰:
assets:operable          â€” Assetsï¼Œå¯æ“ä½œ
transfer_in:view_only    â€” Transfer Inï¼Œä»…æŸ¥é˜…
transfer_out:operable    â€” Transfer Outï¼Œå¯æ“ä½œ
cards:view_only          â€” Cardsï¼Œä»…æŸ¥é˜…
settings:operable        â€” Settingsï¼Œå¯æ“ä½œ
```

**Phase 2 æ ¼å¼ï¼ˆç»†ç²’åº¦ CRUDï¼‰ï¼š**

```
æ ¼å¼: {module}:{resource}:{action}

resource: å…·ä½“èµ„æºåï¼ˆsnake_caseï¼‰
action:   view | create | edit | delete | manage | export

ç¤ºä¾‹:
transfer_out:payout:create       â€” Transfer Outï¼Œä»˜æ¬¾å•ï¼Œåˆ›å»º
assets:exchange:operable         â€” Assetsï¼Œæ¢æ±‡ï¼Œå¯æ“ä½œ
```

### B. é”™è¯¯æç¤º

| åœºæ™¯       | æç¤º                                                           |
| ---------- | -------------------------------------------------------------- |
| æ— é¡µé¢æƒé™ | "You don't have permission to access this module."             |
| æ— æ“ä½œæƒé™ | "You don't have permission to perform this action."            |
| è§’è‰²è¢«ç¦ç”¨ | "Your role has been disabled. Contact your administrator."     |
| ç”¨æˆ·è¢«æš‚åœ | "Your account has been suspended. Contact your administrator." |

---

*æœ€åæ›´æ–°ï¼š2026-02-13*
*æ–‡æ¡£ç‰ˆæœ¬ï¼šv2.2ï¼ˆMP ç«¯è§’è‰² & æƒé™ï¼‰*
*ä½œè€…ï¼šEX Product Team*
