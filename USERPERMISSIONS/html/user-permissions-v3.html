<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EX Platform - User & Permissions System V3</title>
    <style>
        :root {
            --primary: #5b6cf5;
            --primary-hover: #4a5ae0;
            --primary-light: #eef0ff;
            --bg: #f5f7fa;
            --white: #ffffff;
            --border: #e2e8f0;
            --border-light: #f1f3f5;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-muted: #a0aec0;
            --text-label: #6b7280;
            --success: #10b981;
            --success-bg: #d1fae5;
            --success-text: #065f46;
            --warning: #f59e0b;
            --warning-bg: #fef3c7;
            --warning-text: #92400e;
            --danger: #ef4444;
            --danger-bg: #fee2e2;
            --danger-text: #991b1b;
            --info: #3b82f6;
            --info-bg: #dbeafe;
            --info-text: #1e40af;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.12);
            --radius: 8px;
            --radius-lg: 12px;
            --font: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', 'PingFang SC', sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font); background: var(--bg); color: var(--text-primary); -webkit-font-smoothing: antialiased; }

        /* ===== Header ===== */
        .header { background: var(--white); border-bottom: 1px solid var(--border); padding: 0 32px; height: 56px; display: flex; align-items: center; position: sticky; top: 0; z-index: 100; }
        .header-logo { display: flex; align-items: center; gap: 10px; margin-right: 24px; }
        .header-logo svg { flex-shrink: 0; }
        .header-logo-text { font-size: 15px; font-weight: 600; }
        .header-nav { display: flex; gap: 2px; }
        .header-nav-item { padding: 6px 14px; font-size: 13px; font-weight: 500; color: var(--text-secondary); border-radius: 6px; cursor: pointer; border: none; background: none; transition: all 0.15s; }
        .header-nav-item:hover { background: var(--bg); }
        .header-nav-item.active { background: var(--primary); color: #fff; }
        .header-right { margin-left: auto; display: flex; align-items: center; gap: 12px; }

        /* Portal Switcher */
        .portal-switcher { display: none; position: relative; }
        .portal-switcher-btn { display: flex; align-items: center; gap: 6px; padding: 5px 12px; border: 1px solid var(--border); border-radius: 6px; background: var(--white); cursor: pointer; font-size: 12px; font-weight: 600; color: var(--primary); transition: all 0.15s; }
        .portal-switcher-btn:hover { border-color: var(--primary); background: var(--primary-light); }
        .portal-switcher-btn .portal-icon { width: 20px; height: 20px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: #fff; }
        .portal-dd { display: none; position: absolute; top: calc(100% + 6px); right: 0; background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow-lg); min-width: 280px; z-index: 200; overflow: hidden; }
        .portal-dd.show { display: block; }
        .portal-dd-header { padding: 10px 16px; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid var(--border-light); }
        .portal-dd-item { padding: 10px 16px; display: flex; align-items: center; gap: 10px; cursor: pointer; font-size: 13px; color: var(--text-secondary); transition: background 0.1s; }
        .portal-dd-item:hover { background: var(--bg); }
        .portal-dd-item.current { background: var(--primary-light); }
        .portal-dd-item .pi { width: 28px; height: 28px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: #fff; flex-shrink: 0; }
        .portal-dd-item .pi-info { flex: 1; }
        .portal-dd-item .pi-name { font-weight: 500; font-size: 13px; }
        .portal-dd-item .pi-sub { font-size: 11px; color: var(--text-muted); }
        .portal-dd-divider { height: 1px; background: var(--border-light); margin: 4px 0; }

        /* Account Switcher */
        .account-sw { display: none; position: relative; }
        .account-sw-btn { display: flex; align-items: center; gap: 8px; padding: 5px 12px 5px 10px; border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px; color: var(--text-secondary); background: var(--white); transition: all 0.15s; }
        .account-sw-btn:hover { border-color: #cbd5e0; background: #fafbfc; }
        .account-sw-btn .adot { width: 8px; height: 8px; border-radius: 50%; background: var(--success); }
        .account-sw-btn .caret { font-size: 10px; color: var(--text-muted); margin-left: 4px; }
        .account-dd { display: none; position: absolute; top: calc(100% + 6px); right: 0; background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow-lg); min-width: 260px; z-index: 200; overflow: hidden; }
        .account-dd.show { display: block; }
        .account-dd-header { padding: 10px 16px; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 1px solid var(--border-light); }
        .account-dd-item { padding: 10px 16px; display: flex; align-items: center; justify-content: space-between; cursor: pointer; font-size: 13px; color: var(--text-secondary); transition: background 0.1s; }
        .account-dd-item:hover { background: var(--bg); }
        .account-dd-item .ai-name { font-weight: 500; }

        .avatar { display: none; width: 32px; height: 32px; border-radius: 50%; background: var(--primary); color: #fff; font-size: 13px; font-weight: 600; align-items: center; justify-content: center; cursor: pointer; }

        /* ===== Badge ===== */
        .badge { display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 500; line-height: 1.4; }
        .badge-success { background: var(--success-bg); color: var(--success-text); }
        .badge-warning { background: var(--warning-bg); color: var(--warning-text); }
        .badge-danger { background: var(--danger-bg); color: var(--danger-text); }
        .badge-primary { background: var(--primary-light); color: var(--primary); }
        .badge-info { background: var(--info-bg); color: var(--info-text); }
        .badge-muted { background: #f1f3f5; color: var(--text-muted); }

        /* ===== Module ===== */
        .module { display: none; min-height: calc(100vh - 56px); }
        .module.active { display: block; }

        /* ===== Layout ===== */
        .page-layout { max-width: 800px; margin: 0 auto; padding: 36px 20px; }

        /* ===== Card ===== */
        .card { background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px 24px; margin-bottom: 16px; box-shadow: var(--shadow-sm); }
        .card-head { font-size: 15px; font-weight: 600; color: var(--text-primary); margin-bottom: 2px; }
        .card-sub { font-size: 13px; color: var(--text-muted); margin-bottom: 16px; line-height: 1.5; }

        /* ===== Tabs ===== */
        .tabs { display: flex; border-bottom: 1px solid var(--border); margin-bottom: 28px; }
        .tab-item { padding: 10px 0; margin-right: 28px; font-size: 14px; font-weight: 500; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.15s; }
        .tab-item:hover { color: var(--text-secondary); }
        .tab-item.active { color: var(--text-primary); border-bottom-color: var(--primary); }
        .tab-panel { display: none; }
        .tab-panel.on { display: block; }

        /* ===== Form ===== */
        .form-group { margin-bottom: 18px; }
        .form-label { display: block; font-size: 13px; font-weight: 500; color: var(--text-secondary); margin-bottom: 5px; }
        .form-input { width: 100%; padding: 9px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; color: var(--text-primary); background: var(--white); outline: none; transition: border-color 0.15s, box-shadow 0.15s; font-family: var(--font); }
        .form-input:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(91,108,245,0.1); }
        .form-input::placeholder { color: #cbd5e0; }
        .form-hint { font-size: 12px; color: var(--text-muted); margin-top: 4px; line-height: 1.5; }
        .form-select { width: 100%; padding: 9px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 14px; color: var(--text-primary); background: var(--white); outline: none; cursor: pointer; font-family: var(--font); }
        .form-select:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(91,108,245,0.1); }
        .input-row { display: flex; gap: 8px; }
        .input-row .form-input { flex: 1; }

        /* ===== Buttons ===== */
        .btn { padding: 9px 18px; border: none; border-radius: 6px; font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.15s; display: inline-flex; align-items: center; justify-content: center; gap: 6px; font-family: var(--font); }
        .btn-primary { background: var(--primary); color: #fff; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-primary:disabled { background: #cbd5e0; cursor: not-allowed; }
        .btn-secondary { background: var(--white); color: var(--text-secondary); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--bg); }
        .btn-ghost { background: none; color: var(--primary); padding: 6px 10px; font-size: 13px; }
        .btn-ghost:hover { background: var(--primary-light); }
        .btn-sm { padding: 6px 12px; font-size: 13px; }
        .btn-danger-outline { background: none; color: var(--danger); border: 1px solid var(--danger-bg); }
        .btn-danger-outline:hover { background: var(--danger-bg); }
        .btn-full { width: 100%; }

        /* ===== Toggle ===== */
        .toggle-group { display: flex; gap: 8px; margin-bottom: 16px; }
        .toggle-btn { flex: 1; padding: 10px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px; font-weight: 500; color: var(--text-secondary); background: var(--white); cursor: pointer; text-align: center; transition: all 0.15s; }
        .toggle-btn:hover { border-color: #cbd5e0; }
        .toggle-btn.active { border-color: var(--primary); background: var(--primary-light); color: var(--primary); }

        /* ===== Table ===== */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th { text-align: left; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; padding: 10px 8px; border-bottom: 1px solid var(--border); }
        .data-table td { padding: 14px 8px; font-size: 13px; color: var(--text-secondary); border-bottom: 1px solid var(--border-light); vertical-align: middle; }
        .data-table .name-cell { font-weight: 500; color: var(--text-primary); font-size: 13px; }
        .data-table .sub-cell { font-size: 11px; color: var(--text-muted); }

        /* ===== Info Row ===== */
        .info-row { display: flex; align-items: center; padding: 14px 0; border-bottom: 1px solid var(--border-light); }
        .info-row:last-child { border-bottom: none; }
        .info-key { width: 140px; font-size: 13px; font-weight: 500; color: var(--text-label); flex-shrink: 0; }
        .info-val { flex: 1; font-size: 14px; color: var(--text-secondary); display: flex; align-items: center; gap: 8px; }
        .info-act { margin-left: auto; }

        /* ===== Icon Row (like 2FA rows) ===== */
        .icon-row { display: flex; align-items: flex-start; padding: 14px 0; border-bottom: 1px solid var(--border-light); }
        .icon-row:last-child { border-bottom: none; }
        .icon-box { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px; flex-shrink: 0; font-size: 16px; }
        .icon-row-body { flex: 1; }
        .icon-row-name { font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 8px; }
        .icon-row-desc { font-size: 13px; color: var(--text-muted); margin-top: 2px; line-height: 1.5; }
        .icon-row-act { margin-left: 12px; flex-shrink: 0; }

        /* ===== Permission Matrix ===== */
        .perm-matrix { width: 100%; border-collapse: collapse; margin-top: 12px; }
        .perm-matrix th { text-align: center; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.3px; padding: 8px 6px; border-bottom: 1px solid var(--border); }
        .perm-matrix th:first-child { text-align: left; }
        .perm-matrix td { padding: 12px 6px; text-align: center; border-bottom: 1px solid var(--border-light); font-size: 13px; }
        .perm-matrix td:first-child { text-align: left; }
        .perm-badge { display: inline-flex; padding: 3px 10px; border-radius: 10px; font-size: 11px; font-weight: 600; cursor: pointer; transition: all 0.15s; user-select: none; }
        .perm-badge:hover { transform: scale(1.05); }
        .perm-self { background: var(--success-bg); color: var(--success-text); }
        .perm-owner { background: var(--danger-bg); color: var(--danger-text); }

        /* ===== Menu Permission Preview ===== */
        .menu-preview { display: flex; gap: 16px; flex-wrap: wrap; margin-top: 12px; }
        .menu-group-preview { flex: 1; min-width: 200px; }
        .menu-group-label { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; padding: 4px 8px; border-radius: 4px; }
        .menu-item-preview { font-size: 12px; padding: 4px 8px 4px 16px; color: var(--text-secondary); display: flex; align-items: center; gap: 6px; }
        .menu-item-preview.disabled { color: var(--text-muted); text-decoration: line-through; opacity: 0.5; }
        .menu-check { font-size: 10px; }

        /* ===== Modal ===== */
        .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.3); backdrop-filter: blur(2px); z-index: 500; align-items: center; justify-content: center; }
        .overlay.show { display: flex; }
        .modal { background: var(--white); border-radius: var(--radius-lg); padding: 28px; width: 100%; max-width: 480px; box-shadow: var(--shadow-lg); position: relative; animation: fadeUp 0.2s ease; max-height: 90vh; overflow-y: auto; }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
        .modal-x { position: absolute; top: 16px; right: 16px; width: 28px; height: 28px; border: none; background: var(--bg); border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 16px; color: var(--text-muted); }
        .modal-x:hover { background: #e2e8f0; }
        .modal h3 { font-size: 17px; font-weight: 600; margin-bottom: 4px; }
        .modal .mdesc { font-size: 13px; color: var(--text-muted); margin-bottom: 20px; line-height: 1.5; }
        .modal-wide { max-width: 560px; }

        /* ===== Step Indicator ===== */
        .steps { display: flex; align-items: center; justify-content: center; gap: 0; margin-bottom: 24px; }
        .step-dot { width: 28px; height: 28px; border-radius: 50%; font-size: 12px; font-weight: 600; display: flex; align-items: center; justify-content: center; background: #edf2f7; color: var(--text-muted); }
        .step-dot.active { background: var(--primary); color: #fff; }
        .step-dot.done { background: var(--success); color: #fff; }
        .step-bar { width: 48px; height: 2px; background: #edf2f7; }
        .step-bar.done { background: var(--success); }

        /* ===== Invite Flow Steps ===== */
        .flow-step { display: none; }
        .flow-step.on { display: block; }

        /* ===== Alert Box ===== */
        .alert { padding: 12px 16px; border-radius: var(--radius); font-size: 13px; line-height: 1.6; margin-bottom: 16px; display: flex; gap: 10px; align-items: flex-start; }
        .alert-icon { font-size: 16px; flex-shrink: 0; margin-top: 1px; }
        .alert-info { background: var(--info-bg); color: var(--info-text); border: 1px solid #93c5fd; }
        .alert-warning { background: var(--warning-bg); color: var(--warning-text); border: 1px solid #fcd34d; }
        .alert-danger { background: var(--danger-bg); color: var(--danger-text); border: 1px solid #fca5a5; }
        .alert-success { background: var(--success-bg); color: var(--success-text); border: 1px solid #6ee7b7; }

        /* ===== Toast ===== */
        .toast { position: fixed; top: 68px; right: 20px; padding: 10px 18px; border-radius: 8px; font-size: 13px; font-weight: 500; color: #fff; z-index: 9999; transform: translateX(calc(100% + 40px)); transition: transform 0.25s ease; box-shadow: var(--shadow-md); }
        .toast.show { transform: translateX(0); }
        .toast.ok { background: var(--success); }
        .toast.err { background: var(--danger); }
        .toast.inf { background: var(--primary); }

        /* ===== Scenario Card ===== */
        .scenario-card { text-align: left; padding: 14px 16px; cursor: pointer; border: 1px solid var(--border); border-radius: 6px; background: var(--white); transition: all 0.15s; margin-bottom: 8px; }
        .scenario-card:hover { border-color: var(--primary); background: var(--primary-light); }
        .scenario-card strong { font-size: 13px; }
        .scenario-card .sc-desc { font-size: 12px; color: var(--text-muted); margin-top: 3px; line-height: 1.4; }

        /* ===== Dot Menu ===== */
        .dotmenu { position: relative; }
        .dotmenu-btn { width: 28px; height: 28px; border: 1px solid var(--border); background: var(--white); border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; color: var(--text-muted); letter-spacing: 1px; }
        .dotmenu-btn:hover { background: var(--bg); }
        .dotmenu-dd { display: none; position: absolute; top: calc(100% + 4px); right: 0; background: var(--white); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow-md); min-width: 160px; z-index: 10; overflow: hidden; }
        .dotmenu-dd.show { display: block; }
        .dotmenu-item { padding: 8px 14px; font-size: 13px; cursor: pointer; color: var(--text-secondary); transition: background 0.1s; }
        .dotmenu-item:hover { background: var(--bg); }
        .dotmenu-item.red { color: var(--danger); }

        /* ===== Helpers ===== */
        .link { color: var(--primary); font-weight: 500; cursor: pointer; text-decoration: none; font-size: 13px; }
        .link:hover { text-decoration: underline; }
        .center { text-align: center; }
        .mt-8 { margin-top: 8px; }
        .mt-12 { margin-top: 12px; }
        .mt-16 { margin-top: 16px; }
        .mt-20 { margin-top: 20px; }
        .mt-24 { margin-top: 24px; }
        .mb-16 { margin-bottom: 16px; }
        .flex-between { display: flex; align-items: center; justify-content: space-between; }
        .flex-gap { display: flex; gap: 8px; }
        .text-muted { color: var(--text-muted); }
        .text-sm { font-size: 12px; }
    </style>
</head>
<body>

<!-- ===== HEADER ===== -->
<div class="header">
    <div class="header-logo">
        <svg width="28" height="28" viewBox="0 0 32 32" fill="none"><rect width="32" height="32" rx="8" fill="#5b6cf5"/><path d="M16 8L22 12V20L16 24L10 20V12L16 8Z" fill="white"/></svg>
        <div class="header-logo-text">EX Platform</div>
    </div>
    <div class="header-nav">
        <button class="header-nav-item active" onclick="goMod('scenarios',this)">Demo Scenarios</button>
        <button class="header-nav-item" onclick="goMod('permissions',this)">Permissions</button>
        <button class="header-nav-item" onclick="goMod('invite',this)">Invite Flow</button>
        <button class="header-nav-item" onclick="goMod('merge',this)">Account Merge</button>
    </div>
    <div class="header-right">
        <!-- Portal Switcher -->
        <div class="portal-switcher" id="portalSw">
            <div class="portal-switcher-btn" onclick="togglePortalDD()">
                <span class="portal-icon" id="portalIcon" style="background:#5b6cf5;">MP</span>
                <span id="portalName">Merchant Portal</span>
                <span class="caret" style="font-size:10px;color:var(--text-muted);">â–¾</span>
            </div>
            <div class="portal-dd" id="portalDD">
                <div class="portal-dd-header">Switch portal</div>
                <div class="portal-dd-item current" onclick="switchPortal('MP','Merchant Portal','#5b6cf5')">
                    <span class="pi" style="background:#5b6cf5;">MP</span>
                    <span class="pi-info"><span class="pi-name">Merchant Portal</span><span class="pi-sub">ABC Trading Â· MID-001</span></span>
                    <span class="badge badge-success" style="font-size:10px;">Current</span>
                </div>
                <div class="portal-dd-divider"></div>
                <div class="portal-dd-item" onclick="switchPortal('TP','Tenant Portal','#8b5cf6')">
                    <span class="pi" style="background:#8b5cf6;">TP</span>
                    <span class="pi-info"><span class="pi-name">Tenant Portal</span><span class="pi-sub">Bonbil Â· TID-001</span></span>
                </div>
            </div>
        </div>
        <!-- Account Switcher -->
        <div class="account-sw" id="accountSw">
            <div class="account-sw-btn" onclick="toggleAccountDD()">
                <span class="adot"></span>
                <span id="accountName">ABC Trading</span>
                <span class="caret">â–¾</span>
            </div>
            <div class="account-dd" id="accountDD">
                <div class="account-dd-header">Switch MID</div>
                <div class="account-dd-item" onclick="pickMID('ABC Trading','Owner')"><span class="ai-name">ABC Trading</span><span class="badge badge-warning">Owner</span></div>
                <div class="account-dd-item" onclick="pickMID('XYZ Corp','ç®¡ç†å‘˜')"><span class="ai-name">XYZ Corp</span><span class="badge badge-primary">ç®¡ç†å‘˜</span></div>
                <div class="account-dd-item" onclick="pickMID('Global Inc','è´¢åŠ¡')"><span class="ai-name">Global Inc</span><span class="badge badge-info">è´¢åŠ¡</span></div>
            </div>
        </div>
        <div class="avatar" id="hAvatar">J</div>
    </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- ========== MODULE: DEMO SCENARIOS ========== -->
<div class="module active" id="mod-scenarios">
    <div class="page-layout" style="max-width:720px;">
        <h2 style="margin-bottom:6px;">User & Permissions System V3</h2>
        <p style="font-size:14px;color:var(--text-muted);margin-bottom:24px;">Complete interactive prototype covering roles, invitations, account merge, and multi-portal switching.</p>

        <div class="alert alert-info">
            <span class="alert-icon">ğŸ“‹</span>
            <div>
                <strong>Design decisions confirmed:</strong><br>
                â€¢ åŒä¸€è´¦å·å¤šç«¯åˆ‡æ¢ï¼ˆTP/MPï¼‰<br>
                â€¢ è§’è‰²ï¼šOwnerï¼ˆå¼€æˆ·äºº/æ³•äºº/è‘£äº‹ï¼‰+ ç®¡ç†å‘˜ + è´¢åŠ¡ + è¿è¥<br>
                â€¢ é‚€è¯·æœªæ³¨å†Œç”¨æˆ·ï¼šå…ˆæ³¨å†Œå†åŠ å…¥<br>
                â€¢ æ‰‹æœºå·å†²çªï¼šæ”¯æŒåˆå¹¶ç™»å½•å‡­è¯ï¼ˆUserå±‚é¢ï¼ŒéMIDåˆå¹¶ï¼‰<br>
                â€¢ èœå•æƒé™ï¼šæŒ‰ä¸šåŠ¡åŸŸåˆ’åˆ†<br>
                â€¢ æ“ä½œæƒé™ï¼šä¿æŒSelf/OwneräºŒå…ƒéªŒè¯<br>
                â€¢ æ•°æ®æƒé™ï¼šæŒ‰å½’å±äººåˆ†é…ï¼Œåªçœ‹åˆ°åˆ†é…ç»™è‡ªå·±çš„æ•°æ®ï¼ˆåœ°åŒºç»´åº¦æœ¬æœŸä¸åšï¼‰
            </div>
        </div>

        <div class="card">
            <div class="card-head">1. Role & Permission Management</div>
            <div class="card-sub">View and manage roles, members, and operation permissions for a MID.</div>
            <div class="scenario-card" onclick="goMod('permissions',document.querySelectorAll('.header-nav-item')[1])">
                <strong>â†’ Open Permissions Panel</strong>
                <div class="sc-desc">Role definitions, member list, menu permission matrix, operation permissions (Self/Owner toggle), data ownership assignment</div>
            </div>
        </div>

        <div class="card">
            <div class="card-head">2. Invite Member Flows</div>
            <div class="card-sub">Different invitation scenarios with edge cases.</div>
            <div class="scenario-card" onclick="startInviteDemo('email-new')">
                <strong style="color:var(--primary);">A. Email invite â†’ User not registered</strong>
                <div class="sc-desc">Invite li@new.com â†’ Email sent â†’ User clicks link â†’ Not registered â†’ Register flow â†’ Auto-join MID</div>
            </div>
            <div class="scenario-card" onclick="startInviteDemo('email-existing')">
                <strong style="color:var(--success);">B. Email invite â†’ User already registered</strong>
                <div class="sc-desc">Invite wang@test.com â†’ Email sent â†’ User clicks link â†’ Already has account â†’ Login â†’ Auto-join MID</div>
            </div>
            <div class="scenario-card" onclick="startInviteDemo('mobile')">
                <strong>C. Mobile invite</strong>
                <div class="sc-desc">Invite via mobile number â†’ SMS sent â†’ User clicks link â†’ Same flow as email</div>
            </div>
        </div>

        <div class="card">
            <div class="card-head">3. Account Merge Flow</div>
            <div class="card-sub">Handle credential conflicts when binding new contact info. <strong>Merge = login credentials merge on User level, not MID merge.</strong></div>
            <div class="scenario-card" onclick="goMod('merge',document.querySelectorAll('.header-nav-item')[3])">
                <strong style="color:var(--warning);">Phone number conflict â†’ Credential merge</strong>
                <div class="sc-desc">User registered via email â†’ Bind phone â†’ Phone belongs to another account â†’ Verify both â†’ Merge login credentials into one User (both MIDs preserved separately)</div>
            </div>
        </div>

        <div class="card">
            <div class="card-head">4. Multi-Portal Switching</div>
            <div class="card-sub">User is both TP admin and MP owner.</div>
            <div class="scenario-card" onclick="demoPortalSwitch()">
                <strong>Switch between MP and TP portals</strong>
                <div class="sc-desc">Login â†’ Default to last used portal (MP) â†’ Click portal switcher â†’ Switch to TP â†’ Different menu structure</div>
            </div>
        </div>

        <div class="card">
            <div class="card-head">5. Sensitive Operation Verification</div>
            <div class="card-sub">Self vs Owner verification based on permission config.</div>
            <div class="scenario-card" onclick="openM('mOpSelf')">
                <strong style="color:var(--success);">A. User authorized (Self verification)</strong>
                <div class="sc-desc">è´¢åŠ¡ initiates payout â†’ Authorized â†’ Code sent to user's own mobile</div>
            </div>
            <div class="scenario-card" onclick="openM('mOpOwner')">
                <strong style="color:var(--danger);">B. User not authorized (Owner verification)</strong>
                <div class="sc-desc">è¿è¥ initiates payout â†’ Not authorized â†’ Code sent to Owner's mobile</div>
            </div>
        </div>
    </div>
</div>

<!-- ========== MODULE: PERMISSIONS ========== -->
<div class="module" id="mod-permissions">
    <div class="page-layout">
        <div class="tabs">
            <div class="tab-item active" onclick="permTab('roles',this)">Roles</div>
            <div class="tab-item" onclick="permTab('members',this)">Members</div>
            <div class="tab-item" onclick="permTab('menus',this)">Menu Access</div>
            <div class="tab-item" onclick="permTab('operations',this)">Operations</div>
            <div class="tab-item" onclick="permTab('data',this)">Data Access</div>
        </div>

        <!-- ROLES TAB -->
        <div class="tab-panel on" id="tp-roles">
            <div class="card" style="background:var(--primary-light);border-color:var(--primary);border-style:dashed;">
                <div style="font-size:13px;color:var(--primary);font-weight:500;">
                    Viewing as <strong>Owner</strong> of <strong>ABC Trading</strong> (MID-001). Only Owner can manage roles and members.
                </div>
            </div>

            <div class="card">
                <div class="card-head">Role Definitions</div>
                <div class="card-sub">4 built-in roles with different access levels. Roles cannot be customized in this version.</div>

                <div class="icon-row">
                    <div class="icon-box" style="background:var(--warning-bg);">â­</div>
                    <div class="icon-row-body">
                        <div class="icon-row-name" style="color:#92400e;">Owner <span class="badge badge-warning">1 per MID</span></div>
                        <div class="icon-row-desc">
                            Full control. Can manage members, configure permissions, access all menus and operations.<br>
                            <strong>Must beï¼š</strong>å¼€æˆ·äººï¼ˆAccount Openerï¼‰/ æ³•äººï¼ˆLegal Repï¼‰/ è‘£äº‹ï¼ˆDirectorï¼‰<br>
                            <strong>Cannot be removed or downgraded.</strong>
                        </div>
                    </div>
                </div>
                <div class="icon-row">
                    <div class="icon-box" style="background:var(--primary-light);">ğŸ›¡ï¸</div>
                    <div class="icon-row-body">
                        <div class="icon-row-name" style="color:var(--primary);">ç®¡ç†å‘˜ (Admin) <span class="badge badge-primary">Multiple</span></div>
                        <div class="icon-row-desc">
                            Access all menus (same as Owner). Can perform all business operations.<br>
                            <strong>Cannotï¼š</strong>manage members, change roles, configure operation permissions.<br>
                            <strong>Menusï¼š</strong>Assets, Transfer In/Out, Checkout, Cards, Reports, Trade Docs, Developer, Settings
                        </div>
                    </div>
                </div>
                <div class="icon-row">
                    <div class="icon-box" style="background:var(--info-bg);">ğŸ’°</div>
                    <div class="icon-row-body">
                        <div class="icon-row-name" style="color:var(--info);">è´¢åŠ¡ (Finance) <span class="badge badge-info">Multiple</span></div>
                        <div class="icon-row-desc">
                            Focus on fund management and financial reporting.<br>
                            <strong>Menusï¼š</strong>Assets, Transfer Inï¼ˆPayins/Crypto Receive onlyï¼‰, Transfer Outï¼ˆPayouts/Crypto Send/Remittanceï¼‰, Reports, Trade Docs<br>
                            <strong>No accessï¼š</strong>Checkout, Cards, Developer, Settings
                        </div>
                    </div>
                </div>
                <div class="icon-row">
                    <div class="icon-box" style="background:#fce7f3;">ğŸ“¦</div>
                    <div class="icon-row-body">
                        <div class="icon-row-name" style="color:#db2777;">è¿è¥ (Operations) <span class="badge" style="background:#fce7f3;color:#db2777;">Multiple</span></div>
                        <div class="icon-row-desc">
                            Focus on business operations and customer-facing activities.<br>
                            <strong>Menusï¼š</strong>Transfer Inï¼ˆCollection Tools/Remitter/Payins/Crypto Receiveï¼‰, Checkout, Cards, Reports<br>
                            <strong>No accessï¼š</strong>Assetsï¼ˆä½™é¢/å…‘æ¢ï¼‰, Transfer Outï¼ˆä»˜æ¬¾ï¼‰, Developer, Settings, Trade Docs
                        </div>
                    </div>
                </div>
            </div>

            <div class="card" style="background:var(--bg);border:none;">
                <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;">
                    <strong>Role assignment rules:</strong><br>
                    â€¢ Owner is auto-assigned to the account opener at MID creation<br>
                    â€¢ Owner can transfer ownership to another verified identity (å¼€æˆ·äºº/æ³•äºº/è‘£äº‹)<br>
                    â€¢ New invited members default to <strong>è¿è¥</strong> role<br>
                    â€¢ Owner can change any member's role at any time<br>
                    â€¢ A user can have different roles in different MIDs (e.g., Owner in MID-001, è´¢åŠ¡ in MID-002)
                </div>
            </div>
        </div>

        <!-- MEMBERS TAB -->
        <div class="tab-panel" id="tp-members">
            <div class="card">
                <div class="flex-between" style="margin-bottom:16px;">
                    <div><div class="card-head">Members (4)</div><div class="card-sub" style="margin-bottom:0;">Manage who has access to ABC Trading (MID-001).</div></div>
                    <button class="btn btn-primary btn-sm" onclick="openM('mInvite')">+ Invite member</button>
                </div>
                <div style="overflow-x:auto;">
                <table class="data-table">
                    <thead><tr><th>User</th><th>Role</th><th>Status</th><th>Joined</th><th></th></tr></thead>
                    <tbody>
                        <tr>
                            <td><div class="name-cell">å¼ ä¸‰ (You)</div><div class="sub-cell">zhang@test.com Â· +86 138****1234</div></td>
                            <td><span class="badge badge-warning">Owner</span></td>
                            <td><span class="badge badge-success">Active</span></td>
                            <td style="color:var(--text-muted);">2024-01-15</td>
                            <td>â€”</td>
                        </tr>
                        <tr>
                            <td><div class="name-cell">æå››</div><div class="sub-cell">li@test.com Â· +852 9641****</div></td>
                            <td>
                                <select class="form-select" style="width:auto;padding:4px 8px;font-size:12px;" onchange="toast('Role changed to '+this.value,'ok')">
                                    <option value="ç®¡ç†å‘˜" selected>ç®¡ç†å‘˜</option>
                                    <option value="è´¢åŠ¡">è´¢åŠ¡</option>
                                    <option value="è¿è¥">è¿è¥</option>
                                </select>
                            </td>
                            <td><span class="badge badge-success">Active</span></td>
                            <td style="color:var(--text-muted);">2024-03-20</td>
                            <td><div class="dotmenu"><button class="dotmenu-btn" onclick="toggleDM(this)">Â·Â·Â·</button><div class="dotmenu-dd"><div class="dotmenu-item red" onclick="toast('Member removed','inf');this.closest('.dotmenu-dd').classList.remove('show')">Remove</div></div></div></td>
                        </tr>
                        <tr>
                            <td><div class="name-cell">ç‹äº”</div><div class="sub-cell">wang@test.com</div></td>
                            <td>
                                <select class="form-select" style="width:auto;padding:4px 8px;font-size:12px;" onchange="toast('Role changed to '+this.value,'ok')">
                                    <option value="ç®¡ç†å‘˜">ç®¡ç†å‘˜</option>
                                    <option value="è´¢åŠ¡" selected>è´¢åŠ¡</option>
                                    <option value="è¿è¥">è¿è¥</option>
                                </select>
                            </td>
                            <td><span class="badge badge-success">Active</span></td>
                            <td style="color:var(--text-muted);">2024-05-10</td>
                            <td><div class="dotmenu"><button class="dotmenu-btn" onclick="toggleDM(this)">Â·Â·Â·</button><div class="dotmenu-dd"><div class="dotmenu-item red" onclick="toast('Member removed','inf');this.closest('.dotmenu-dd').classList.remove('show')">Remove</div></div></div></td>
                        </tr>
                        <tr>
                            <td><div class="name-cell">èµµå…­</div><div class="sub-cell">zhao@test.com</div></td>
                            <td>
                                <select class="form-select" style="width:auto;padding:4px 8px;font-size:12px;" onchange="toast('Role changed to '+this.value,'ok')">
                                    <option value="ç®¡ç†å‘˜">ç®¡ç†å‘˜</option>
                                    <option value="è´¢åŠ¡">è´¢åŠ¡</option>
                                    <option value="è¿è¥" selected>è¿è¥</option>
                                </select>
                            </td>
                            <td><span class="badge badge-success">Active</span></td>
                            <td style="color:var(--text-muted);">2024-08-01</td>
                            <td><div class="dotmenu"><button class="dotmenu-btn" onclick="toggleDM(this)">Â·Â·Â·</button><div class="dotmenu-dd"><div class="dotmenu-item red" onclick="toast('Member removed','inf');this.closest('.dotmenu-dd').classList.remove('show')">Remove</div></div></div></td>
                        </tr>
                    </tbody>
                </table>
                </div>
            </div>

            <div class="card">
                <div class="card-head">Pending invitations</div>
                <div class="card-sub">Invitations that haven't been accepted yet.</div>
                <table class="data-table">
                    <thead><tr><th>Invited</th><th>Role</th><th>Sent</th><th>Expires</th><th></th></tr></thead>
                    <tbody>
                        <tr>
                            <td><div class="name-cell">new@example.com</div><div class="sub-cell">Via email</div></td>
                            <td><span class="badge badge-info">è´¢åŠ¡</span></td>
                            <td style="color:var(--text-muted);">2024-12-01</td>
                            <td><span class="badge badge-warning">5 days left</span></td>
                            <td><button class="btn btn-ghost btn-sm" onclick="toast('Invitation cancelled','inf')">Cancel</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- MENU ACCESS TAB -->
        <div class="tab-panel" id="tp-menus">
            <div class="card">
                <div class="card-head">Menu access by role</div>
                <div class="card-sub">Which menus each role can see. âœ… = visible, âŒ = hidden. Owner can see all menus.</div>
                <div style="overflow-x:auto;">
                <table class="data-table" style="font-size:12px;">
                    <thead>
                        <tr><th style="min-width:160px;">Menu</th><th style="text-align:center;">Owner</th><th style="text-align:center;">ç®¡ç†å‘˜</th><th style="text-align:center;">è´¢åŠ¡</th><th style="text-align:center;">è¿è¥</th></tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="5" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">ASSETS</td></tr>
                        <tr><td>Fiat Accounts</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td></tr>
                        <tr><td>Crypto Wallet</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td></tr>
                        <tr><td>Exchange</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td></tr>

                        <tr><td colspan="5" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">TRANSFER IN</td></tr>
                        <tr><td>Collection Tools</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td><td class="center">âœ…</td></tr>
                        <tr><td>Remitter</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td><td class="center">âœ…</td></tr>
                        <tr><td>Payins</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td></tr>
                        <tr><td>Crypto Receive</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td></tr>

                        <tr><td colspan="5" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">CHECKOUT</td></tr>
                        <tr><td>Online Payment</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td><td class="center">âœ…</td></tr>
                        <tr><td>Invoice</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td><td class="center">âœ…</td></tr>
                        <tr><td>Subscription</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td><td class="center">âœ…</td></tr>

                        <tr><td colspan="5" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">TRANSFER OUT</td></tr>
                        <tr><td>Beneficiary</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td></tr>
                        <tr><td>Payouts</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td></tr>
                        <tr><td>Crypto Send</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td></tr>
                        <tr><td>Remittance Orders</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td></tr>

                        <tr><td colspan="5" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">CARDS</td></tr>
                        <tr><td>Cards Management</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td><td class="center">âœ…</td></tr>
                        <tr><td>Card Transactions</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td><td class="center">âœ…</td></tr>

                        <tr><td colspan="5" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">OTHER</td></tr>
                        <tr><td>Reports</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td></tr>
                        <tr><td>Downloads</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td></tr>
                        <tr><td>Trade Documents</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td></tr>
                        <tr><td>Developer (API/Webhooks)</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td><td class="center">âŒ</td></tr>
                        <tr><td>Settings</td><td class="center">âœ…</td><td class="center">âœ…</td><td class="center">âŒ</td><td class="center">âŒ</td></tr>
                    </tbody>
                </table>
                </div>
            </div>

            <div class="card" style="background:var(--bg);border:none;">
                <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;">
                    <strong>Menu access design principles:</strong><br>
                    â€¢ <strong>ç®¡ç†å‘˜</strong> = ç­‰åŒOwnerçš„èœå•å¯è§èŒƒå›´ï¼ˆä½†ä¸èƒ½ç®¡äººï¼‰<br>
                    â€¢ <strong>è´¢åŠ¡</strong> = èµ„é‡‘ç›¸å…³ï¼ˆAssets + å‡ºå…¥é‡‘äº¤æ˜“ + Reports + Trade Docsï¼‰ï¼Œä¸ç¢°ä¸šåŠ¡è¿è¥<br>
                    â€¢ <strong>è¿è¥</strong> = ä¸šåŠ¡ç›¸å…³ï¼ˆæ”¶æ¬¾å·¥å…· + Checkout + Cards + Reportsï¼‰ï¼Œä¸ç¢°èµ„é‡‘<br>
                    â€¢ <strong>Reports/Downloads</strong> = æ‰€æœ‰è§’è‰²å¯è§ï¼ˆå„è§’è‰²åªçœ‹åˆ°è‡ªå·±æƒé™èŒƒå›´å†…çš„æ•°æ®ï¼‰<br>
                    â€¢ <strong>Payins/Crypto Receive</strong> = è´¢åŠ¡å’Œè¿è¥éƒ½å¯è§ï¼ˆå…¥é‡‘æ˜¯äº¤å‰é¢†åŸŸï¼‰
                </div>
            </div>
        </div>

        <!-- OPERATIONS TAB -->
        <div class="tab-panel" id="tp-operations">
            <div class="card">
                <div class="card-head">Operation permissions</div>
                <div class="card-sub">Configure whether each user verifies with their own credential (Self) or requires Owner verification (Owner) for sensitive operations. <strong>Click badges to toggle.</strong></div>
                <div style="overflow-x:auto;">
                <table class="perm-matrix">
                    <thead><tr><th style="min-width:120px;">User</th><th>Initiate<br>transaction</th><th>Fund<br>operations</th><th>Merchant<br>config</th></tr></thead>
                    <tbody>
                        <tr>
                            <td><div class="name-cell">æå››</div><div class="sub-cell">ç®¡ç†å‘˜</div></td>
                            <td><span class="perm-badge perm-self" onclick="togglePerm(this)">Self</span></td>
                            <td><span class="perm-badge perm-self" onclick="togglePerm(this)">Self</span></td>
                            <td><span class="perm-badge perm-owner" onclick="togglePerm(this)">Owner</span></td>
                        </tr>
                        <tr>
                            <td><div class="name-cell">ç‹äº”</div><div class="sub-cell">è´¢åŠ¡</div></td>
                            <td><span class="perm-badge perm-self" onclick="togglePerm(this)">Self</span></td>
                            <td><span class="perm-badge perm-owner" onclick="togglePerm(this)">Owner</span></td>
                            <td><span class="perm-badge perm-owner" onclick="togglePerm(this)">Owner</span></td>
                        </tr>
                        <tr>
                            <td><div class="name-cell">èµµå…­</div><div class="sub-cell">è¿è¥</div></td>
                            <td><span class="perm-badge perm-owner" onclick="togglePerm(this)">Owner</span></td>
                            <td><span class="perm-badge perm-owner" onclick="togglePerm(this)">Owner</span></td>
                            <td><span class="perm-badge perm-owner" onclick="togglePerm(this)">Owner</span></td>
                        </tr>
                    </tbody>
                </table>
                </div>
                <div class="form-hint mt-12">
                    <strong>Self</strong> = User verifies with their own email/mobile/2FA. <strong>Owner</strong> = Verification code sent to Owner's mobile. New members default to Owner for all operations.
                </div>
            </div>

            <div class="card">
                <div class="card-head">Operation categories explained</div>
                <div class="card-sub">What each permission category covers.</div>
                <div class="icon-row">
                    <div class="icon-box" style="background:#dbeafe;">ğŸ’¸</div>
                    <div class="icon-row-body">
                        <div class="icon-row-name" style="color:#2563eb;">Initiate transaction</div>
                        <div class="icon-row-desc">Payins, Payouts, Crypto Send/Receive, Remittance Orders, Exchange, Checkout orders</div>
                    </div>
                </div>
                <div class="icon-row">
                    <div class="icon-box" style="background:#fef3c7;">ğŸ”</div>
                    <div class="icon-row-body">
                        <div class="icon-row-name" style="color:#d97706;">Fund operations</div>
                        <div class="icon-row-desc">Deposit, Withdrawal, Internal transfer, Card top-up, Large amount transfers</div>
                    </div>
                </div>
                <div class="icon-row">
                    <div class="icon-box" style="background:#e0e7ff;">âš™ï¸</div>
                    <div class="icon-row-body">
                        <div class="icon-row-name" style="color:#4f46e5;">Merchant config</div>
                        <div class="icon-row-desc">Webhook settings, API keys, Notification preferences, Company profile changes</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- DATA ACCESS TAB -->
        <div class="tab-panel" id="tp-data">
            <div class="card" style="background:var(--primary-light);border-color:var(--primary);border-style:dashed;">
                <div style="font-size:13px;color:var(--primary);font-weight:500;line-height:1.6;">
                    <strong>Data access = who can see what data.</strong> By default, all members see all data within their menu scope. Owner/ç®¡ç†å‘˜ can restrict members to only see data assigned to them.
                </div>
            </div>

            <div class="card">
                <div class="card-head">Data access model</div>
                <div class="card-sub">Two dimensions of data access control. Region-based access is planned for a future release.</div>

                <div class="icon-row">
                    <div class="icon-box" style="background:var(--success-bg);">ğŸ‘¤</div>
                    <div class="icon-row-body">
                        <div class="icon-row-name" style="color:var(--success-text);">Ownership-based <span class="badge badge-success">This release</span></div>
                        <div class="icon-row-desc">
                            Members only see data <strong>assigned to them</strong>. Owner/ç®¡ç†å‘˜ assigns data ownership per module.<br>
                            Example: è´¢åŠ¡A only sees Payouts she initiated; è¿è¥B only sees his assigned Collection Tools and related Payins.
                        </div>
                    </div>
                </div>
                <div class="icon-row">
                    <div class="icon-box" style="background:#f1f3f5;">ğŸŒ</div>
                    <div class="icon-row-body">
                        <div class="icon-row-name" style="color:var(--text-muted);">Region-based <span class="badge badge-muted">Future release</span></div>
                        <div class="icon-row-desc" style="color:var(--text-muted);">
                            Members only see data from <strong>assigned regions</strong>. E.g., è¿è¥A sees Asia data, è¿è¥B sees Europe data.<br>
                            Not available in this version.
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="flex-between" style="margin-bottom:16px;">
                    <div><div class="card-head">Data ownership settings</div><div class="card-sub" style="margin-bottom:0;">Configure which members can see which data in each module.</div></div>
                </div>

                <div class="alert alert-info" style="margin-bottom:16px;">
                    <span class="alert-icon">ğŸ’¡</span>
                    <div>
                        <strong>Rules:</strong><br>
                        â€¢ <strong>Owner</strong> always sees all data (cannot be restricted)<br>
                        â€¢ <strong>ç®¡ç†å‘˜</strong> sees all data by default, but can be restricted by Owner<br>
                        â€¢ <strong>è´¢åŠ¡/è¿è¥</strong> default to "Own data only" â€” Owner can expand to "All data"<br>
                        â€¢ Data created by a user is automatically assigned to that user
                    </div>
                </div>

                <div style="overflow-x:auto;">
                <table class="data-table" style="font-size:12px;">
                    <thead>
                        <tr><th style="min-width:140px;">Module</th><th style="text-align:center;">æå››<br><span style="font-weight:400;text-transform:none;letter-spacing:0;">ç®¡ç†å‘˜</span></th><th style="text-align:center;">ç‹äº”<br><span style="font-weight:400;text-transform:none;letter-spacing:0;">è´¢åŠ¡</span></th><th style="text-align:center;">èµµå…­<br><span style="font-weight:400;text-transform:none;letter-spacing:0;">è¿è¥</span></th></tr>
                    </thead>
                    <tbody>
                        <tr><td colspan="4" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">ASSETS</td></tr>
                        <tr>
                            <td>Fiat Accounts</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                        </tr>
                        <tr>
                            <td>Crypto Wallet</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                        </tr>
                        <tr>
                            <td>Exchange</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                        </tr>

                        <tr><td colspan="4" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">TRANSFER IN</td></tr>
                        <tr>
                            <td>Collection Tools</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                        </tr>
                        <tr>
                            <td>Payins</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                        </tr>
                        <tr>
                            <td>Crypto Receive</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                        </tr>

                        <tr><td colspan="4" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">CHECKOUT</td></tr>
                        <tr>
                            <td>Online Payment</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                        </tr>
                        <tr>
                            <td>Invoice</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                        </tr>
                        <tr>
                            <td>Subscription</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                        </tr>

                        <tr><td colspan="4" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">TRANSFER OUT</td></tr>
                        <tr>
                            <td>Beneficiary</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                        </tr>
                        <tr>
                            <td>Payouts</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                        </tr>
                        <tr>
                            <td>Crypto Send</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                        </tr>
                        <tr>
                            <td>Remittance Orders</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                        </tr>

                        <tr><td colspan="4" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">CARDS</td></tr>
                        <tr>
                            <td>Cards Management</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                        </tr>
                        <tr>
                            <td>Card Transactions</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="badge badge-muted" style="font-size:10px;">â€”</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                        </tr>

                        <tr><td colspan="4" style="font-weight:600;color:var(--text-primary);background:var(--bg);font-size:11px;text-transform:uppercase;letter-spacing:0.5px;">REPORTS</td></tr>
                        <tr>
                            <td>Reports</td>
                            <td class="center"><span class="perm-badge perm-self" onclick="toggleData(this)" style="font-size:10px;">All</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                            <td class="center"><span class="perm-badge perm-owner" onclick="toggleData(this)" style="font-size:10px;">Own</span></td>
                        </tr>
                    </tbody>
                </table>
                </div>
                <div class="form-hint mt-12">
                    <strong>All</strong> = Can see all data in this module. <strong>Own</strong> = Can only see data assigned to / created by this user. <strong>â€”</strong> = No menu access (controlled by Menu Access tab). Click badges to toggle.
                </div>
            </div>

            <div class="card">
                <div class="card-head">Data assignment example</div>
                <div class="card-sub">How Owner assigns specific data to a member. This can be done from each module's list page.</div>

                <div style="background:var(--bg);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
                    <div style="font-size:12px;color:var(--text-muted);margin-bottom:8px;">Scenario: Assign Collection Tools to è¿è¥ èµµå…­</div>
                    <div style="background:var(--white);border:1px solid var(--border);border-radius:6px;padding:16px;">
                        <div style="font-size:13px;font-weight:600;margin-bottom:12px;">Collection Tools â†’ Assign ownership</div>
                        <table class="data-table" style="font-size:12px;">
                            <thead><tr><th>Tool</th><th>Type</th><th>Current owner</th><th>Action</th></tr></thead>
                            <tbody>
                                <tr>
                                    <td><div class="name-cell">VA-001 (USD)</div><div class="sub-cell">Bank of China</div></td>
                                    <td>Virtual Account</td>
                                    <td><span class="badge badge-muted">Unassigned</span></td>
                                    <td><select class="form-select" style="width:auto;padding:3px 6px;font-size:11px;" onchange="toast('Assigned to '+this.value,'ok')"><option value="">â€”</option><option value="èµµå…­">èµµå…­ (è¿è¥)</option><option value="æå››">æå›› (ç®¡ç†å‘˜)</option></select></td>
                                </tr>
                                <tr>
                                    <td><div class="name-cell">VA-002 (EUR)</div><div class="sub-cell">HSBC</div></td>
                                    <td>Virtual Account</td>
                                    <td><span class="badge badge-primary">èµµå…­</span></td>
                                    <td><select class="form-select" style="width:auto;padding:3px 6px;font-size:11px;" onchange="toast('Reassigned to '+this.value,'ok')"><option value="èµµå…­" selected>èµµå…­ (è¿è¥)</option><option value="æå››">æå›› (ç®¡ç†å‘˜)</option><option value="">â€” Unassign</option></select></td>
                                </tr>
                                <tr>
                                    <td><div class="name-cell">ADDR-001</div><div class="sub-cell">0x1a2b...3c4d (USDT-TRC20)</div></td>
                                    <td>Crypto Address</td>
                                    <td><span class="badge badge-muted">Unassigned</span></td>
                                    <td><select class="form-select" style="width:auto;padding:3px 6px;font-size:11px;" onchange="toast('Assigned to '+this.value,'ok')"><option value="">â€”</option><option value="èµµå…­">èµµå…­ (è¿è¥)</option><option value="æå››">æå›› (ç®¡ç†å‘˜)</option></select></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="alert alert-info">
                    <span class="alert-icon">ğŸ’¡</span>
                    <div>
                        <strong>Assignment rules:</strong><br>
                        â€¢ Only <strong>Owner</strong> and <strong>ç®¡ç†å‘˜</strong> can assign data ownership<br>
                        â€¢ <strong>Unassigned data</strong> is visible to all members who have menu access<br>
                        â€¢ Data <strong>created by a user</strong> is auto-assigned to that user<br>
                        â€¢ Assignment can be done from each module's list page via an "Assign" column or bulk action<br>
                        â€¢ Related data follows: assigning a Collection Tool also assigns its related Payins to the same user
                    </div>
                </div>
            </div>

            <div class="card" style="background:var(--bg);border:none;">
                <div style="font-size:13px;color:var(--text-secondary);line-height:1.7;">
                    <strong>Data access design principles:</strong><br>
                    â€¢ <strong>3å±‚æƒé™æ¨¡å‹</strong>ï¼šèœå•æƒé™ï¼ˆèƒ½çœ‹åˆ°å“ªäº›é¡µé¢ï¼‰â†’ æ•°æ®æƒé™ï¼ˆèƒ½çœ‹åˆ°å“ªäº›æ•°æ®ï¼‰â†’ æ“ä½œæƒé™ï¼ˆèƒ½åšä»€ä¹ˆæ“ä½œï¼‰<br>
                    â€¢ <strong>èœå•æƒé™</strong> = è§’è‰²å†³å®šï¼ˆè´¢åŠ¡/ç®¡ç†å‘˜/è¿è¥ï¼‰ï¼Œä¸å¯è‡ªå®šä¹‰<br>
                    â€¢ <strong>æ•°æ®æƒé™</strong> = å½’å±äººåˆ†é…ï¼ˆAll/Ownï¼‰ï¼ŒOwnerå¯é…ç½®<br>
                    â€¢ <strong>æ“ä½œæƒé™</strong> = Self/OwneréªŒè¯ï¼ŒOwnerå¯é…ç½®<br>
                    â€¢ <strong>åœ°åŒºç»´åº¦</strong> = æœ¬æœŸä¸åšï¼Œæœªæ¥å¯åœ¨æ•°æ®æƒé™å±‚å¢åŠ åœ°åŒºè¿‡æ»¤
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========== MODULE: INVITE FLOW ========== -->
<div class="module" id="mod-invite">
    <div class="page-layout" style="max-width:560px;">
        <h2 style="margin-bottom:6px;">Invite Member Flow</h2>
        <p style="font-size:14px;color:var(--text-muted);margin-bottom:24px;">Step-by-step invitation process with security edge cases.</p>

        <!-- Step 1: Owner sends invite -->
        <div class="flow-step on" id="inv-1">
            <div class="steps">
                <div class="step-dot active">1</div><div class="step-bar"></div>
                <div class="step-dot">2</div><div class="step-bar"></div>
                <div class="step-dot">3</div><div class="step-bar"></div>
                <div class="step-dot">4</div>
            </div>
            <div class="card">
                <h3 style="margin-bottom:4px;">Step 1: Send invitation</h3>
                <p class="text-muted text-sm mb-16">Owner invites a new member to join ABC Trading (MID-001).</p>

                <div class="form-group">
                    <label class="form-label">Invite via</label>
                    <div class="toggle-group">
                        <div class="toggle-btn active" id="invTypeEmail" onclick="setInvType('email')">ğŸ“§ Email</div>
                        <div class="toggle-btn" id="invTypeMobile" onclick="setInvType('mobile')">ğŸ“± Mobile</div>
                    </div>
                </div>

                <div id="invEmailField">
                    <div class="form-group">
                        <label class="form-label">Email address</label>
                        <input class="form-input" id="invAddr" placeholder="user@example.com" value="li@new.com">
                    </div>
                </div>
                <div id="invMobileField" style="display:none;">
                    <div class="form-group">
                        <label class="form-label">Mobile number</label>
                        <div class="input-row">
                            <select class="form-select" style="width:100px;">
                                <option>ğŸ‡¨ğŸ‡³ +86</option>
                                <option>ğŸ‡­ğŸ‡° +852</option>
                                <option>ğŸ‡ºğŸ‡¸ +1</option>
                            </select>
                            <input class="form-input" placeholder="Phone number">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Role</label>
                    <select class="form-select" id="invRole">
                        <option value="è¿è¥">è¿è¥ (Operations) â€” Default for new members</option>
                        <option value="è´¢åŠ¡">è´¢åŠ¡ (Finance)</option>
                        <option value="ç®¡ç†å‘˜">ç®¡ç†å‘˜ (Admin)</option>
                    </select>
                </div>

                <div class="alert alert-info">
                    <span class="alert-icon">ğŸ”’</span>
                    <div>
                        <strong>Invitation security rules:</strong><br>
                        â€¢ Invitation link expires in <strong>7 days</strong><br>
                        â€¢ Link can only be used <strong>once</strong><br>
                        â€¢ Owner receives notification when invitation is accepted<br>
                        â€¢ New member defaults to <strong>Owner verification</strong> for all sensitive operations
                    </div>
                </div>

                <button class="btn btn-primary btn-full" onclick="invStep2()">Send invitation</button>
            </div>
        </div>

        <!-- Step 2: Invitation sent -->
        <div class="flow-step" id="inv-2">
            <div class="steps">
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot active">2</div><div class="step-bar"></div>
                <div class="step-dot">3</div><div class="step-bar"></div>
                <div class="step-dot">4</div>
            </div>
            <div class="card">
                <div class="center mb-16">
                    <div style="width:52px;height:52px;margin:0 auto;background:var(--success-bg);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px;">ğŸ“¨</div>
                </div>
                <h3 class="center">Invitation sent!</h3>
                <p class="center text-muted text-sm mt-8 mb-16">An invitation email has been sent to <strong id="inv2Target">li@new.com</strong></p>

                <div style="background:var(--bg);border-radius:var(--radius);padding:16px;margin-bottom:16px;">
                    <div style="font-size:12px;color:var(--text-muted);margin-bottom:8px;">Email preview:</div>
                    <div style="background:var(--white);border:1px solid var(--border);border-radius:6px;padding:16px;">
                        <div style="font-size:11px;color:var(--text-muted);">From: EX Platform &lt;noreply@ex.com&gt;</div>
                        <div style="font-size:11px;color:var(--text-muted);margin-bottom:8px;">To: <span id="inv2Email">li@new.com</span></div>
                        <div style="font-size:14px;font-weight:600;margin-bottom:8px;">You've been invited to join ABC Trading</div>
                        <div style="font-size:13px;color:var(--text-secondary);line-height:1.6;">
                            å¼ ä¸‰ has invited you to join <strong>ABC Trading</strong> as <strong id="inv2Role">è¿è¥</strong> on EX Platform.<br><br>
                            Click the button below to accept the invitation.
                        </div>
                        <div style="margin-top:12px;"><button class="btn btn-primary btn-sm" onclick="invStep3()">Accept invitation â†’</button></div>
                    </div>
                </div>
                <div class="form-hint">Expires in 7 days. <a class="link" onclick="toast('Link copied','ok')">Copy invite link</a></div>
            </div>
        </div>

        <!-- Step 3: User clicks link -->
        <div class="flow-step" id="inv-3">
            <div class="steps">
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot active">3</div><div class="step-bar"></div>
                <div class="step-dot">4</div>
            </div>

            <!-- 3A: Not registered -->
            <div id="inv3-new" style="display:none;">
                <div class="alert alert-warning">
                    <span class="alert-icon">âš ï¸</span>
                    <div><strong>No account found</strong> for li@new.com. You need to create an account first to join ABC Trading.</div>
                </div>
                <div class="card">
                    <h3>Create your account</h3>
                    <p class="mdesc">Register to accept the invitation from ABC Trading.</p>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input class="form-input" value="li@new.com" disabled style="background:var(--bg);">
                        <div class="form-hint">Pre-filled from invitation</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Verification code</label>
                        <div class="input-row">
                            <input class="form-input" placeholder="6-digit code">
                            <button class="btn btn-secondary btn-sm" onclick="toast('Code sent to li@new.com','inf')">Send code</button>
                        </div>
                    </div>
                    <div class="alert alert-info" style="margin-bottom:16px;">
                        <span class="alert-icon">ğŸ’¡</span>
                        <div>Already have an account? <a class="link" onclick="toast('Redirecting to login...','inf')">Sign in with existing account</a> to accept this invitation.</div>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="invStep4()">Create account & join</button>
                </div>
            </div>

            <!-- 3B: Already registered -->
            <div id="inv3-existing" style="display:none;">
                <div class="alert alert-success">
                    <span class="alert-icon">âœ…</span>
                    <div><strong>Account found!</strong> wang@test.com is already registered. Sign in to accept the invitation.</div>
                </div>
                <div class="card">
                    <h3>Sign in to accept</h3>
                    <p class="mdesc">Verify your identity to join ABC Trading.</p>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input class="form-input" value="wang@test.com" disabled style="background:var(--bg);">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Verification code</label>
                        <div class="input-row">
                            <input class="form-input" placeholder="6-digit code">
                            <button class="btn btn-secondary btn-sm" onclick="toast('Code sent','inf')">Send code</button>
                        </div>
                    </div>
                    <button class="btn btn-primary btn-full" onclick="invStep4()">Verify & join</button>
                </div>
            </div>
        </div>

        <!-- Step 4: Success -->
        <div class="flow-step" id="inv-4">
            <div class="steps">
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot done">âœ“</div>
            </div>
            <div class="card">
                <div class="center">
                    <div style="font-size:48px;margin-bottom:12px;">ğŸ‰</div>
                    <h2>Welcome to ABC Trading!</h2>
                    <p class="text-muted mt-8" style="font-size:14px;">You have joined as <strong id="inv4Role">è¿è¥</strong>. You can now access the Merchant Portal.</p>
                    <div style="background:var(--bg);border-radius:var(--radius);padding:16px;margin:20px 0;text-align:left;">
                        <div style="font-size:12px;color:var(--text-muted);margin-bottom:8px;">Your access:</div>
                        <div id="inv4Access" style="font-size:13px;color:var(--text-secondary);line-height:1.8;"></div>
                    </div>
                    <div class="alert alert-info" style="text-align:left;">
                        <span class="alert-icon">ğŸ”’</span>
                        <div>All sensitive operations require <strong>Owner verification</strong> by default. The Owner can authorize you to use Self verification later.</div>
                    </div>
                    <button class="btn btn-primary mt-16" onclick="toast('Entering Merchant Portal...','ok')">Enter Merchant Portal â†’</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========== MODULE: ACCOUNT MERGE ========== -->
<div class="module" id="mod-merge">
    <div class="page-layout" style="max-width:560px;">
        <h2 style="margin-bottom:6px;">Credential Merge Flow</h2>
        <p style="font-size:14px;color:var(--text-muted);margin-bottom:24px;">When binding a phone number that belongs to another User account. <strong>This merges login credentials on the User level â€” MIDs remain separate.</strong></p>

        <div class="flow-step on" id="merge-1">
            <div class="steps">
                <div class="step-dot active">1</div><div class="step-bar"></div>
                <div class="step-dot">2</div><div class="step-bar"></div>
                <div class="step-dot">3</div><div class="step-bar"></div>
                <div class="step-dot">4</div>
            </div>
            <div class="card">
                <h3>Step 1: Bind mobile number</h3>
                <p class="mdesc">You registered via email (li@new.com). Now you want to add a mobile number.</p>
                <div class="form-group">
                    <label class="form-label">Current account</label>
                    <input class="form-input" value="li@new.com (no mobile)" disabled style="background:var(--bg);">
                </div>
                <div class="form-group">
                    <label class="form-label">Mobile number to bind</label>
                    <div class="input-row">
                        <select class="form-select" style="width:100px;"><option>ğŸ‡¨ğŸ‡³ +86</option></select>
                        <input class="form-input" value="138 0000 1234">
                    </div>
                </div>
                <button class="btn btn-primary btn-full" onclick="mergeStep2()">Bind mobile</button>
            </div>
        </div>

        <div class="flow-step" id="merge-2">
            <div class="steps">
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot active">2</div><div class="step-bar"></div>
                <div class="step-dot">3</div><div class="step-bar"></div>
                <div class="step-dot">4</div>
            </div>
            <div class="alert alert-danger">
                <span class="alert-icon">âš ï¸</span>
                <div>
                    <strong>Phone number conflict detected!</strong><br>
                    +86 138 0000 1234 is already bound to another account (<strong>zhang@old.com</strong>).
                </div>
            </div>
            <div class="card">
                <h3>What would you like to do?</h3>
                <p class="mdesc">This phone number belongs to another account. Choose how to proceed.</p>
                <div class="scenario-card" onclick="mergeStep3()" style="border-color:var(--primary);">
                    <strong style="color:var(--primary);">ğŸ”— Merge login credentials</strong>
                    <div class="sc-desc">Merge both User accounts into one. <strong>Only login credentials are merged</strong> (email + phone bound to same User). Each User's MIDs remain separate â€” you'll see all MIDs in the MID switcher after merge.</div>
                </div>
                <div class="scenario-card" onclick="toast('Use a different phone number','inf')">
                    <strong>ğŸ“± Use a different number</strong>
                    <div class="sc-desc">Cancel and bind a different mobile number instead.</div>
                </div>
                <div class="scenario-card" onclick="toast('Contact support for help','inf')">
                    <strong class="text-muted">â“ Not my account</strong>
                    <div class="sc-desc">If you don't recognize the other account, contact support.</div>
                </div>
            </div>
        </div>

        <div class="flow-step" id="merge-3">
            <div class="steps">
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot active">3</div><div class="step-bar"></div>
                <div class="step-dot">4</div>
            </div>
            <div class="card">
                <h3>Verify both accounts</h3>
                <p class="mdesc">To merge, you must verify ownership of both accounts.</p>

                <div style="background:var(--bg);border-radius:var(--radius);padding:14px;margin-bottom:16px;">
                    <div style="font-size:12px;color:var(--text-muted);margin-bottom:6px;">Account A (current)</div>
                    <div style="font-size:14px;font-weight:500;">li@new.com</div>
                    <div class="badge badge-success mt-8">âœ“ Verified (current session)</div>
                </div>

                <div style="background:var(--bg);border-radius:var(--radius);padding:14px;margin-bottom:16px;">
                    <div style="font-size:12px;color:var(--text-muted);margin-bottom:6px;">Account B (to merge)</div>
                    <div style="font-size:14px;font-weight:500;">zhang@old.com Â· +86 138 0000 1234</div>
                </div>

                <div class="form-group">
                    <label class="form-label">Verify Account B â€” Code sent to +86 138****1234</label>
                    <div class="input-row">
                        <input class="form-input" placeholder="6-digit code">
                        <button class="btn btn-secondary btn-sm" onclick="toast('Code sent to +86 138****1234','inf')">Send</button>
                    </div>
                </div>

                <div class="alert alert-warning">
                    <span class="alert-icon">âš ï¸</span>
                    <div>
                        <strong>Merge preview (credential-level only):</strong><br>
                        â€¢ <strong>Login credentials:</strong> li@new.com + +86 138 0000 1234 â†’ bound to same User<br>
                        â€¢ <strong>MIDs stay separate:</strong> Account A's MIDs + Account B's MIDs all appear in MID switcher<br>
                        â€¢ <strong>Roles unchanged:</strong> Your role in each MID is not affected<br>
                        â€¢ <strong>Account B's User deactivated:</strong> credentials transferred to Account A's User
                    </div>
                </div>

                <button class="btn btn-primary btn-full" onclick="mergeStep4()">Verify & merge accounts</button>
            </div>
        </div>

        <div class="flow-step" id="merge-4">
            <div class="steps">
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot done">âœ“</div><div class="step-bar done"></div>
                <div class="step-dot done">âœ“</div>
            </div>
            <div class="card">
                <div class="center">
                    <div style="font-size:48px;margin-bottom:12px;">âœ…</div>
                    <h2>Credentials merged!</h2>
                    <p class="text-muted mt-8" style="font-size:14px;">Both login credentials now belong to one User account. MIDs remain separate.</p>
                </div>
                <div style="background:var(--bg);border-radius:var(--radius);padding:16px;margin:20px 0;">
                    <div style="font-size:12px;color:var(--text-muted);margin-bottom:8px;">Your merged account:</div>
                    <div class="info-row"><div class="info-key">Email</div><div class="info-val">li@new.com <span class="badge badge-success">Primary</span></div></div>
                    <div class="info-row"><div class="info-key">Mobile</div><div class="info-val">+86 138 0000 1234 <span class="badge badge-success">Bound</span></div></div>
                    <div class="info-row"><div class="info-key">Old email</div><div class="info-val">zhang@old.com <span class="badge badge-muted">Also usable</span></div></div>
                    <div class="info-row"><div class="info-key">MIDs</div><div class="info-val">ABC Trading (Owner) + XYZ Corp (è´¢åŠ¡)</div></div>
                </div>
                <button class="btn btn-primary btn-full" onclick="goMod('scenarios',document.querySelectorAll('.header-nav-item')[0])">Back to scenarios</button>
            </div>
        </div>
    </div>
</div>

<!-- ========== MODALS ========== -->

<!-- Invite Modal (from permissions page) -->
<div class="overlay" id="mInvite"><div class="modal"><button class="modal-x" onclick="closeM('mInvite')">Ã—</button>
    <h3>Invite member</h3>
    <p class="mdesc">Invite a user to join <strong>ABC Trading</strong> (MID-001).</p>
    <div class="form-group">
        <label class="form-label">Invite via</label>
        <div class="toggle-group">
            <div class="toggle-btn active" onclick="this.parentElement.querySelectorAll('.toggle-btn').forEach(x=>x.classList.remove('active'));this.classList.add('active');">ğŸ“§ Email</div>
            <div class="toggle-btn" onclick="this.parentElement.querySelectorAll('.toggle-btn').forEach(x=>x.classList.remove('active'));this.classList.add('active');">ğŸ“± Mobile</div>
        </div>
    </div>
    <div class="form-group"><label class="form-label">Email / Mobile</label><input class="form-input" placeholder="user@example.com or +86 138xxxx"></div>
    <div class="form-group"><label class="form-label">Role</label>
        <select class="form-select">
            <option>è¿è¥ (Operations) â€” Default</option>
            <option>è´¢åŠ¡ (Finance)</option>
            <option>ç®¡ç†å‘˜ (Admin)</option>
        </select>
    </div>
    <button class="btn btn-primary btn-full" onclick="toast('Invitation sent!','ok');closeM('mInvite')">Send invitation</button>
</div></div>

<!-- Self Verification Modal -->
<div class="overlay" id="mOpSelf"><div class="modal"><button class="modal-x" onclick="closeM('mOpSelf')">Ã—</button>
    <div class="center mb-16"><div style="width:52px;height:52px;margin:0 auto;background:var(--success-bg);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px;">âœ…</div></div>
    <h3 class="center">Verify to continue</h3>
    <p class="mdesc center">You are <strong>authorized</strong> for this operation. A verification code has been sent to <strong>your mobile (+852 9641****)</strong>.</p>
    <div style="background:var(--bg);border-radius:var(--radius);padding:14px;margin-bottom:16px;">
        <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">Operation details</div>
        <div style="font-size:14px;font-weight:500;">Initiate Payout</div>
        <div style="font-size:13px;color:var(--text-secondary);">$5,000.00 USD â†’ Supplier Co.</div>
        <div style="font-size:12px;color:var(--text-muted);margin-top:4px;">Initiated by: ç‹äº” (è´¢åŠ¡) Â· Permission: <span class="badge badge-success" style="font-size:10px;">Self</span></div>
    </div>
    <div class="form-group"><label class="form-label">Verification code</label><div class="input-row"><input class="form-input" placeholder="6-digit code"><button class="btn btn-secondary btn-sm" onclick="toast('Code resent','inf')">Resend</button></div></div>
    <button class="btn btn-primary btn-full" onclick="toast('Operation confirmed!','ok');closeM('mOpSelf')">Confirm operation</button>
</div></div>

<!-- Owner Verification Modal -->
<div class="overlay" id="mOpOwner"><div class="modal"><button class="modal-x" onclick="closeM('mOpOwner')">Ã—</button>
    <div class="center mb-16"><div style="width:52px;height:52px;margin:0 auto;background:var(--warning-bg);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:24px;">âš ï¸</div></div>
    <h3 class="center">Owner verification required</h3>
    <p class="mdesc center">You are <strong>not authorized</strong> for this operation. A verification code has been sent to the <strong>Owner (å¼ ä¸‰, +86 138****1234)</strong>.</p>
    <div style="background:var(--bg);border-radius:var(--radius);padding:14px;margin-bottom:16px;">
        <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">Operation details</div>
        <div style="font-size:14px;font-weight:500;">Initiate Payout</div>
        <div style="font-size:13px;color:var(--text-secondary);">$5,000.00 USD â†’ Supplier Co.</div>
        <div style="font-size:12px;color:var(--text-muted);margin-top:4px;">Initiated by: èµµå…­ (è¿è¥) Â· Permission: <span class="badge badge-danger" style="font-size:10px;">Owner</span></div>
    </div>
    <div class="center" style="padding:16px 0;">
        <div style="font-size:14px;color:var(--text-secondary);margin-bottom:8px;">Waiting for Owner to verify...</div>
        <div style="font-size:12px;color:var(--text-muted);">Owner has been notified via SMS.</div>
        <div class="mt-12"><button class="btn btn-secondary btn-sm" onclick="toast('Notification resent to Owner','inf')">Resend to Owner</button></div>
    </div>
    <div style="border-top:1px solid var(--border-light);padding-top:14px;margin-top:8px;">
        <div class="form-hint mb-16">If the Owner is with you, they can enter the code here:</div>
        <div class="form-group"><div class="input-row"><input class="form-input" placeholder="Owner enters 6-digit code"><button class="btn btn-primary btn-sm" style="width:auto;" onclick="toast('Owner verified! Operation confirmed.','ok');closeM('mOpOwner')">Verify</button></div></div>
    </div>
</div></div>


<script>
// === Toast ===
function toast(msg,t){const el=document.getElementById('toast');el.textContent=msg;el.className='toast '+t+' show';setTimeout(()=>el.classList.remove('show'),2500);}

// === Navigation ===
function goMod(m,el){
    document.querySelectorAll('.module').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.header-nav-item').forEach(x=>x.classList.remove('active'));
    document.getElementById('mod-'+m).classList.add('active');
    if(el) el.classList.add('active');
    // show header elements
    document.getElementById('hAvatar').style.display='flex';
    document.getElementById('portalSw').style.display='block';
    document.getElementById('accountSw').style.display='block';
}

// === Portal Switcher ===
function togglePortalDD(){ document.getElementById('portalDD').classList.toggle('show'); }
function switchPortal(code,name,color){
    document.getElementById('portalIcon').style.background=color;
    document.getElementById('portalIcon').textContent=code;
    document.getElementById('portalName').textContent=name;
    document.getElementById('portalDD').classList.remove('show');
    toast('Switched to '+name,'ok');
}

// === Account Switcher ===
function toggleAccountDD(){ document.getElementById('accountDD').classList.toggle('show'); }
function pickMID(name,role){
    document.getElementById('accountName').textContent=name;
    document.getElementById('accountDD').classList.remove('show');
    toast('Switched to '+name+' ('+role+')','ok');
}

// Close dropdowns on outside click
document.addEventListener('click',e=>{
    if(!e.target.closest('.portal-switcher')) document.getElementById('portalDD').classList.remove('show');
    if(!e.target.closest('.account-sw')) document.getElementById('accountDD').classList.remove('show');
    if(!e.target.closest('.dotmenu')) document.querySelectorAll('.dotmenu-dd').forEach(d=>d.classList.remove('show'));
});

// === Modals ===
function openM(id){document.getElementById(id).classList.add('show');}
function closeM(id){document.getElementById(id).classList.remove('show');}
document.querySelectorAll('.overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('show');}));

// === Dot Menu ===
function toggleDM(btn){const dd=btn.nextElementSibling;document.querySelectorAll('.dotmenu-dd').forEach(d=>{if(d!==dd)d.classList.remove('show');});dd.classList.toggle('show');}

// === Data Access Toggle ===
function toggleData(el){
    if(el.textContent==='All'){
        el.textContent='Own';el.className='perm-badge perm-owner';el.style.fontSize='10px';
        toast('Changed to Own data only','inf');
    } else {
        el.textContent='All';el.className='perm-badge perm-self';el.style.fontSize='10px';
        toast('Changed to All data','ok');
    }
}

// === Permission Toggle ===
function togglePerm(el){
    if(el.textContent==='Self'){
        el.textContent='Owner';el.className='perm-badge perm-owner';
        toast('Changed to Owner verification','inf');
    } else {
        el.textContent='Self';el.className='perm-badge perm-self';
        toast('Changed to Self verification','ok');
    }
}

// === Permissions Tabs ===
function permTab(t,el){
    document.querySelectorAll('#mod-permissions .tab-item').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('#mod-permissions .tab-panel').forEach(x=>x.classList.remove('on'));
    el.classList.add('active');
    document.getElementById('tp-'+t).classList.add('on');
}

// === Invite Flow ===
let invDemoType='email-new';
function setInvType(t){
    document.getElementById('invTypeEmail').classList.toggle('active',t==='email');
    document.getElementById('invTypeMobile').classList.toggle('active',t==='mobile');
    document.getElementById('invEmailField').style.display=t==='email'?'block':'none';
    document.getElementById('invMobileField').style.display=t==='mobile'?'block':'none';
}
function startInviteDemo(type){
    invDemoType=type;
    goMod('invite',document.querySelectorAll('.header-nav-item')[2]);
    // reset all steps
    document.querySelectorAll('#mod-invite .flow-step').forEach(x=>x.classList.remove('on'));
    document.getElementById('inv-1').classList.add('on');
    if(type==='email-existing'){
        document.getElementById('invAddr').value='wang@test.com';
    } else {
        document.getElementById('invAddr').value='li@new.com';
    }
}
function invStep2(){
    const addr=document.getElementById('invAddr').value;
    const role=document.getElementById('invRole').value;
    document.getElementById('inv2Target').textContent=addr;
    document.getElementById('inv2Email').textContent=addr;
    document.getElementById('inv2Role').textContent=role;
    showInvStep('inv-2');
    toast('Invitation sent to '+addr,'ok');
}
function invStep3(){
    showInvStep('inv-3');
    document.getElementById('inv3-new').style.display='none';
    document.getElementById('inv3-existing').style.display='none';
    if(invDemoType==='email-existing'){
        document.getElementById('inv3-existing').style.display='block';
    } else {
        document.getElementById('inv3-new').style.display='block';
    }
}
function invStep4(){
    const role=document.getElementById('invRole').value;
    document.getElementById('inv4Role').textContent=role;
    // show access based on role
    let access='';
    if(role==='ç®¡ç†å‘˜') access='All menus (same as Owner, except member management)';
    else if(role==='è´¢åŠ¡') access='Assets Â· Payins Â· Crypto Receive Â· Payouts Â· Crypto Send Â· Remittance Â· Reports Â· Trade Docs';
    else access='Collection Tools Â· Remitter Â· Payins Â· Crypto Receive Â· Checkout Â· Cards Â· Reports';
    document.getElementById('inv4Access').textContent=access;
    showInvStep('inv-4');
    toast('Successfully joined ABC Trading!','ok');
}
function showInvStep(id){
    document.querySelectorAll('#mod-invite .flow-step').forEach(x=>x.classList.remove('on'));
    document.getElementById(id).classList.add('on');
}

// === Merge Flow ===
function mergeStep2(){
    document.querySelectorAll('#mod-merge .flow-step').forEach(x=>x.classList.remove('on'));
    document.getElementById('merge-2').classList.add('on');
    toast('Phone number conflict detected!','err');
}
function mergeStep3(){
    document.querySelectorAll('#mod-merge .flow-step').forEach(x=>x.classList.remove('on'));
    document.getElementById('merge-3').classList.add('on');
}
function mergeStep4(){
    document.querySelectorAll('#mod-merge .flow-step').forEach(x=>x.classList.remove('on'));
    document.getElementById('merge-4').classList.add('on');
    toast('Accounts merged successfully!','ok');
}

// === Demo Portal Switch ===
function demoPortalSwitch(){
    document.getElementById('hAvatar').style.display='flex';
    document.getElementById('portalSw').style.display='block';
    document.getElementById('accountSw').style.display='block';
    togglePortalDD();
    toast('Click the portal switcher to switch between MP and TP','inf');
}
</script>
</body>
</html>
