<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXå¹³å°åŠŸèƒ½çŸ©é˜µ - æŒ‰ä¸šåŠ¡æµç¨‹</title>
    <style>
        :root {
            --primary: #4f46e5;
            --primary-hover: #4338ca;
            --primary-bg: #eef2ff;
            --success: #10b981;
            --success-bg: #d1fae5;
            --warning: #f59e0b;
            --warning-bg: #fef3c7;
            --danger: #ef4444;
            --danger-bg: #fee2e2;
            --bg: #f8fafc;
            --bg-card: #ffffff;
            --border: #e2e8f0;
            --text: #0f172a;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'SF Pro Display', 'PingFang SC', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; padding: 24px; }
        .container { max-width: 1600px; margin: 0 auto; }

        /* Header */
        .header { background: var(--bg-card); padding: 32px; border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 24px; }
        .header h1 { font-size: 26px; margin-bottom: 6px; }
        .header p { color: var(--text-secondary); font-size: 14px; }

        /* Tabs - æŒ‰ç«¯åˆ† */
        .tabs { background: var(--bg-card); border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 20px; padding: 6px; display: flex; gap: 6px; }
        .tab-btn { flex: 1; padding: 10px 20px; border: none; background: transparent; color: var(--text-secondary); font-size: 14px; font-weight: 600; border-radius: 8px; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .tab-btn:hover { background: var(--bg); color: var(--text); }
        .tab-btn.active { background: var(--primary); color: white; }
        .tab-badge { padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 700; background: rgba(0,0,0,0.06); }
        .tab-btn.active .tab-badge { background: rgba(255,255,255,0.25); }

        /* Flow filter */
        .flow-tabs { background: var(--bg-card); border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 20px; padding: 6px; display: flex; gap: 6px; flex-wrap: wrap; }
        .flow-btn { padding: 8px 18px; border: 1px solid var(--border); background: var(--bg-card); color: var(--text-secondary); font-size: 13px; font-weight: 500; border-radius: 8px; cursor: pointer; transition: all 0.2s; }
        .flow-btn:hover { border-color: var(--primary); color: var(--primary); }
        .flow-btn.active { background: var(--primary-bg); color: var(--primary); border-color: var(--primary); font-weight: 600; }

        /* Stats */
        .stats { display: grid; grid-template-columns: repeat(5, 1fr); gap: 16px; margin-bottom: 24px; }
        .stat-card { background: var(--bg-card); padding: 18px 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
        .stat-card h3 { font-size: 12px; color: var(--text-muted); margin-bottom: 4px; font-weight: 500; text-transform: uppercase; letter-spacing: 0.5px; }
        .stat-card .value { font-size: 28px; font-weight: 700; }

        /* Filters */
        .filters { background: var(--bg-card); padding: 16px 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); margin-bottom: 20px; display: flex; gap: 12px; flex-wrap: wrap; align-items: center; }
        .filter-group { display: flex; align-items: center; gap: 6px; }
        .filter-group label { font-size: 13px; color: var(--text-secondary); font-weight: 500; }
        .filter-group select, .filter-group input { padding: 7px 10px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px; background: white; color: var(--text); }
        .filter-group select:focus, .filter-group input:focus { outline: none; border-color: var(--primary); }
        .actions { margin-left: auto; display: flex; gap: 8px; }
        .btn { padding: 7px 14px; border: none; border-radius: 6px; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-secondary { background: white; color: var(--text); border: 1px solid var(--border); }
        .btn-secondary:hover { background: var(--bg); }

        /* Tab content */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Flow section */
        .flow-section { margin-bottom: 24px; }
        .flow-header { background: linear-gradient(135deg, var(--primary), #7c3aed); color: white; padding: 16px 24px; border-radius: 12px 12px 0 0; display: flex; align-items: center; gap: 12px; }
        .flow-header h2 { font-size: 16px; font-weight: 700; }
        .flow-number { background: rgba(255,255,255,0.2); width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 700; flex-shrink: 0; }
        .flow-desc { font-size: 12px; opacity: 0.8; margin-left: auto; }

        /* Table */
        .func-table-wrap { background: var(--bg-card); border-radius: 0 0 12px 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); overflow-x: auto; }
        .func-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .func-table thead { background: #f1f5f9; position: sticky; top: 0; z-index: 1; }
        .func-table th { padding: 12px 16px; text-align: left; font-weight: 600; color: var(--text-secondary); font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; border-bottom: 2px solid var(--border); white-space: nowrap; }
        .func-table td { padding: 10px 16px; border-bottom: 1px solid #f1f5f9; vertical-align: top; }
        .func-table tbody tr:hover { background: #f8fafc; }
        .func-table tbody tr:last-child td { border-bottom: none; }

        /* Tags */
        .tag { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; white-space: nowrap; }
        .tag-role-ex { background: #fef3c7; color: #92400e; }
        .tag-role-sp { background: #dbeafe; color: #1e40af; }
        .tag-role-tp { background: #d1fae5; color: #065f46; }
        .tag-role-merchant { background: #fce7f3; color: #9d174d; }
        .tag-ç«¯-sa { background: #f3e8ff; color: #6b21a8; }
        .tag-ç«¯-pp { background: #e0f2fe; color: #0369a1; }
        .tag-ç«¯-mp { background: #fce7f3; color: #9d174d; }
        .tag-center { background: #f1f5f9; color: var(--text-secondary); }

        /* Status */
        .status-select { padding: 3px 6px; border: 1px solid var(--border); border-radius: 4px; font-size: 11px; background: white; cursor: pointer; }

        /* Priority */
        .priority-badge { padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: 600; }
        .priority-P0 { background: #fee2e2; color: #dc2626; }
        .priority-P1 { background: #fef3c7; color: #d97706; }
        .priority-P2 { background: #dbeafe; color: #2563eb; }

        /* Merge cell helper */
        .merge-cell { font-weight: 600; color: var(--text); background: #fafbfc; }
        .func-list { margin: 0; padding: 0; list-style: none; }
        .func-list li { padding: 2px 0; display: flex; align-items: center; gap: 6px; }
        .func-list li::before { content: 'â€¢'; color: var(--primary); font-weight: bold; }
        .note { font-size: 12px; color: var(--text-muted); line-height: 1.5; }

        .empty-state { padding: 60px; text-align: center; color: var(--text-secondary); }

        @media (max-width: 1200px) {
            .stats { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>EXå¹³å°åŠŸèƒ½çŸ©é˜µ</h1>
        <p>æŒ‰ä¸šåŠ¡æµç¨‹æ¢³ç†å„ç«¯åŠŸèƒ½æ¸…å• â€” è§’è‰² / ç«¯ / ä¸­å¿ƒ / æ¨¡å— / èœå• / é¡µé¢ / åŠŸèƒ½ / è¯´æ˜</p>
    </div>

    <!-- æŒ‰ç«¯åˆ†Tab -->
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('all')" data-tab="all">
            <span>ğŸ“‹ å…¨éƒ¨</span><span class="tab-badge" id="all-count">0</span>
        </button>
        <button class="tab-btn" onclick="switchTab('SA')" data-tab="SA">
            <span>âš™ï¸ SA ç®¡ç†åå°</span><span class="tab-badge" id="SA-count">0</span>
        </button>
        <button class="tab-btn" onclick="switchTab('PP-SP')" data-tab="PP-SP">
            <span>ğŸ¦ PP (SP)</span><span class="tab-badge" id="PP-SP-count">0</span>
        </button>
        <button class="tab-btn" onclick="switchTab('PP-TP')" data-tab="PP-TP">
            <span>ğŸ¢ PP (TP)</span><span class="tab-badge" id="PP-TP-count">0</span>
        </button>
        <button class="tab-btn" onclick="switchTab('MP')" data-tab="MP">
            <span>ğŸª MP å•†æˆ·ç«¯</span><span class="tab-badge" id="MP-count">0</span>
        </button>
    </div>

    <!-- æŒ‰ä¸šåŠ¡æµç¨‹ç­›é€‰ -->
    <div class="flow-tabs" id="flowTabs">
        <button class="flow-btn active" onclick="switchFlow('all')">å…¨éƒ¨æµç¨‹</button>
        <button class="flow-btn" onclick="switchFlow('flow1')">ä¸€ã€æœåŠ¡å•†ç®¡ç†</button>
        <button class="flow-btn" onclick="switchFlow('flow2')">äºŒã€äº§å“ä¸Šæ¶</button>
        <button class="flow-btn" onclick="switchFlow('flow3')">ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦</button>
        <button class="flow-btn" onclick="switchFlow('flow4a')">å››ã€å•†æˆ·ç™»å½•æ³¨å†Œ</button>
        <button class="flow-btn" onclick="switchFlow('flow4b')">äº”ã€å•†æˆ·å¼€é€šäº§å“</button>
    </div>

    <div class="stats">
        <div class="stat-card"><h3>æ€»åŠŸèƒ½æ•°</h3><div class="value" id="totalCount">0</div></div>
        <div class="stat-card"><h3>SA åå°</h3><div class="value" id="saCount">0</div></div>
        <div class="stat-card"><h3>PP (SP)</h3><div class="value" id="spCount">0</div></div>
        <div class="stat-card"><h3>PP (TP)</h3><div class="value" id="tpCount">0</div></div>
        <div class="stat-card"><h3>MP å•†æˆ·</h3><div class="value" id="mpCount">0</div></div>
    </div>

    <div class="filters">
        <div class="filter-group">
            <label>æœç´¢</label>
            <input type="text" id="searchInput" placeholder="æœç´¢é¡µé¢/åŠŸèƒ½..." oninput="render()">
        </div>
        <div class="actions">
            <button class="btn btn-secondary" onclick="exportToCSV()">ğŸ“¥ å¯¼å‡ºCSV</button>
            <button class="btn btn-primary" onclick="expandAll()">å±•å¼€å…¨éƒ¨</button>
        </div>
    </div>

    <div id="mainContent"></div>
</div>

<script>
let currentTab = 'all';
let currentFlow = 'all';

// ========== åŠŸèƒ½æ•°æ® ==========
// æ¯æ¡: { flow, role, portal, center, module, menu, page, functions, note, priority }
const allFeatures = [

    // ===== ç¬¬ä¸€éƒ¨åˆ†ï¼šæœåŠ¡å•†ç®¡ç† =====
    { flow: 'flow1', flowLabel: 'ä¸€ã€æœåŠ¡å•†ç®¡ç†', role: 'EX', portal: 'SA', center: '/', module: 'æœåŠ¡å•†ç®¡ç†', menu: 'æœåŠ¡å•†ç®¡ç†', page: 'æœåŠ¡å•†ç®¡ç†ï¼ˆåˆ—è¡¨ï¼‰', functions: ['æ–°å¢æœåŠ¡å•†', 'æŸ¥çœ‹æœåŠ¡å•†è¯¦æƒ…', 'ç¼–è¾‘æœåŠ¡å•†ä¿¡æ¯'], note: 'EXè¿è¥åœ¨SAåå°ç®¡ç†æœåŠ¡å•†æ¡£æ¡ˆ', priority: 'P0' },

    // ===== ç¬¬äºŒéƒ¨åˆ†ï¼šäº§å“ä¸Šæ¶ =====
    // SPåœ¨PPä¸Šæ¶äº§å“
    { flow: 'flow2', flowLabel: 'äºŒã€äº§å“ä¸Šæ¶', role: 'SP', portal: 'PP-SP', center: 'äº§å“ä¸­å¿ƒ', module: 'äº§å“ç®¡ç†', menu: 'äº§å“ç®¡ç†', page: 'äº§å“ç®¡ç†ï¼ˆåˆ—è¡¨ï¼‰', functions: ['ä¸Šæ¶äº§å“', 'æŸ¥çœ‹äº§å“è¯¦æƒ…', 'äº§å“çŠ¶æ€å˜æ›´', 'ç¼–è¾‘äº§å“'], note: 'SPåœ¨PPç«¯ç®¡ç†è‡ªæœ‰äº§å“', priority: 'P0' },
    { flow: 'flow2', flowLabel: 'äºŒã€äº§å“ä¸Šæ¶', role: 'SP', portal: 'PP-SP', center: 'äº§å“ä¸­å¿ƒ', module: 'äº§å“ç®¡ç†', menu: 'äº§å“ç®¡ç†', page: 'ä¸Šæ¶äº§å“', functions: ['å¡«å†™äº§å“ä¿¡æ¯', 'é…ç½®äº§å“èƒ½åŠ›', 'è®¾ç½®äº§å“å®šä»·', 'æäº¤ä¸Šæ¶'], note: 'äº§å“ä¸Šæ¶è¡¨å•é¡µ', priority: 'P0' },

    // EXåœ¨SAç®¡ç†å¥—é¤å’Œä»£ç®¡ç†äº§å“
    { flow: 'flow2', flowLabel: 'äºŒã€äº§å“ä¸Šæ¶', role: 'EX', portal: 'SA', center: '/', module: 'äº§å“ä¸­å¿ƒ', menu: 'äº§å“ä¸­å¿ƒ - å¥—é¤ç®¡ç†', page: 'å¥—é¤ç®¡ç†', functions: ['æ–°å¢å¥—é¤', 'æŸ¥çœ‹å¥—é¤è¯¦æƒ…', 'ç¼–è¾‘å¥—é¤'], note: 'EXå®šä¹‰äº§å“å¥—é¤ç»„åˆ', priority: 'P0' },
    { flow: 'flow2', flowLabel: 'äºŒã€äº§å“ä¸Šæ¶', role: 'EX', portal: 'SA', center: '/', module: 'äº§å“ä¸­å¿ƒ', menu: 'äº§å“ä¸­å¿ƒ - å¥—é¤ç®¡ç†', page: 'æ–°å¢å¥—é¤', functions: ['é…ç½®å¥—é¤å†…å®¹', 'è®¾ç½®å¥—é¤å®šä»·', 'æäº¤'], note: 'æ–°å¢å¥—é¤è¡¨å•é¡µ', priority: 'P0' },
    { flow: 'flow2', flowLabel: 'äºŒã€äº§å“ä¸Šæ¶', role: 'EX', portal: 'SA', center: '/', module: 'äº§å“ä¸­å¿ƒ', menu: 'äº§å“ä¸­å¿ƒ - ä¸šåŠ¡äº§å“', page: 'äº§å“ç®¡ç†ï¼ˆåˆ—è¡¨ï¼‰', functions: ['ä¸Šæ¶äº§å“ï¼ˆä»£ç®¡ç†ï¼‰', 'æŸ¥çœ‹äº§å“è¯¦æƒ…', 'äº§å“çŠ¶æ€å˜æ›´', 'ç¼–è¾‘äº§å“'], note: 'EXä»£SPç®¡ç†äº§å“ä¸Šæ¶', priority: 'P0' },
    { flow: 'flow2', flowLabel: 'äºŒã€äº§å“ä¸Šæ¶', role: 'EX', portal: 'SA', center: '/', module: 'äº§å“ä¸­å¿ƒ', menu: 'äº§å“ä¸­å¿ƒ - ä¸šåŠ¡äº§å“', page: 'ä¸Šæ¶äº§å“', functions: ['å¡«å†™äº§å“ä¿¡æ¯', 'é…ç½®äº§å“èƒ½åŠ›', 'è®¾ç½®äº§å“å®šä»·', 'æäº¤ä¸Šæ¶'], note: 'ä»£ç®¡ç†ä¸Šæ¶è¡¨å•é¡µ', priority: 'P0' },

    // ===== ç¬¬ä¸‰éƒ¨åˆ†ï¼šç§Ÿæˆ·ç­¾çº¦ =====
    // SPé…ç½®åˆ†ä½£æ¨¡ç‰ˆ
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'SP', portal: 'PP-SP', center: 'æ¸…ç»“ç®—ä¸­å¿ƒ', module: 'è¿”ç‚¹/åˆ†ä½£è§„åˆ™', menu: 'åˆ†ä½£æ¨¡ç‰ˆé…ç½®', page: 'åˆ†ä½£æ¨¡ç‰ˆé…ç½®ï¼ˆåˆ—è¡¨ï¼‰', functions: ['æ–°å¢æ¨¡ç‰ˆ', 'æŸ¥çœ‹æ¨¡ç‰ˆè¯¦æƒ…', 'ç¼–è¾‘æ¨¡ç‰ˆ'], note: 'SPé¢„è®¾åˆ†ä½£æ¨¡ç‰ˆï¼Œç­¾çº¦æ—¶å¼•ç”¨', priority: 'P0' },
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'SP', portal: 'PP-SP', center: 'æ¸…ç»“ç®—ä¸­å¿ƒ', module: 'è¿”ç‚¹/åˆ†ä½£è§„åˆ™', menu: 'åˆ†ä½£é…ç½®', page: 'åˆ†ä½£é…ç½®', functions: ['é…ç½®åˆ†ä½£å‚æ•°'], note: 'åˆ†ä½£å…¨å±€é…ç½®', priority: 'P1' },

    // EXå¤„ç†ç§Ÿæˆ·ç­¾çº¦
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'EX', portal: 'SA', center: '/', module: 'ç§Ÿæˆ·ç®¡ç†', menu: 'ç§Ÿæˆ·ç®¡ç† - ç§Ÿæˆ·ç­¾çº¦ç”³è¯·', page: 'ç§Ÿæˆ·ç­¾çº¦ç”³è¯·ï¼ˆåˆ—è¡¨ï¼‰', functions: ['ç§Ÿæˆ·ç­¾çº¦', 'å®¡æ ¸ç­¾çº¦ç”³è¯·', 'æŸ¥çœ‹ç”³è¯·è¯¦æƒ…'], note: 'EXå¤„ç†ç§Ÿæˆ·çš„ç­¾çº¦ç”³è¯·', priority: 'P0' },
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'EX', portal: 'SA', center: '/', module: 'ç§Ÿæˆ·ç®¡ç†', menu: 'ç§Ÿæˆ·ç®¡ç†', page: 'ç§Ÿæˆ·åŸºæœ¬ä¿¡æ¯', functions: ['æŸ¥çœ‹ç§Ÿæˆ·ä¿¡æ¯', 'ç¼–è¾‘ç§Ÿæˆ·ä¿¡æ¯'], note: 'ç§Ÿæˆ·æ¡£æ¡ˆç®¡ç†', priority: 'P0' },
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'EX', portal: 'SA', center: '/', module: 'ç§Ÿæˆ·ç®¡ç†', menu: 'ç§Ÿæˆ·ç®¡ç†', page: 'ç§Ÿæˆ·ç­¾çº¦äº§å“', functions: ['æŸ¥çœ‹ç­¾çº¦äº§å“', 'ç®¡ç†ç­¾çº¦å…³ç³»'], note: 'ç§Ÿæˆ·å·²ç­¾çº¦çš„äº§å“åˆ—è¡¨', priority: 'P0' },

    // SPå¤„ç†å·¥å•
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'SP', portal: 'PP-SP', center: 'å·¥å•ä¸­å¿ƒ', module: 'å·¥å•å¤„ç†', menu: 'å¾…æˆ‘å¤„ç†', page: 'å·¥å•å¤„ç†ï¼ˆåˆ—è¡¨ï¼‰', functions: ['å¤„ç†å·¥å•', 'æŸ¥çœ‹è¯¦æƒ…'], note: 'SPå®¡æ‰¹ç§Ÿæˆ·ç­¾çº¦ç­‰å·¥å•', priority: 'P0' },

    // SPé…ç½®åˆ†ä½£è§„åˆ™
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'SP', portal: 'PP-SP', center: 'æ¸…ç»“ç®—ä¸­å¿ƒ', module: 'è¿”ç‚¹/åˆ†ä½£è§„åˆ™', menu: 'åˆ†ä½£è§„åˆ™é…ç½®', page: 'åˆ†ä½£è§„åˆ™é…ç½®ï¼ˆåˆ—è¡¨ï¼‰', functions: ['æŸ¥çœ‹è¯¦æƒ…', 'ä¿®æ”¹åˆ†ä½£è§„åˆ™'], note: 'é’ˆå¯¹å…·ä½“ç§Ÿæˆ·çš„åˆ†ä½£è§„åˆ™', priority: 'P0' },

    // ç§Ÿæˆ·åœ¨äº§å“ä¸­å¿ƒæµè§ˆå’Œç®¡ç†ç­¾çº¦äº§å“
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'ç§Ÿæˆ·', portal: 'PP-TP', center: 'äº§å“ä¸­å¿ƒ', module: 'äº§å“å¸‚åœº', menu: 'äº§å“å¸‚åœº', page: 'äº§å“å¸‚åœº', functions: ['äº§å“ä»‹ç»'], note: 'ç§Ÿæˆ·æµè§ˆå¯ç­¾çº¦çš„äº§å“', priority: 'P0' },
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'ç§Ÿæˆ·', portal: 'PP-TP', center: 'äº§å“ä¸­å¿ƒ', module: 'äº§å“å¸‚åœº', menu: 'å·²ç­¾çº¦äº§å“', page: 'å·²ç­¾çº¦äº§å“', functions: ['æŸ¥çœ‹äº§å“èƒ½åŠ›', 'é…ç½®äº§å“è´¹ç‡', 'é…ç½®æ±‡ç‡'], note: 'æ ¹æ®å®é™…äº§å“é…ç½®è´¹ç‡/æ±‡ç‡ï¼Œæˆ–ä¸¤è€…éƒ½éœ€è¦', priority: 'P0' },

    // SPæŸ¥çœ‹æœºæ„ç­¾çº¦äº§å“
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'ç§Ÿæˆ·', portal: 'PP-SP', center: 'åˆä½œä¼™ä¼´', module: 'æœºæ„ä¼™ä¼´', menu: 'æœºæ„ç­¾çº¦äº§å“', page: 'æœºæ„ç­¾çº¦äº§å“ï¼ˆåˆ—è¡¨ï¼‰', functions: ['æŸ¥çœ‹äº§å“èƒ½åŠ›', 'æŸ¥çœ‹æ ‡å‡†è´¹ç‡', 'æŸ¥çœ‹æ ‡å‡†æ±‡ç‡'], note: 'SPæŸ¥çœ‹æœºæ„ä¼™ä¼´çš„ç­¾çº¦äº§å“ä¿¡æ¯', priority: 'P0' },

    // ç§Ÿæˆ·ç™»å½•
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'ç§Ÿæˆ·', portal: 'PP-TP', center: 'è®¾ç½®ä¸­å¿ƒ', module: 'User', menu: '/', page: 'ç™»å½•', functions: ['é‚®ç®±ç™»å½•', 'æ‰‹æœºå·ç™»å½•'], note: 'ç§Ÿæˆ·é¦–æ¬¡ç™»å½•PP', priority: 'P0' },
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'ç§Ÿæˆ·', portal: 'PP-TP', center: 'è®¾ç½®ä¸­å¿ƒ', module: 'User', menu: '/', page: 'é‡ç½®å¯†ç ', functions: ['é‡ç½®å¯†ç '], note: '', priority: 'P0' },
    { flow: 'flow3', flowLabel: 'ä¸‰ã€ç§Ÿæˆ·ç­¾çº¦', role: 'ç§Ÿæˆ·', portal: 'PP-TP', center: 'è®¾ç½®ä¸­å¿ƒ', module: 'User', menu: '/', page: 'å·¥ä½œå°', functions: ['æŸ¥çœ‹å·¥ä½œå°æ¦‚è§ˆ'], note: 'ç™»å½•åé¦–é¡µ', priority: 'P0' },

    // ===== ç¬¬å››éƒ¨åˆ†Aï¼šç§Ÿæˆ·å±•ä¸š - å•†æˆ·ç™»å½•æ³¨å†Œ =====
    // å•†æˆ·æ³¨å†Œç™»å½•
    { flow: 'flow4a', flowLabel: 'å››ã€å•†æˆ·ç™»å½•æ³¨å†Œ', role: 'å•†æˆ·', portal: 'MP', center: '/', module: 'ç™»å½•æ³¨å†Œ', menu: '/', page: 'æ³¨å†Œ', functions: ['æ‰‹æœºå·æ³¨å†Œ', 'é‚®ç®±æ³¨å†Œ', 'éªŒè¯ç æ³¨å†Œ', 'å¯†ç æ³¨å†Œ'], note: 'å•†æˆ·åœ¨MPç«¯è‡ªåŠ©æ³¨å†Œ', priority: 'P0' },
    { flow: 'flow4a', flowLabel: 'å››ã€å•†æˆ·ç™»å½•æ³¨å†Œ', role: 'å•†æˆ·', portal: 'MP', center: '/', module: 'ç™»å½•æ³¨å†Œ', menu: '/', page: 'è®¾ç½®å¯†ç ', functions: ['è®¾ç½®ç™»å½•å¯†ç '], note: 'éªŒè¯ç æ³¨å†Œåè®¾ç½®å¯†ç ', priority: 'P0' },
    { flow: 'flow4a', flowLabel: 'å››ã€å•†æˆ·ç™»å½•æ³¨å†Œ', role: 'å•†æˆ·', portal: 'MP', center: '/', module: 'ç™»å½•æ³¨å†Œ', menu: '/', page: 'ç™»å½•', functions: ['æ‰‹æœºå·ç™»å½•', 'é‚®ç®±ç™»å½•', 'éªŒè¯ç ç™»å½•', 'å¯†ç ç™»å½•'], note: '', priority: 'P0' },

    // å•†æˆ·ä¸ªäººä¿¡æ¯
    { flow: 'flow4a', flowLabel: 'å››ã€å•†æˆ·ç™»å½•æ³¨å†Œ', role: 'å•†æˆ·', portal: 'MP', center: '/', module: 'User', menu: 'Personal Profile', page: 'ä¸ªäººä¿¡æ¯', functions: ['ç»‘å®š/ä¿®æ”¹æ‰‹æœºå·', 'ç»‘å®š/ä¿®æ”¹é‚®ç®±', 'å¼€é€š/å…³é—­2FAï¼ˆèº«ä»½éªŒè¯å™¨ï¼‰', 'ä¿®æ”¹æ˜µç§°'], note: 'å•†æˆ·ä¸ªäººè´¦æˆ·è®¾ç½®', priority: 'P0' },
    { flow: 'flow4a', flowLabel: 'å››ã€å•†æˆ·ç™»å½•æ³¨å†Œ', role: 'å•†æˆ·', portal: 'MP', center: '/', module: 'User', menu: 'Personal Profile', page: 'å…³è”å•†æˆ·ï¼ˆåˆ—è¡¨ï¼‰', functions: ['æŸ¥çœ‹å…³è”å•†æˆ·', 'åˆ‡æ¢å•†æˆ·'], note: 'ä¸€ä¸ªç”¨æˆ·å¯å…³è”å¤šä¸ªå•†æˆ·', priority: 'P0' },

    // ç§Ÿæˆ·æŸ¥çœ‹å•†æˆ·ç”¨æˆ·
    { flow: 'flow4a', flowLabel: 'å››ã€å•†æˆ·ç™»å½•æ³¨å†Œ', role: 'ç§Ÿæˆ·', portal: 'PP-TP', center: 'å®¢æˆ·ä¸­å¿ƒ', module: 'å•†æˆ·ç”¨æˆ·', menu: 'å•†æˆ·ç®¡ç†', page: 'å•†æˆ·ç”¨æˆ·æŸ¥è¯¢ï¼ˆåˆ—è¡¨ï¼‰', functions: ['æŸ¥è¯¢å•†æˆ·ç”¨æˆ·', 'æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…'], note: 'TPæŸ¥çœ‹å…¶ä¸‹å•†æˆ·çš„ç”¨æˆ·ä¿¡æ¯', priority: 'P0' },

    // ===== ç¬¬å››éƒ¨åˆ†Bï¼šç§Ÿæˆ·å±•ä¸š - å•†æˆ·å¼€é€šäº§å“ =====
    // å•†æˆ·å¼€é€šäº§å“
    { flow: 'flow4b', flowLabel: 'å››ã€å•†æˆ·å¼€é€šäº§å“', role: 'å•†æˆ·', portal: 'MP', center: '/', module: 'äº§å“ç®¡ç†', menu: '/', page: 'å¼€é€šäº§å“', functions: ['æäº¤KYCä¿¡æ¯', 'æäº¤äº§å“å¼€é€šä¿¡æ¯'], note: 'å•†æˆ·åœ¨MPç«¯ç”³è¯·å¼€é€šäº§å“', priority: 'P0' },
    { flow: 'flow4b', flowLabel: 'å››ã€å•†æˆ·å¼€é€šäº§å“', role: 'å•†æˆ·', portal: 'MP', center: '/', module: 'äº§å“ç®¡ç†', menu: '/', page: 'å¼€é€šåè½åœ°é¡µé¢', functions: ['æŸ¥çœ‹å¼€é€šç»“æœ', 'å¼•å¯¼ä¸‹ä¸€æ­¥æ“ä½œ'], note: 'äº§å“å¼€é€šæˆåŠŸ/å¤±è´¥ç»“æœé¡µ', priority: 'P0' },
    { flow: 'flow4b', flowLabel: 'å››ã€å•†æˆ·å¼€é€šäº§å“', role: 'å•†æˆ·', portal: 'MP', center: '/', module: 'äº§å“ç®¡ç†', menu: '/', page: 'äº§å“å¼€é€šåˆ—è¡¨', functions: ['æŸ¥çœ‹å·²å¼€é€šäº§å“', 'æŸ¥çœ‹å¼€é€šçŠ¶æ€'], note: 'å•†æˆ·å·²ç”³è¯·/å·²å¼€é€šçš„äº§å“åˆ—è¡¨', priority: 'P0' },

    // ç§Ÿæˆ·(TP)ç®¡ç†å•†æˆ·äº§å“
    { flow: 'flow4b', flowLabel: 'å››ã€å•†æˆ·å¼€é€šäº§å“', role: 'ç§Ÿæˆ·', portal: 'PP-TP', center: 'å®¢æˆ·ä¸­å¿ƒ', module: 'å•†æˆ·äº§å“æŸ¥è¯¢', menu: 'å•†æˆ·æŸ¥è¯¢', page: 'å•†æˆ·æŸ¥è¯¢ï¼ˆåˆ—è¡¨ï¼‰', functions: ['æŸ¥çœ‹å•†æˆ·è¯¦æƒ…'], note: 'TPæŸ¥çœ‹å•†æˆ·åŸºæœ¬ä¿¡æ¯', priority: 'P0' },
    { flow: 'flow4b', flowLabel: 'å››ã€å•†æˆ·å¼€é€šäº§å“', role: 'ç§Ÿæˆ·', portal: 'PP-TP', center: 'å®¢æˆ·ä¸­å¿ƒ', module: 'å•†æˆ·äº§å“æŸ¥è¯¢', menu: 'å•†æˆ·ç®¡ç†', page: 'å•†æˆ·ç®¡ç†ï¼ˆåˆ—è¡¨ï¼‰', functions: ['å•†æˆ·å¼€é€šäº§å“', 'äº§å“çŠ¶æ€å˜æ›´'], note: 'TPä¸ºå•†æˆ·å¼€é€š/ç®¡ç†äº§å“', priority: 'P0' },

    // ç§Ÿæˆ·(SP)æŸ¥çœ‹å•†æˆ·
    { flow: 'flow4b', flowLabel: 'å››ã€å•†æˆ·å¼€é€šäº§å“', role: 'ç§Ÿæˆ·', portal: 'PP-SP', center: 'å®¢æˆ·ä¸­å¿ƒ', module: 'å•†æˆ·äº§å“æŸ¥è¯¢', menu: 'å•†æˆ·æŸ¥è¯¢', page: 'å•†æˆ·æŸ¥è¯¢ï¼ˆåˆ—è¡¨ï¼‰', functions: ['æŸ¥çœ‹å•†æˆ·è¯¦æƒ…'], note: 'SPæŸ¥çœ‹å•†æˆ·ä¿¡æ¯ï¼ˆåªè¯»ï¼‰', priority: 'P0' },

    // ç§Ÿæˆ·(SP)åˆè§„å®¡æ ¸ - ç•¥è¿‡
    { flow: 'flow4b', flowLabel: 'å››ã€å•†æˆ·å¼€é€šäº§å“', role: 'ç§Ÿæˆ·', portal: 'PP-SP', center: 'åˆè§„é£æ§ä¸­å¿ƒ', module: 'å·¥å•å®¡æ ¸', menu: 'â€”', page: 'â€”', functions: ['ç•¥è¿‡'], note: 'åˆè§„é£æ§å®¡æ ¸æµç¨‹åç»­è¡¥å……', priority: 'P2' },
];

// ========== æ¸²æŸ“é€»è¾‘ ==========
function getFiltered() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    return allFeatures.filter(f => {
        if (currentTab !== 'all' && f.portal !== currentTab) return false;
        if (currentFlow !== 'all' && f.flow !== currentFlow) return false;
        if (search) {
            const haystack = [f.page, f.functions.join(' '), f.menu, f.module, f.note, f.role, f.center].join(' ').toLowerCase();
            if (!haystack.includes(search)) return false;
        }
        return true;
    });
}

function render() {
    const filtered = getFiltered();
    const container = document.getElementById('mainContent');

    // Group by flow
    const flowGroups = {};
    filtered.forEach(f => {
        if (!flowGroups[f.flow]) flowGroups[f.flow] = { label: f.flowLabel, items: [] };
        flowGroups[f.flow].items.push(f);
    });

    if (Object.keys(flowGroups).length === 0) {
        container.innerHTML = '<div class="empty-state"><p>æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„åŠŸèƒ½</p></div>';
        updateStats(filtered);
        return;
    }

    let html = '';
    const flowOrder = ['flow1', 'flow2', 'flow3', 'flow4a', 'flow4b'];
    const flowColors = {
        flow1: 'linear-gradient(135deg, #6366f1, #8b5cf6)',
        flow2: 'linear-gradient(135deg, #0ea5e9, #6366f1)',
        flow3: 'linear-gradient(135deg, #10b981, #0ea5e9)',
        flow4a: 'linear-gradient(135deg, #f59e0b, #ef4444)',
        flow4b: 'linear-gradient(135deg, #ec4899, #8b5cf6)',
    };
    const flowNums = { flow1: '1', flow2: '2', flow3: '3', flow4a: '4A', flow4b: '4B' };

    flowOrder.forEach(flowKey => {
        const group = flowGroups[flowKey];
        if (!group) return;

        html += `<div class="flow-section">`;
        html += `<div class="flow-header" style="background: ${flowColors[flowKey]}">
            <div class="flow-number">${flowNums[flowKey]}</div>
            <h2>${group.label}</h2>
            <div class="flow-desc">${group.items.length} ä¸ªé¡µé¢/åŠŸèƒ½ç‚¹</div>
        </div>`;
        html += `<div class="func-table-wrap"><table class="func-table">
            <thead><tr>
                <th style="width:70px">è§’è‰²</th>
                <th style="width:80px">ç«¯</th>
                <th style="width:90px">ä¸­å¿ƒ</th>
                <th style="width:100px">æ¨¡å—</th>
                <th style="width:140px">èœå•</th>
                <th style="width:160px">é¡µé¢</th>
                <th style="min-width:200px">åŠŸèƒ½</th>
                <th style="min-width:160px">è¯´æ˜</th>
            </tr></thead><tbody>`;

        group.items.forEach(f => {
            const roleClass = f.role === 'EX' ? 'tag-role-ex' : f.role === 'SP' ? 'tag-role-sp' : f.role === 'ç§Ÿæˆ·' ? 'tag-role-tp' : 'tag-role-merchant';
            const portalClass = f.portal === 'SA' ? 'tag-ç«¯-sa' : f.portal.startsWith('PP') ? 'tag-ç«¯-pp' : 'tag-ç«¯-mp';
            const funcHtml = f.functions.map(fn => `<li>${fn}</li>`).join('');

            html += `<tr>
                <td><span class="tag ${roleClass}">${f.role}</span></td>
                <td><span class="tag ${portalClass}">${f.portal}</span></td>
                <td>${f.center === '/' ? '<span style="color:var(--text-muted)">â€”</span>' : '<span class="tag tag-center">' + f.center + '</span>'}</td>
                <td style="font-weight:500">${f.module}</td>
                <td>${f.menu === '/' ? '<span style="color:var(--text-muted)">â€”</span>' : f.menu}</td>
                <td style="font-weight:600">${f.page}</td>
                <td><ul class="func-list">${funcHtml}</ul></td>
                <td class="note">${f.note}</td>
            </tr>`;
        });

        html += `</tbody></table></div></div>`;
    });

    container.innerHTML = html;
    updateStats(filtered);
}

function updateStats(filtered) {
    if (!filtered) filtered = getFiltered();
    document.getElementById('totalCount').textContent = filtered.length;
    document.getElementById('saCount').textContent = filtered.filter(f => f.portal === 'SA').length;
    document.getElementById('spCount').textContent = filtered.filter(f => f.portal === 'PP-SP').length;
    document.getElementById('tpCount').textContent = filtered.filter(f => f.portal === 'PP-TP').length;
    document.getElementById('mpCount').textContent = filtered.filter(f => f.portal === 'MP').length;

    // Tab badges
    document.getElementById('all-count').textContent = allFeatures.length;
    document.getElementById('SA-count').textContent = allFeatures.filter(f => f.portal === 'SA').length;
    document.getElementById('PP-SP-count').textContent = allFeatures.filter(f => f.portal === 'PP-SP').length;
    document.getElementById('PP-TP-count').textContent = allFeatures.filter(f => f.portal === 'PP-TP').length;
    document.getElementById('MP-count').textContent = allFeatures.filter(f => f.portal === 'MP').length;
}

function switchTab(tab) {
    currentTab = tab;
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
    render();
}

function switchFlow(flow) {
    currentFlow = flow;
    document.querySelectorAll('.flow-btn').forEach(btn => btn.classList.remove('active'));
    event.target.classList.add('active');
    render();
}

function expandAll() {
    // All sections are already expanded in table view
}

function exportToCSV() {
    let csv = 'ä¸šåŠ¡æµç¨‹,è§’è‰²,ç«¯,ä¸­å¿ƒ,æ¨¡å—,èœå•,é¡µé¢,åŠŸèƒ½,è¯´æ˜,ä¼˜å…ˆçº§\n';
    allFeatures.forEach(f => {
        const funcs = f.functions.join('ï¼›');
        csv += `"${f.flowLabel}","${f.role}","${f.portal}","${f.center}","${f.module}","${f.menu}","${f.page}","${funcs}","${f.note}","${f.priority}"\n`;
    });
    const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'EXåŠŸèƒ½çŸ©é˜µ_' + new Date().toISOString().split('T')[0] + '.csv';
    link.click();
}

// Init
render();
</script>
</body>
</html>
