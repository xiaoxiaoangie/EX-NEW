<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç™»å½•</title>
<style>
:root {
    --bg: #f8f9fa;
    --card: #ffffff;
    --text: #1a1a1a;
    --text2: #5f6368;
    --text3: #9aa0a6;
    --border: #dadce0;
    --border-light: #e8eaed;
    --accent: #1a73e8;
    --accent-hover: #1557b0;
    --accent-light: rgba(26,115,232,.08);
    --green: #34a853;
    --orange: #f9ab00;
    --red: #ea4335;
    --red-light: rgba(234,67,53,.08);
    --radius: 8px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Google Sans', 'PingFang SC', 'Helvetica Neue', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
}

/* ===== Top bar ===== */
.topbar {
    
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 64px;
    background: var(--card);
    border-bottom: 1px solid var(--border-light);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 40px;
    z-index: 100;
}
.topbar-logo {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    color: var(--text);
}
.topbar-logo .mark {
    width: 36px; height: 36px;
    background: var(--text);
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    color: #fff; font-size: 14px; font-weight: 800; letter-spacing: -.5px;
}
.topbar-logo .brand {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: -.3px;
}
.topbar-right {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: var(--text2);
}
.topbar-right a {
    color: var(--accent);
    text-decoration: none;
    font-weight: 600;
    padding: 8px 20px;
    border: 1.5px solid var(--accent);
    border-radius: var(--radius);
    transition: all .15s;
}
.topbar-right a:hover {
    background: var(--accent);
    color: #fff;
}

/* ===== Main ===== */
.main {
    min-height: 100vh;
    padding-top: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.container {
    width: 100%;
    max-width: 520px;
    padding: 48px 24px 60px;
}

/* ===== Card ===== */
.card {
    background: var(--card);
    border: 1px solid var(--border-light);
    border-radius: 12px;
    padding: 40px 44px;
    box-shadow: 0 1px 3px rgba(0,0,0,.04), 0 4px 12px rgba(0,0,0,.02);
}

/* ===== Typography ===== */
h1 {
    font-size: 24px;
    font-weight: 700;
    letter-spacing: -.3px;
    margin-bottom: 8px;
    color: var(--text);
}
.desc {
    font-size: 14px;
    color: var(--text2);
    line-height: 1.6;
    margin-bottom: 32px;
}
.desc b { color: var(--text); font-weight: 600; }

/* ===== Tabs ===== */
.tabs {
    display: flex;
    border-bottom: 2px solid var(--border-light);
    margin-bottom: 24px;
}
.tab {
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    color: var(--text3);
    cursor: pointer;
    border: none;
    background: none;
    font-family: inherit;
    position: relative;
    transition: color .2s;
}
.tab:hover { color: var(--text2); }
.tab.on { color: var(--accent); }
.tab.on::after {
    content: '';
    position: absolute;
    bottom: -2px; left: 0; right: 0;
    height: 2px;
    background: var(--accent);
    border-radius: 1px 1px 0 0;
}

/* ===== Fields ===== */
.field { margin-bottom: 20px; }
.field-label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 6px;
}
.field-input {
    width: 100%;
    padding: 12px 14px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 14px;
    color: var(--text);
    background: var(--card);
    outline: none;
    font-family: inherit;
    transition: border-color .15s, box-shadow .15s;
}
.field-input:hover { border-color: #bdc1c6; }
.field-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-light);
}
.field-input::placeholder { color: #bdc1c6; }
.field-input.error {
    border-color: var(--red);
    box-shadow: 0 0 0 3px var(--red-light);
}

/* Password field with toggle */
.pwd-wrap {
    position: relative;
}
.pwd-wrap .field-input { padding-right: 44px; }
.pwd-toggle {
    position: absolute;
    right: 12px; top: 50%; transform: translateY(-50%);
    background: none; border: none; cursor: pointer;
    color: var(--text3); font-size: 13px; font-family: inherit;
    padding: 4px;
    transition: color .15s;
}
.pwd-toggle:hover { color: var(--text2); }

/* Phone row */
.phone-row { display: flex; }
.phone-row select {
    width: 88px;
    padding: 12px 10px;
    border: 1px solid var(--border);
    border-radius: var(--radius) 0 0 var(--radius);
    border-right: none;
    font-size: 14px;
    color: var(--text);
    background: #f8f9fa;
    outline: none;
    font-family: inherit;
    appearance: none;
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%239aa0a6' d='M5 6L0 0h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    font-weight: 500;
}
.phone-row .field-input { border-radius: 0 var(--radius) var(--radius) 0; }

/* ===== Error message ===== */
.err-msg {
    display: none;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    background: var(--red-light);
    border: 1px solid rgba(234,67,53,.2);
    border-radius: var(--radius);
    margin-bottom: 20px;
    font-size: 13px;
    color: var(--red);
    line-height: 1.5;
}
.err-msg.show { display: flex; }
.err-msg .err-icon { font-size: 16px; flex-shrink: 0; }

/* ===== OTP 6-digit ===== */
.otp-row { display: flex; gap: 10px; justify-content: center; margin: 12px 0 20px; }
.otp-row input {
    width: 52px; height: 56px;
    text-align: center;
    font-size: 22px;
    font-weight: 700;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    outline: none;
    color: var(--text);
    font-family: inherit;
    transition: border-color .15s, box-shadow .15s;
    font-variant-numeric: tabular-nums;
    background: var(--card);
}
.otp-row input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-light);
}

/* ===== Resend ===== */
.resend-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 28px;
}
.resend-row span { font-size: 13px; color: var(--text3); }
.resend-row button {
    font-size: 13px;
    color: var(--accent);
    background: none;
    border: none;
    cursor: pointer;
    font-family: inherit;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 6px;
    transition: background .15s;
}
.resend-row button:hover { background: var(--accent-light); }
.resend-row button:disabled { color: var(--text3); cursor: default; background: none; }

/* ===== Method tabs (top level) ===== */
.method-tabs {
    display: flex;
    background: #f1f3f4;
    border-radius: 10px;
    padding: 3px;
    margin-bottom: 28px;
}
.method-tab {
    flex: 1;
    padding: 9px 12px;
    font-size: 13px;
    font-weight: 600;
    color: var(--text2);
    cursor: pointer;
    border: none;
    background: none;
    font-family: inherit;
    border-radius: 8px;
    transition: all .2s;
    text-align: center;
}
.method-tab:hover { color: var(--text); }
.method-tab.on {
    background: var(--card);
    color: var(--text);
    box-shadow: 0 1px 3px rgba(0,0,0,.08);
}

/* ===== CAPTCHA area ===== */
.captcha-area {
    margin-bottom: 24px;
}
.captcha-box {
    border: 1px solid var(--border-light);
    border-radius: var(--radius);
    overflow: hidden;
    background: #f8f9fa;
}
.captcha-img {
    width: 100%;
    height: 160px;
    background: linear-gradient(135deg, #e8eaed 25%, #f1f3f4 25%, #f1f3f4 50%, #e8eaed 50%, #e8eaed 75%, #f1f3f4 75%);
    background-size: 40px 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 8px;
    color: var(--text3);
    font-size: 13px;
    position: relative;
}
.captcha-img .puzzle-icon { font-size: 40px; opacity: .4; }
.captcha-slider {
    padding: 12px 16px;
    background: var(--card);
    border-top: 1px solid var(--border-light);
}
.slider-track {
    height: 40px;
    background: #f1f3f4;
    border-radius: 20px;
    position: relative;
    cursor: pointer;
    display: flex;
    align-items: center;
}
.slider-thumb {
    width: 44px; height: 36px;
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 18px;
    display: flex; align-items: center; justify-content: center;
    cursor: grab;
    position: absolute;
    left: 2px;
    transition: left .3s, background .2s, border-color .2s;
    font-size: 16px;
    color: var(--text3);
    box-shadow: 0 1px 3px rgba(0,0,0,.08);
    user-select: none;
}
.slider-thumb:hover { border-color: var(--accent); color: var(--accent); }
.slider-thumb.done {
    background: var(--green);
    border-color: var(--green);
    color: #fff;
    left: calc(100% - 46px);
}
.slider-text {
    width: 100%;
    text-align: center;
    font-size: 13px;
    color: var(--text3);
    pointer-events: none;
    user-select: none;
}

/* ===== Buttons ===== */
.btn {
    width: 100%;
    padding: 12px 24px;
    border-radius: var(--radius);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    font-family: inherit;
    transition: all .15s;
}
.btn-primary {
    background: var(--accent);
    color: #fff;
}
.btn-primary:hover { background: var(--accent-hover); box-shadow: 0 1px 3px rgba(26,115,232,.3); }
.btn-primary:active { transform: scale(.99); }
.btn-outline {
    background: var(--card);
    color: var(--text);
    border: 1px solid var(--border);
}
.btn-outline:hover { background: #f1f3f4; }
.btn-text {
    background: none;
    color: var(--accent);
    margin-top: 8px;
}
.btn-text:hover { background: var(--accent-light); }

.action-row {
    display: flex;
    gap: 12px;
    margin-top: 4px;
}
.action-row .btn { flex: 1; }

/* ===== Forgot password link ===== */
.forgot-link {
    text-align: right;
    margin-bottom: 24px;
    margin-top: -12px;
}
.forgot-link a {
    font-size: 13px;
    color: var(--accent);
    text-decoration: none;
    font-weight: 500;
}
.forgot-link a:hover { text-decoration: underline; }

/* ===== Lock screen ===== */
.lock-icon {
    width: 72px; height: 72px;
    margin: 0 auto 20px;
    border-radius: 50%;
    background: var(--red-light);
    display: flex; align-items: center; justify-content: center;
    font-size: 32px;
}
.lock-body { text-align: center; }
.lock-body h2 { font-size: 22px; font-weight: 700; margin-bottom: 8px; color: var(--red); }
.lock-body p { font-size: 14px; color: var(--text2); line-height: 1.6; margin-bottom: 4px; }
.lock-timer {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: #fef7f6;
    border: 1px solid rgba(234,67,53,.15);
    border-radius: 20px;
    padding: 8px 20px;
    margin: 20px 0;
    font-size: 14px;
    color: var(--red);
    font-weight: 600;
    font-variant-numeric: tabular-nums;
}

/* ===== Risk level demo selector ===== */
.demo-bar {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: var(--card);
    border-top: 1px solid var(--border-light);
    padding: 12px 40px;
    display: flex;
    align-items: center;
    gap: 16px;
    z-index: 100;
    box-shadow: 0 -2px 8px rgba(0,0,0,.04);
}
.demo-bar .demo-label {
    font-size: 12px;
    font-weight: 700;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: .5px;
    white-space: nowrap;
}
.demo-bar .demo-btns { display: flex; gap: 8px; }
.demo-btn {
    padding: 6px 16px;
    border-radius: 6px;
    font-size: 12px;
    font-weight: 600;
    cursor: pointer;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--text2);
    font-family: inherit;
    transition: all .15s;
    white-space: nowrap;
}
.demo-btn:hover { border-color: var(--accent); color: var(--accent); }
.demo-btn.on {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent);
}
.demo-desc {
    font-size: 12px;
    color: var(--text3);
    flex: 1;
    line-height: 1.4;
}

/* ===== Password reset success ===== */
.success-icon {
    width: 64px; height: 64px;
    margin: 0 auto 20px;
    border-radius: 50%;
    background: var(--green);
    display: flex; align-items: center; justify-content: center;
    color: #fff; font-size: 28px; font-weight: 700;
    animation: popIn .4s cubic-bezier(.175,.885,.32,1.275);
}
@keyframes popIn {
    0% { transform: scale(0); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

/* ===== Views ===== */
.v { display: none; animation: fadeUp .25s ease; }
.v.on { display: block; }
@keyframes fadeUp {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ===== Footer ===== */
.page-footer {
    text-align: center;
    padding: 24px;
    padding-bottom: 72px;
    font-size: 12px;
    color: var(--text3);
}
.page-footer a { color: var(--text3); text-decoration: none; margin: 0 12px; }
.page-footer a:hover { color: var(--text2); }
</style>
</head>
<body>

<!-- ===== Top bar ===== -->
<div class="topbar">
    <a class="topbar-logo" href="#">
        <div class="mark" id="logoMark"></div>
        <span class="brand" id="logoBrand"></span>
    </a>
    <div class="topbar-right">
        è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ
        <a href="mp-register.html">æ³¨å†Œ</a>
    </div>
</div>

<!-- ===== Main ===== -->
<div class="main">
    <div class="container">

        <!-- ==================== 1. ç™»å½•é¦–é¡µ ==================== -->
        <div class="v on" id="v-start">
            <div class="card">
                <h1>ç™»å½•</h1>
                <div class="desc"></div>

                <div class="method-tabs">
                    <button class="method-tab on" data-m="pwd" onclick="pickMethod(this)">å¯†ç ç™»å½•</button>
                    <button class="method-tab" data-m="code" onclick="pickMethod(this)">éªŒè¯ç ç™»å½•</button>
                    <button class="method-tab" data-m="otp" onclick="pickMethod(this)">OTP åŠ¨æ€ä»¤ç‰Œ</button>
                </div>

                <div class="tabs">
                    <button class="tab on" onclick="swTab(this,'email')">é‚®ç®±</button>
                    <button class="tab" onclick="swTab(this,'phone')">æ‰‹æœºå·</button>
                </div>

                <div id="f-email">
                    <div class="field">
                        <label class="field-label">é‚®ç®±åœ°å€</label>
                        <input class="field-input" type="email" placeholder="name@company.com" id="inEmail">
                    </div>
                </div>
                <div id="f-phone" style="display:none">
                    <div class="field">
                        <label class="field-label">æ‰‹æœºå·</label>
                        <div class="phone-row">
                            <select id="ccSel"><option>+86</option><option>+852</option><option>+1</option><option>+44</option><option>+81</option><option>+65</option></select>
                            <input class="field-input" type="tel" placeholder="è¾“å…¥æ‰‹æœºå·" id="inPhone">
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="goNext()">ç»§ç»­</button>
            </div>
        </div>

        <!-- ==================== 2. CAPTCHA å›¾å½¢éªŒè¯ (L1+) ==================== -->
        <div class="v" id="v-captcha">
            <div class="card">
                <h1>å®‰å…¨éªŒè¯</h1>
                <div class="desc">æ£€æµ‹åˆ°æ–°çš„ç™»å½•ç¯å¢ƒï¼Œè¯·å®Œæˆä»¥ä¸‹éªŒè¯</div>

                <div class="captcha-area">
                    <div class="captcha-box">
                        <div class="captcha-img">
                            <div class="puzzle-icon">ğŸ§©</div>
                            <span>æ»‘åŠ¨æ‹¼å›¾éªŒè¯åŒºåŸŸ</span>
                        </div>
                        <div class="captcha-slider">
                            <div class="slider-track" id="sliderTrack" onclick="completeCaptcha()">
                                <div class="slider-thumb" id="sliderThumb">â†’</div>
                                <span class="slider-text">å‘å³æ»‘åŠ¨å®ŒæˆéªŒè¯</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="action-row">
                    <button class="btn btn-outline" onclick="go('v-start')">è¿”å›</button>
                    <button class="btn btn-primary" id="captchaNext" onclick="afterCaptcha()" disabled style="opacity:.5">éªŒè¯åç»§ç»­</button>
                </div>
            </div>
        </div>

        <!-- ==================== 3-A. å¯†ç è¾“å…¥ ==================== -->
        <div class="v" id="v-pwd">
            <div class="card">
                <h1>è¾“å…¥å¯†ç </h1>
                <div class="desc"><b id="t-pwd-acct">â€”</b></div>

                <div class="err-msg" id="pwdErr">
                    <span class="err-icon">âš </span>
                    <span id="pwdErrText">å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•</span>
                </div>

                <div class="field">
                    <label class="field-label">å¯†ç </label>
                    <div class="pwd-wrap">
                        <input class="field-input" type="password" placeholder="è¾“å…¥ç™»å½•å¯†ç " id="inPwd">
                        <button class="pwd-toggle" onclick="togglePwd()" id="pwdEye">æ˜¾ç¤º</button>
                    </div>
                </div>
                <div class="forgot-link">
                    <a href="#" onclick="goForgot(); return false;">å¿˜è®°å¯†ç ï¼Ÿ</a>
                </div>

                <div class="action-row">
                    <button class="btn btn-outline" onclick="go('v-start')">è¿”å›</button>
                    <button class="btn btn-primary" onclick="submitPwd()">ç™»å½•</button>
                </div>
            </div>
        </div>

        <!-- ==================== 3-B. éªŒè¯ç è¾“å…¥ ==================== -->
        <div class="v" id="v-code">
            <div class="card">
                <h1>è¾“å…¥éªŒè¯ç </h1>
                <div class="desc">6 ä½éªŒè¯ç å·²å‘é€è‡³ <b id="t-code-acct">â€”</b></div>

                <div class="err-msg" id="codeErr">
                    <span class="err-icon">âš </span>
                    <span id="codeErrText">éªŒè¯ç é”™è¯¯ï¼Œè¯·é‡è¯•</span>
                </div>

                <div class="otp-row" id="otp1"></div>
                <div class="resend-row">
                    <span>æœ‰æ•ˆæœŸ 10 åˆ†é’Ÿ</span>
                    <button id="rs1" onclick="countdown(this)">é‡æ–°å‘é€</button>
                </div>

                <div class="action-row">
                    <button class="btn btn-outline" onclick="go('v-start')">è¿”å›</button>
                    <button class="btn btn-primary" onclick="submitCode()">ç™»å½•</button>
                </div>
            </div>
        </div>

        <!-- ==================== 3-C. OTP åŠ¨æ€ç è¾“å…¥ ==================== -->
        <div class="v" id="v-otp">
            <div class="card">
                <h1>è¾“å…¥åŠ¨æ€ç </h1>
                <div class="desc">æ‰“å¼€ Authenticator åº”ç”¨ï¼Œè¾“å…¥ <b id="t-otp-acct">â€”</b> çš„ 6 ä½åŠ¨æ€ç </div>

                <div class="err-msg" id="otpErr">
                    <span class="err-icon">âš </span>
                    <span id="otpErrText">åŠ¨æ€ç é”™è¯¯ï¼Œè¯·æ£€æŸ¥åé‡è¯•</span>
                </div>

                <div class="field">
                    <label class="field-label">åŠ¨æ€ç </label>
                    <input class="field-input" type="text" placeholder="è¾“å…¥ 6 ä½åŠ¨æ€ç " id="inOtp" maxlength="6" style="text-align:center;letter-spacing:6px;font-size:18px;font-weight:700">
                </div>

                <div class="action-row">
                    <button class="btn btn-outline" onclick="go('v-start')">è¿”å›</button>
                    <button class="btn btn-primary" onclick="submitOtp()">ç™»å½•</button>
                </div>
            </div>
        </div>

        <!-- ==================== 4. äºŒæ¬¡éªŒè¯ (L2) ==================== -->
        <div class="v" id="v-mfa">
            <div class="card">
                <h1>å®‰å…¨éªŒè¯</h1>
                <div class="desc">ä¸ºä¿æŠ¤è´¦æˆ·å®‰å…¨ï¼Œè¯·å®ŒæˆäºŒæ¬¡èº«ä»½éªŒè¯ã€‚<br>éªŒè¯ç å·²å‘é€è‡³ <b id="t-mfa-acct">â€”</b></div>

                <div class="err-msg" id="mfaErr">
                    <span class="err-icon">âš </span>
                    <span id="mfaErrText">éªŒè¯ç é”™è¯¯</span>
                </div>

                <div class="otp-row" id="otp2"></div>
                <div class="resend-row">
                    <span>æœ‰æ•ˆæœŸ 10 åˆ†é’Ÿ</span>
                    <button id="rs2" onclick="countdown(this)">é‡æ–°å‘é€</button>
                </div>

                <div class="action-row">
                    <button class="btn btn-outline" onclick="go('v-start')">è¿”å›</button>
                    <button class="btn btn-primary" onclick="submitMfa()">éªŒè¯å¹¶ç™»å½•</button>
                </div>
            </div>
        </div>

        <!-- ==================== 5. è´¦æˆ·é”å®š (L3) ==================== -->
        <div class="v" id="v-locked">
            <div class="card">
                <div class="lock-icon">ğŸ”’</div>
                <div class="lock-body">
                    <h2>è´¦æˆ·å·²å†»ç»“</h2>
                    <p>ä¸ºä¿æŠ¤æ‚¨çš„è´¦æˆ·å®‰å…¨ï¼Œç™»å½•åŠŸèƒ½å·²æš‚æ—¶å†»ç»“ 24 å°æ—¶ã€‚</p>
                    <p>æˆ‘ä»¬å·²å‘æ‚¨çš„æ³¨å†Œé‚®ç®±/æ‰‹æœºå‘é€äº†å®‰å…¨é€šçŸ¥ã€‚</p>
                    <div class="lock-timer">
                        å‰©ä½™å†»ç»“æ—¶é—´ï¼š<span id="lockTime">23:59:59</span>
                    </div>
                </div>
                <div class="action-row" style="margin-top:24px">
                    <button class="btn btn-outline" onclick="alert('å‘é€è§£é”é‚®ä»¶â€¦')">é€šè¿‡é‚®ä»¶è§£é”</button>
                    <button class="btn btn-outline" onclick="alert('è”ç³»å®¢æœâ€¦')">è”ç³»å®¢æœ</button>
                </div>
                <button class="btn btn-text" onclick="go('v-start')">è¿”å›ç™»å½•</button>
            </div>
        </div>

        <!-- ==================== 6. ç™»å½•æˆåŠŸ ==================== -->
        <div class="v" id="v-success">
            <div class="card">
                <div class="success-icon">âœ“</div>
                <div class="lock-body" style="text-align:center">
                    <h2 style="color:var(--text)">ç™»å½•æˆåŠŸ</h2>
                    <p>æ­£åœ¨è·³è½¬åˆ°æ§åˆ¶å°â€¦</p>
                    <div class="lock-timer" style="background:rgba(52,168,83,.08);border-color:rgba(52,168,83,.15);color:var(--green)">
                        <span id="successSec">3</span> ç§’åè‡ªåŠ¨è·³è½¬
                    </div>
                </div>
                <button class="btn btn-primary" style="margin-top:16px" onclick="alert('è¿›å…¥ MP æ§åˆ¶å°â€¦')">ç«‹å³è¿›å…¥</button>
            </div>
        </div>

        <!-- ==================== 7. å¿˜è®°å¯†ç  â€” è¾“å…¥é‚®ç®± ==================== -->
        <div class="v" id="v-forgot">
            <div class="card">
                <h1>é‡ç½®å¯†ç </h1>
                <div class="desc">è¾“å…¥æ‚¨çš„æ³¨å†Œé‚®ç®±æˆ–æ‰‹æœºå·ï¼Œæˆ‘ä»¬å°†å‘é€é‡ç½®é“¾æ¥</div>

                <div class="field">
                    <label class="field-label">é‚®ç®± / æ‰‹æœºå·</label>
                    <input class="field-input" type="text" placeholder="name@company.com" id="inForgot">
                </div>

                <div class="action-row">
                    <button class="btn btn-outline" onclick="go('v-start')">è¿”å›ç™»å½•</button>
                    <button class="btn btn-primary" onclick="sendReset()">å‘é€é‡ç½®é“¾æ¥</button>
                </div>
            </div>
        </div>

        <!-- ==================== 8. å¿˜è®°å¯†ç  â€” å·²å‘é€ ==================== -->
        <div class="v" id="v-forgot-sent">
            <div class="card">
                <h1>æŸ¥æ”¶é‚®ä»¶</h1>
                <div class="desc">å¯†ç é‡ç½®é“¾æ¥å·²å‘é€è‡³ <b id="t-forgot-acct">â€”</b></div>

                <div style="background:#e8f0fe;border:1px solid #aecbfa;border-radius:var(--radius);padding:28px 24px;text-align:center;margin-bottom:24px">
                    <div style="font-size:40px;margin-bottom:12px">âœ‰ï¸</div>
                    <p style="font-size:14px;color:var(--text);line-height:1.6">è¯·æŸ¥æ”¶é‚®ä»¶ä¸­çš„é‡ç½®é“¾æ¥ï¼Œ<br>ç‚¹å‡»é“¾æ¥è®¾ç½®æ–°å¯†ç ã€‚</p>
                </div>

                <div class="resend-row" style="justify-content:center;gap:6px">
                    <span>æ²¡æœ‰æ”¶åˆ°ï¼Ÿ</span>
                    <button id="rs3" onclick="countdown(this)">é‡æ–°å‘é€</button>
                </div>

                <button class="btn btn-text" onclick="go('v-start')">è¿”å›ç™»å½•</button>
            </div>
        </div>

        <!-- ==================== 9. å¿˜è®°å¯†ç  â€” è®¾ç½®æ–°å¯†ç  ==================== -->
        <div class="v" id="v-reset-pwd">
            <div class="card">
                <h1>è®¾ç½®æ–°å¯†ç </h1>
                <div class="desc">è¯·ä¸ºæ‚¨çš„è´¦æˆ·è®¾ç½®æ–°çš„ç™»å½•å¯†ç </div>

                <div class="field">
                    <label class="field-label">æ–°å¯†ç </label>
                    <input class="field-input" type="password" placeholder="è‡³å°‘ 8 ä½ï¼Œå«å¤§å°å†™å­—æ¯å’Œæ•°å­—" id="inNewPwd" oninput="meter(this.value)">
                    <div class="pwd-meter" style="display:flex;gap:4px;margin-top:8px"><i id="s1" style="flex:1;height:3px;border-radius:2px;background:var(--border-light);transition:background .3s;font-style:normal"></i><i id="s2" style="flex:1;height:3px;border-radius:2px;background:var(--border-light);transition:background .3s;font-style:normal"></i><i id="s3" style="flex:1;height:3px;border-radius:2px;background:var(--border-light);transition:background .3s;font-style:normal"></i><i id="s4" style="flex:1;height:3px;border-radius:2px;background:var(--border-light);transition:background .3s;font-style:normal"></i></div>
                    <div id="pwdH" style="font-size:12px;color:var(--text3);margin-top:4px;font-weight:500"></div>
                </div>
                <div class="field">
                    <label class="field-label">ç¡®è®¤æ–°å¯†ç </label>
                    <input class="field-input" type="password" placeholder="å†æ¬¡è¾“å…¥æ–°å¯†ç " id="inNewPwd2">
                </div>

                <button class="btn btn-primary" onclick="resetDone()">é‡ç½®å¯†ç </button>
            </div>
        </div>

        <!-- ==================== 10. å¯†ç é‡ç½®æˆåŠŸ ==================== -->
        <div class="v" id="v-reset-done">
            <div class="card">
                <div class="success-icon">âœ“</div>
                <div style="text-align:center">
                    <h2 style="font-size:22px;font-weight:700;margin-bottom:8px">å¯†ç å·²é‡ç½®</h2>
                    <p style="font-size:14px;color:var(--text2);line-height:1.5">è¯·ä½¿ç”¨æ–°å¯†ç ç™»å½•æ‚¨çš„è´¦æˆ·</p>
                </div>
                <button class="btn btn-primary" style="margin-top:28px" onclick="go('v-start')">è¿”å›ç™»å½•</button>
            </div>
        </div>

    </div>
</div>

<!-- ===== Footer ===== -->
<div class="page-footer">
    <span id="footerBrand">&copy; 2026</span>
    <a href="#">éšç§æ”¿ç­–</a>
    <a href="#">æœåŠ¡æ¡æ¬¾</a>
    <a href="#">å¸®åŠ©ä¸­å¿ƒ</a>
</div>

<!-- ===== Demo bar (prototype only) ===== -->
<div class="demo-bar">
    <span class="demo-label">é£é™©ç­‰çº§æ¨¡æ‹Ÿ</span>
    <div class="demo-btns">
        <button class="demo-btn on" data-r="0" onclick="setRisk(0,this)">L0 æ— é£é™©</button>
        <button class="demo-btn" data-r="1" onclick="setRisk(1,this)">L1 ä½é£é™©</button>
        <button class="demo-btn" data-r="2" onclick="setRisk(2,this)">L2 é«˜é£é™©</button>
        <button class="demo-btn" data-r="e" onclick="setRisk('e',this)">å¯†ç é”™è¯¯ 3 æ¬¡</button>
    </div>
    <span class="demo-desc" id="demoDesc">å¸¸ç”¨è®¾å¤‡ + å¸¸ç”¨ IP â†’ ç›´æ¥è¾“å…¥å‡­è¯ç™»å½•</span>
</div>

<script>
/* ===== State ===== */
let acctType = 'email';   // email | phone
let loginMethod = 'pwd';  // pwd | code | otp
let riskLevel = 0;        // 0-2
let errCount = 0;
let captchaPassed = false;

const riskDescs = {
    0: 'å¸¸ç”¨è®¾å¤‡ + å¸¸ç”¨ IP â†’ ç›´æ¥è¾“å…¥å‡­è¯ç™»å½•',
    1: 'æ–°è®¾å¤‡ / æ–°æµè§ˆå™¨ â†’ éœ€å…ˆå®Œæˆå›¾å½¢éªŒè¯ç ',
    2: 'è¿ç»­é”™è¯¯ â‰¥5 æ¬¡ / å¼‚åœ°æ–°è®¾å¤‡ â†’ å†»ç»“è´¦æˆ· 24 å°æ—¶',
    'e': 'æ¨¡æ‹Ÿå¯†ç è¿ç»­è¾“å…¥é”™è¯¯ 3 æ¬¡ï¼Œè§¦å‘å›¾å½¢éªŒè¯ç '
};

/* ===== IP-based default login method ===== */
(function initDefaultMethod() {
    // Simulate IP region detection
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
    let region = 'other';
    if (tz.startsWith('Asia/Shanghai') || tz.startsWith('Asia/Chongqing')) region = 'CN';
    else if (tz.startsWith('Asia/Hong_Kong')) region = 'HK';
    else if (tz.startsWith('Asia/Tokyo')) region = 'JP';
    else if (tz.startsWith('America/')) region = 'US';
    else if (tz.startsWith('Europe/')) region = 'EU';

    // Default method by region: CN/HK/JP â†’ password, US/EU â†’ verification code, other â†’ password
    const regionMethodMap = { CN: 'pwd', HK: 'pwd', JP: 'pwd', US: 'code', EU: 'code', other: 'pwd' };
    const defaultMethod = regionMethodMap[region] || 'pwd';
    loginMethod = defaultMethod;

    // Activate the correct method tab
    setTimeout(() => {
        document.querySelectorAll('.method-tab').forEach(t => {
            t.classList.toggle('on', t.dataset.m === defaultMethod);
        });
    }, 0);
})();

/* ===== Navigation ===== */
function go(id) {
    document.querySelectorAll('.v').forEach(v => v.classList.remove('on'));
    document.getElementById(id).classList.add('on');
}

function swTab(el, m) {
    acctType = m;
    el.parentElement.querySelectorAll('.tab').forEach(b => b.classList.remove('on'));
    el.classList.add('on');
    document.getElementById('f-email').style.display = m === 'email' ? '' : 'none';
    document.getElementById('f-phone').style.display = m === 'phone' ? '' : 'none';
}

function pickMethod(el) {
    document.querySelectorAll('.method-tab').forEach(c => c.classList.remove('on'));
    el.classList.add('on');
    loginMethod = el.dataset.m;
}

function getAcct() {
    return acctType === 'email'
        ? (document.getElementById('inEmail').value || 'name@company.com')
        : (document.getElementById('inPhone').value || 'æ‰‹æœºå·');
}

function maskAcct(a) {
    if (a.includes('@')) {
        const [u, d] = a.split('@');
        return u.slice(0, 2) + '***@' + d;
    }
    return a.slice(0, 3) + '****' + a.slice(-4);
}

/* ===== Risk level demo ===== */
function setRisk(r, btn) {
    document.querySelectorAll('.demo-btn').forEach(b => b.classList.remove('on'));
    btn.classList.add('on');
    if (r === 'e') {
        riskLevel = 0;
        errCount = 3;
    } else {
        riskLevel = r;
        errCount = 0;
    }
    document.getElementById('demoDesc').textContent = riskDescs[r];
    captchaPassed = false;
    resetCaptcha();
}

/* ===== Main flow ===== */
function goNext() {
    const acct = getAcct();
    captchaPassed = false;
    resetCaptcha();

    // L2 â†’ frozen 24h
    if (riskLevel >= 2) {
        go('v-locked');
        startLockTimer();
        return;
    }

    // L1 or errCount>=3 â†’ CAPTCHA first
    if (riskLevel >= 1 || errCount >= 3) {
        go('v-captcha');
        return;
    }

    // L0 â†’ go directly to credential
    goToCredential(acct);
}

function afterCaptcha() {
    if (!captchaPassed) return;
    goToCredential(getAcct());
}

function goToCredential(acct) {
    if (loginMethod === 'pwd') {
        document.getElementById('t-pwd-acct').textContent = acct;
        document.getElementById('pwdErr').classList.remove('show');
        go('v-pwd');
    } else if (loginMethod === 'code') {
        document.getElementById('t-code-acct').textContent = acct;
        document.getElementById('codeErr').classList.remove('show');
        go('v-code');
        buildOtp('otp1');
        countdown(document.getElementById('rs1'));
    } else {
        document.getElementById('t-otp-acct').textContent = acct;
        document.getElementById('otpErr').classList.remove('show');
        go('v-otp');
    }
}

/* ===== CAPTCHA ===== */
function completeCaptcha() {
    captchaPassed = true;
    const thumb = document.getElementById('sliderThumb');
    thumb.classList.add('done');
    thumb.textContent = 'âœ“';
    const btn = document.getElementById('captchaNext');
    btn.disabled = false;
    btn.style.opacity = '1';
}

function resetCaptcha() {
    captchaPassed = false;
    const thumb = document.getElementById('sliderThumb');
    if (thumb) {
        thumb.classList.remove('done');
        thumb.textContent = 'â†’';
    }
    const btn = document.getElementById('captchaNext');
    if (btn) {
        btn.disabled = true;
        btn.style.opacity = '.5';
    }
}

/* ===== Submit handlers ===== */
function submitPwd() {
    // Simulate: if errCount demo, show error
    if (errCount > 0 && errCount < 5) {
        errCount++;
        const el = document.getElementById('pwdErr');
        const txt = document.getElementById('pwdErrText');
        el.classList.add('show');
        if (errCount >= 5) {
            txt.textContent = 'è¿ç»­é”™è¯¯ ' + errCount + ' æ¬¡ï¼Œè´¦æˆ·å·²ä¸´æ—¶é”å®š';
            setTimeout(() => { go('v-locked'); startLockTimer(); }, 1500);
            return;
        } else if (errCount >= 3) {
            txt.textContent = 'å¯†ç é”™è¯¯ï¼ˆç¬¬ ' + errCount + ' æ¬¡ï¼‰ï¼Œè¯·å®Œæˆå®‰å…¨éªŒè¯åé‡è¯•';
        } else {
            txt.textContent = 'å¯†ç é”™è¯¯ï¼Œè¯·é‡è¯•ï¼ˆç¬¬ ' + errCount + ' æ¬¡ï¼‰';
        }
        return;
    }

    // Success
    loginSuccess();
}

function submitCode() {
    // Verification code is itself identity proof, skip MFA even for L2
    loginSuccess();
}

function submitOtp() {
    loginSuccess();
}

function submitMfa() {
    loginSuccess();
}

function loginSuccess() {
    go('v-success');
    let s = 3;
    const el = document.getElementById('successSec');
    const t = setInterval(() => {
        if (--s <= 0) { clearInterval(t); alert('è¿›å…¥ MP æ§åˆ¶å°â€¦'); }
        else el.textContent = s;
    }, 1000);
}

/* ===== Forgot password ===== */
function goForgot() {
    go('v-forgot');
}

function sendReset() {
    const v = document.getElementById('inForgot').value || 'name@company.com';
    document.getElementById('t-forgot-acct').textContent = maskAcct(v);
    go('v-forgot-sent');
    countdown(document.getElementById('rs3'));
}

function resetDone() {
    go('v-reset-done');
}

/* ===== Lock timer ===== */
function startLockTimer() {
    let total = 24 * 60 * 60; // 24 hours
    const el = document.getElementById('lockTime');
    const t = setInterval(() => {
        if (--total <= 0) { clearInterval(t); el.textContent = '00:00'; return; }
        const h = Math.floor(total / 3600);
        const m = Math.floor((total % 3600) / 60);
        const s = total % 60;
        el.textContent = String(h).padStart(2, '0') + ':' + String(m).padStart(2, '0') + ':' + String(s).padStart(2, '0');
    }, 1000);
}

/* ===== OTP builder ===== */
function buildOtp(id) {
    const w = document.getElementById(id);
    if (w.children.length) return;
    for (let i = 0; i < 6; i++) {
        const inp = document.createElement('input');
        inp.maxLength = 1; inp.type = 'text';
        inp.oninput = function() { if (this.value && i < 5) w.children[i + 1].focus(); };
        inp.onkeydown = function(e) { if (e.key === 'Backspace' && !this.value && i > 0) w.children[i - 1].focus(); };
        w.appendChild(inp);
    }
    setTimeout(() => w.children[0].focus(), 100);
}

/* ===== Countdown ===== */
function countdown(btn) {
    btn.disabled = true; let s = 60; btn.textContent = s + 's';
    const t = setInterval(() => {
        if (--s <= 0) { clearInterval(t); btn.disabled = false; btn.textContent = 'é‡æ–°å‘é€'; }
        else btn.textContent = s + 's';
    }, 1000);
}

/* ===== Password toggle ===== */
function togglePwd() {
    const inp = document.getElementById('inPwd');
    const btn = document.getElementById('pwdEye');
    if (inp.type === 'password') {
        inp.type = 'text'; btn.textContent = 'éšè—';
    } else {
        inp.type = 'password'; btn.textContent = 'æ˜¾ç¤º';
    }
}

/* ===== Password meter ===== */
function meter(p) {
    const ss = ['s1','s2','s3','s4'].map(id => document.getElementById(id));
    const h = document.getElementById('pwdH');
    ss.forEach(s => { s.style.background = 'var(--border-light)'; });
    if (!p) { h.textContent = ''; return; }
    let sc = 0;
    if (p.length >= 8) sc++;
    if (/[a-z]/.test(p) && /[A-Z]/.test(p)) sc++;
    if (/\d/.test(p)) sc++;
    if (/[^a-zA-Z0-9]/.test(p)) sc++;
    const mp = [
        { t: 'å¼± â€” è¯·å¢åŠ å¤æ‚åº¦', cl: '#ea4335' },
        { t: 'ä¸­ç­‰', cl: '#f9ab00' },
        { t: 'å¼º', cl: '#34a853' },
        { t: 'éå¸¸å¼º', cl: '#34a853' }
    ];
    for (let i = 0; i < sc; i++) ss[i].style.background = mp[sc-1].cl;
    h.textContent = mp[sc-1].t; h.style.color = mp[sc-1].cl;
}
</script>
</body>
</html>
