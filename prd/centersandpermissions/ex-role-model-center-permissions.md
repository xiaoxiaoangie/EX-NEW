# EX 平台角色模型与各中心权限设计

> 本文档定义 EX 平台的核心角色（SP、TP、商户），描述各种机构类型及其组合场景，
> 并明确每种角色对各业务中心的可见性与权限边界。

---

## 1. 核心角色定义

### 1.1 SP（服务商 / Service Provider）

**定义**：将能力集成到 EX 平台的机构。

| 属性                 | 说明                                                         |
| -------------------- | ------------------------------------------------------------ |
| **本质**       | 能力提供方，将自身能力通过 API 或系统对接集成到 EX           |
| **类别**       | 支付服务商、物流服务商、风控服务商等（当前仅考虑支付服务商） |
| **牌照**       | 支付服务商一定持牌                                           |
| **后台**       | EX 为每个 SP 提供一个 SP 后台；SP 也可选择纯 API 对接        |
| **与 TP 无关** | SP 身份独立于 TP 身份，SP 不一定是 TP                        |

**SP 的两种使用模式**：

| 模式                           | 说明                             | 拥有的能力                                              |
| ------------------------------ | -------------------------------- | ------------------------------------------------------- |
| **基础模式**             | SP 只通过 API 对接或使用 SP 后台 | SP 后台（商户/交易/计费数据同步），无清算/合规/工单中心 |
| **付费购买 EX 整套系统** | SP 单独付费使用 EX 的运营系统    | 可包含清算中心、合规风控中心、渠道中心、财资中心等      |

### 1.2 TP（租户 / Tenant）

**定义**：购买 EX 能力的机构。TP 是 EX 对使用其他sp能力的 客户的统一称呼。

| 属性                   | 说明                                              |
| ---------------------- | ------------------------------------------------- |
| **本质**         | EX 的一类客户，使用 EX 平台的能力来服务自己的客户 |
| **与 SP 的关系** | TP 通过签约 SP 的产品来获得支付能力               |
| **可选 SP 身份** | TP 可以同时是 SP（将自己的能力也集成到 EX）       |

**TP 与 SP 的两种合作模式**：

| 合作模式               | TP 视角                  | SP 视角                         | 商户信息                 | 清算方      |
| ---------------------- | ------------------------ | ------------------------------- | ------------------------ | ----------- |
| **代理模式**     | TP 代理 SP 的产品        | TP 是 SP 的**机构代理商** | 推送给 SP，SP 为商户开户 | SP 清算     |
| **直接合作模式** | TP 用自己牌照，SP 是渠道 | TP 是 SP 的**机构商户**   | TP 自己管，不推送        | TP 自己清算 |

> **同一个 TP 可以同时使用两种模式**：跟部分 SP 是代理模式，跟部分 SP 是直接合作模式。
> 这取决于 TP 是否有对应产品线的牌照，以及 SP 的合规要求。

### 1.3 商户（Merchant / Member）

**定义**：使用支付服务的终端企业或个人。

| 视角              | 称呼           | 说明                                 |
| ----------------- | -------------- | ------------------------------------ |
| **TP 视角** | **会员** | TP 的客户，TP 维护会员关系、配置产品 |
| **SP 视角** | 商户           | SP 的客户，SP 提供支付服务、清算结算 |

> 同一个客户，对 TP 来说是会员，对 SP 来说是商户。
> 在代理模式下，TP 的会员被推送给 SP 后，成为 SP 的商户。
> 在直接合作模式下，TP 自己管理商户，SP 不感知商户。

---

## 2. 机构类型全景

### 2.1 所有可能的机构类型

| 机构类型               | 身份                        |    牌照    | 说明                                        | 举例                 |
| ---------------------- | --------------------------- | :--------: | ------------------------------------------- | -------------------- |
| **纯 SP**        | SP only                     | ✅（支付） | 只把能力集成到 EX，没有自己的终端客户       | 某支付网关公司       |
| **纯代理 TP**    | TP only                     |  ❌ 或 ✅  | 所有产品都代理 SP（即使持牌，未用自己牌照服务客户） | 鲲鹏                 |
| **持牌 TP**      | TP only                     |     ✅     | 有牌照，用自己牌照服务客户，SP 是渠道       | （独立持牌机构）     |
| **TP + SP**      | TP + SP                     |     ✅     | 有自己的客户（TP）+ 把能力集成到 EX（SP）   | IPL、BB              |
| **混合 TP**      | TP（部分代理+部分直接合作） |     ✅     | 部分产品用自己牌照（直接合作），部分产品代理 SP | 有收单牌照但代理收款 |
| **混合 TP + SP** | TP + SP（混合模式）         |     ✅     | 混合 TP + 同时也是 SP                       | 复杂大型机构         |

### 2.2 典型机构示例

#### IPL

```
身份：TP + SP
- 作为 TP：有自己的客户（会员），用自己的牌照服务客户
- 作为 SP：将支付能力集成到 EX，其他 TP 可代理 IPL 产品
- 购买了 EX 整套系统（清算中心、合规中心、渠道中心、财资中心）
- 渠道中心：可接入外部 Channel
```

#### BB

```
身份：TP + SP
- 作为 TP：有自己的客户（会员），用自己的牌照服务客户
- 作为 SP：将支付能力集成到 EX，其他 TP 可代理 BB 产品
- 购买了 EX 整套系统
- 渠道中心：IPL 是 BB 的渠道之一（BB 用 IPL 的发卡能力）
```

#### 鲲鹏

```
身份：纯代理 TP
- 作为 TP：无牌照，代理 IPL、BB 等 SP 的产品
- 商户推送给 SP 处理
- 无清算中心、渠道中心、财资中心、合规中心
- 只有产品中心（签约代理）和客户中心（会员管理）
```

#### 某支付网关公司

```
身份：纯 SP
- 作为 SP：将支付网关能力集成到 EX
- 没有自己的终端客户
- 使用 SP 后台或纯 API 对接
- 基础模式：EX 同步商户/交易/计费数据
```

---

## 3. 各中心可见性矩阵

### 3.1 TP 端

| 中心                   | 纯代理 TP | 持牌 TP | TP+SP | 可见条件                                    |
| ---------------------- | :-------: | :-----: | :---: | ------------------------------------------- |
| **产品中心**     |    ✅    |   ✅   |  ✅  | 所有 TP                                     |
| **客户中心**     |    ✅    |   ✅   |  ✅  | 所有 TP                                     |
| **清算中心**     |    ❌    |   ✅   |  ✅  | `usesOwnLicense = true`（通过自己牌照服务客户） |
| **合规风控中心** |    ❌    |   ✅   |  ✅  | `usesOwnLicense = true`                         |
| **渠道中心**     |    ❌    |   ✅   |  ✅  | `usesOwnLicense = true`（SP 就是渠道）          |
| **财资中心**     |    ❌    |   ✅   |  ✅  | `usesOwnLicense = true`                         |
| **工作流中心**   |    ❌    |   ❌   |  ❌  | SA 管理后台 only                            |

> **混合 TP**：只要有任何一条产品线通过自己的牌照能力服务客户，就 `usesOwnLicense = true`，看到所有中心。
> 
> **注意**：持牌 ≠ usesOwnLicense。一个机构可能持有牌照，但如果所有产品都代理其他 SP 的能力（未用自己牌照服务客户），则实际上是代理 TP，不会看到清算/合规/渠道/财资中心。

### 3.2 SP 端

| 中心                   | SP（基础模式） | SP（付费整套） | 说明             |
| ---------------------- | :------------: | :------------: | ---------------- |
| **SP 后台**      |       ✅       |       ✅       | 所有 SP 都有     |
| **清算中心**     |       ❌       |       ✅       | 付费购买         |
| **合规风控中心** |       ❌       |       ✅       | 付费购买         |
| **渠道中心**     |       ❌       |       ✅       | 付费购买         |
| **财资中心**     |       ❌       |       ✅       | 付费购买         |
| **工作流中心**   |       ❌       |       ❌       | SA 管理后台 only |

> **SP 基础模式**：EX 通过 API 或 SP 后台同步以下数据给 SP：
>
> - 商户信息（TP 推送过来的商户）
> - 交易数据
> - 商户计费信息
> - 结算数据

### 3.3 TP + SP 双身份

当一个机构同时是 TP 和 SP 时（如 IPL、BB）：

| 维度               | TP 身份                         | SP 身份                  |
| ------------------ | ------------------------------- | ------------------------ |
| **登录入口** | TP 后台                         | SP 后台                  |
| **客户**     | 自己的会员                      | 其他 TP 推送过来的商户   |
| **产品中心** | 签约其他 SP 产品 / 管理自己产品 | 上架产品给其他 TP 代理   |
| **清算中心** | 管自己会员的清算                | 管其他 TP 推送商户的清算 |
| **渠道中心** | 各 SP 是自己的渠道              | 可接入外部 Channel       |

---

## 4. 各中心职责（按角色区分）

### 4.1 产品中心

| 角色                | 职责                                                           |
| ------------------- | -------------------------------------------------------------- |
| **SP**        | 上架产品、定义产品能力（币种/支付方式/限额）、管理产品状态     |
| **纯代理 TP** | 浏览 SP 产品市场、签约代理 SP 产品                             |
| **持牌 TP**   | 浏览 SP 产品市场、签约 SP 产品（作为渠道）、管理自己的产品定义 |
| **TP + SP**   | 以上全部                                                       |

### 4.2 客户中心

| 角色                     | 职责                                             |
| ------------------------ | ------------------------------------------------ |
| **所有 TP**        | 会员管理（维护会员关系、配置产品、返点分佣查询） |
| **所有 TP**        | 商户查询（只读查询商户信息、订单、贸易背景）     |
| **SP（基础模式）** | 在 SP 后台查看被推送的商户信息                   |
| **SP（付费整套）** | 完整的客户中心功能                               |

### 4.3 清算中心

> **可见条件**：`hasLicense = true`（TP 端）或 SP 付费购买整套系统

| 角色                     | 职责                                                                 |
| ------------------------ | -------------------------------------------------------------------- |
| **持牌 TP**        | 管理自己会员的清算：商户订单管理、余额管理、对账、费率/汇率/返点配置 |
| **SP（付费整套）** | 管理被推送商户的清算：同上                                           |
| **审批工单**       | 费率/汇率/返点变更审批（一人发起 → 一人审批）                       |

### 4.4 合规风控中心

> **可见条件**：`hasLicense = true`（TP 端）或 SP 付费购买整套系统

| 角色                     | 职责                                                      |
| ------------------------ | --------------------------------------------------------- |
| **持牌 TP**        | 客户合规运营：商户信息/余额/产品/订单的风险处置、RFI 管理 |
| **SP（付费整套）** | 同上                                                      |
| **渠道运营**       | 渠道订单查询（风险视角）、渠道调单管理                    |
| **审批工单**       | 合规审批（商户发起 → 合规初审 → 合规复审）              |

### 4.5 渠道中心

> **可见条件**：`hasLicense = true`（TP 端）或 SP 付费购买整套系统

| 角色                     | 渠道是什么                        | 职责                                                           |
| ------------------------ | --------------------------------- | -------------------------------------------------------------- |
| **持牌 TP**        | 各 SP 就是渠道（EX 内部 SP 模式） | 渠道管理、渠道能力（自动同步 SP 产品）、渠道路由、渠道订单查询 |
| **SP（付费整套）** | 外部 Channel + 其他 EX 内部 SP    | 同上，但还可接入外部 Channel                                   |

> 持牌 TP 的渠道中心与 `channel-center-design.md` 中描述的"EX 内部 SP"模式一致：
>
> - 渠道能力自动同步自 SP 的产品定义（只读）
> - 只需配置成本费率、协议有效期、路由优先级
> - API 对接走 EX 内部协议（自动）

### 4.6 财资中心

> **可见条件**：`hasLicense = true`（TP 端）或 SP 付费购买整套系统

| 角色                     | 职责                                                   |
| ------------------------ | ------------------------------------------------------ |
| **持牌 TP**        | 管理自有资金：头寸管理、资金调拨、备付金管理、外汇管理 |
| **SP（付费整套）** | 同上                                                   |

> 财资中心管"自有资金"（非商户资金），与清算中心管"商户资金"区分。

### 4.7 工作流中心

> **可见条件**：SA 管理后台 only

| 角色                    | 职责                                            |
| ----------------------- | ----------------------------------------------- |
| **EX 运营（SA）** | 定义审批流程模板、配置节点/审批人/条件/超时策略 |

> 工作流中心只定义流程，不处理业务。审批工单在各领域中心内处理。

---

## 5. TP 与 SP 的关系矩阵

### 5.1 代理模式 vs 直接合作模式

```
代理模式：
  TP（代理商）──签约代理──▶ SP（产品提供方）
       │                        │
       │ 推送商户信息             │ 为商户开户/清算
       └────────────────────────┘
       SP 视角：TP 是"机构代理商"

直接合作模式：
  TP（持牌）──签约渠道──▶ SP（渠道）
       │                        │
       │ 不推送商户               │ 只提供底层能力
       │ TP 自己管商户/清算        │
       └────────────────────────┘
       SP 视角：TP 是"机构客户"
```

### 5.2 同一 TP 的混合模式

```
某 TP（有收单牌照，无收款牌照）：

  收单产品：直接合作模式
    └─ TP 用自己牌照 → SP-A 是渠道 → TP 自己清算

  收款产品：代理模式
    └─ TP 代理 SP-B → 推送商户给 SP-B → SP-B 清算
```

### 5.3 TP + SP 双身份

```
BB（TP + SP）：

  作为 TP：
    ├─ 有自己的客户（会员）
    ├─ 用自己牌照服务客户
    ├─ IPL 是 BB 的渠道（渠道中心管理）
    └─ 有清算中心、合规中心、渠道中心、财资中心

  作为 SP：
    ├─ 将发卡能力集成到 EX
    ├─ 其他 TP（如鲲鹏）可代理 BB 的发卡产品
    ├─ 鲲鹏推送商户给 BB → BB 为商户提供发卡服务
    └─ 购买了 EX 整套系统（SP 端也有清算/合规等）
```

---

## 6. SP 后台 vs TP 后台

### 6.1 SP 后台（基础模式）

所有 SP 都有一个 SP 后台，EX 自动同步以下数据：

| 数据               | 说明                      |
| ------------------ | ------------------------- |
| **商户信息** | TP 推送过来的商户基本信息 |
| **交易数据** | 通过该 SP 处理的交易记录  |
| **商户计费** | 商户的费率配置            |
| **结算数据** | 结算单、结算记录          |

> SP 后台是只读 + 基础操作，不包含清算中心、合规中心等高级功能。

### 6.2 SP 后台（付费整套）

SP 单独付费后，可获得与持牌 TP 相同的中心能力：

| 中心                   | 说明                                             |
| ---------------------- | ------------------------------------------------ |
| **清算中心**     | 管理被推送商户的清算（费率/汇率/返点/对账/余额） |
| **合规风控中心** | 管理被推送商户的合规（KYC/风险处置/RFI）         |
| **渠道中心**     | 管理外部 Channel 和其他 EX 内部 SP               |
| **财资中心**     | 管理 SP 自有资金                                 |

### 6.3 TP + SP 机构的两个后台

| 后台              | 管什么                               | 客户是谁       |
| ----------------- | ------------------------------------ | -------------- |
| **TP 后台** | 管自己的会员、自己的清算、自己的渠道 | 自己的会员     |
| **SP 后台** | 管其他 TP 推送过来的商户             | 其他 TP 的商户 |

> IPL 和 BB 同时有 TP 后台和 SP 后台，管理不同维度的客户和业务。

---

## 7. 关键边界总结

| 边界                           | 说明                                                                 |
| ------------------------------ | -------------------------------------------------------------------- |
| **SP vs TP**             | SP 是能力提供方，TP 是能力使用方；两者独立，可组合                   |
| **代理 vs 直接合作**     | 代理 = 推送商户给 SP；直接合作 = TP 自己管商户，SP 是渠道            |
| **会员 vs 商户**         | 同一客户，TP 视角叫会员，SP 视角叫商户                               |
| **usesOwnLicense 控制**  | 通过自己牌照服务客户的 TP 有清算/合规/渠道/财资中心；纯代理 TP 没有（即使持牌） |
| **SP 基础 vs 付费**      | SP 基础模式只有 SP 后台；付费后可获得整套中心能力                    |
| **产品中心 vs 渠道中心** | 产品中心管"卖什么给商户"（前端）；渠道中心管"用什么能力交付"（后端） |
| **清算中心 vs 财资中心** | 清算中心管"商户资金"；财资中心管"自有资金"                           |
| **渠道中心 vs 合规风控** | 渠道中心的渠道订单查询是运营视角；合规的渠道运营是风险视角           |
| **工作流中心 vs 各领域** | 工作流中心只定义流程模板；审批工单在各领域中心内处理                 |

---

## 附录：相关文档

| 文档                              | 说明                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| `tp-sp-center-permissions.html` | TP 端各中心详细权限矩阵（菜单/功能/角色）                    |
| `channel-center-design.md`      | 渠道中心设计：Channel 升级 SP、SP 作为 Channel、各种处理场景 |
