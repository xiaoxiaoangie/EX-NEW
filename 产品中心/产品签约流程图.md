# 产品签约流程图

## 1. 整体产品流程时序图

```mermaid
sequenceDiagram
    participant SA as EX-SA Portal
    participant PP as SP-PP Portal
    participant TP as TE-TP Portal
    participant MP as ME-MP Portal
    participant System as 系统后台

    Note over SA: 第一阶段：产品定义
    SA->>System: 1. 初始化产品定义
    SA->>System: 2. 配置产品基础信息
    SA->>System: 3. 设置产品能力范围
  
    Note over PP: 第二阶段：服务商准备
    PP->>System: 4. 维护渠道能力
    PP->>System: 5. 配置技术参数
    PP->>System: 6. 上架产品到平台
    System-->>PP: 产品上架成功
  
    Note over SA,TP: 第三阶段：租户签约
    TP->>SA: 7. 租户注册申请
    SA->>System: 8. 创建租户账户
    SA->>System: 9. 配置租户基本信息
    SA->>System: 10. 配置科技产品+返点
    SA->>System: 11. 配置结算信息
    SA->>System: 12. 租户签约服务商产品
    System->>PP: 13. 触发服务商开通流程
    PP->>System: 14. 服务商确认开通
    System-->>SA: 租户签约完成
    System-->>TP: 同步租户凭证和配置
  
    Note over MP: 第四阶段：商户签约
    MP->>TP: 15. 商户注册申请
    TP->>System: 16. 创建商户账户
    TP->>System: 17. 商户签约产品
    System-->>MP: 商户签约完成
  
    Note over MP: 第五阶段：产品使用
    MP->>System: 18. 调用产品API
    System->>PP: 19. 路由到服务商
    PP-->>System: 20. 返回处理结果
    System-->>MP: 21. 返回业务结果
```

## 2. 租户签约详细流程图

```mermaid
flowchart TD
    Start([开始:租户签约]) --> A[1租户注册]
  
    A --> A1[输入手机号邮箱]
    A1 --> A2[输入联系人姓名]
    A2 --> A3[保存注册信息]
    A3 --> A4{生成登录凭证}
    A4 -->|成功| B[2租户基本信息搜集]
    A4 -->|失败| A1
  
    B --> B1[填写租户基本信息]
    B1 --> B2[填写租户品牌信息]
    B2 --> B3[填写租户客服信息]
    B3 --> B4[提交基本信息]
    B4 --> B5{基本信息审核}
    B5 -->|审核中| B6[等待审核]
    B6 --> B5
    B5 -->|审核通过| C[3科技产品配置]
    B5 -->|审核拒绝| B1
  
    C --> C1[选择科技产品]
    C1 --> C2[配置产品返点]
    C2 --> C3[提交产品配置]
    C3 --> C4{产品配置审核}
    C4 -->|审核中| C5[等待审核]
    C5 --> C4
    C4 -->|审核通过| D[4结算信息配置]
    C4 -->|审核拒绝| C1
  
    D --> D1[配置结算账户]
    D1 --> D2[配置结算周期]
    D2 --> D3[提交结算信息]
    D3 --> D4{结算信息审核}
    D4 -->|审核中| D5[等待审核]
    D5 --> D4
    D4 -->|审核通过| E[5签约服务商产品]
    D4 -->|审核拒绝| D1
  
    E --> E1[选择服务商产品]
    E1 --> E2[同步结算信息到SP]
    E2 --> E3[触发SP开通流程]
    E3 --> E4{SP确认开通}
    E4 -->|开通成功| F[签约完成]
    E4 -->|开通失败| E5[记录失败原因]
    E5 --> E1
  
    F --> End([结束:租户可使用产品])
```

## 3. 租户基本信息审核流程

```mermaid
stateDiagram-v2
    [*] --> 信息填写
    信息填写 --> 待审核: 提交
    待审核 --> 审核中: 分配审核员
    审核中 --> 审核通过: 信息完整准确
    审核中 --> 审核拒绝: 信息不完整/不准确
    审核中 --> 补充材料: 需要更多信息
    补充材料 --> 信息填写: 租户补充
    审核拒绝 --> 信息填写: 重新填写
    审核通过 --> [*]
```

## 4. 产品配置审核流程

```mermaid
stateDiagram-v2
    [*] --> 产品选择
    产品选择 --> 返点配置: 选择完成
    返点配置 --> 待审核: 提交配置
    待审核 --> 风控审核: 自动触发
    风控审核 --> 商务审核: 风控通过
    风控审核 --> 审核拒绝: 风控不通过
    商务审核 --> 财务审核: 商务通过
    商务审核 --> 审核拒绝: 商务不通过
    财务审核 --> 审核通过: 财务通过
    财务审核 --> 审核拒绝: 财务不通过
    审核拒绝 --> 产品选择: 重新配置
    审核通过 --> [*]
```

## 5. 系统角色与Portal对应关系

| 角色代码 | 角色名称               | Portal代码 | Portal名称          | 职责                         |
| -------- | ---------------------- | ---------- | ------------------- | ---------------------------- |
| EX       | Exchange平台           | SA         | System Admin Portal | 产品定义、租户管理、系统配置 |
| SP       | Service Provider服务商 | PP         | Provider Portal     | 渠道能力维护、产品上架       |
| TE       | Tenant租户             | TP         | Tenant Portal       | 产品签约、商户管理           |
| ME       | Merchant商户           | MP         | Merchant Portal     | 产品使用、交易管理           |

## 6. 关键业务对象关系图

```mermaid
erDiagram
    EX ||--o{ PRODUCT : defines
    SP ||--o{ CHANNEL : maintains
    SP ||--o{ PRODUCT : lists
    PRODUCT ||--o{ TENANT_CONTRACT : "signed by"
    TENANT ||--o{ TENANT_CONTRACT : signs
    TENANT ||--o{ MERCHANT : manages
    MERCHANT ||--o{ MERCHANT_CONTRACT : signs
    PRODUCT ||--o{ MERCHANT_CONTRACT : "signed by"
  
    EX {
        string platform_id
        string platform_name
    }
  
    PRODUCT {
        string product_id
        string product_name
        string product_type
        json capabilities
    }
  
    SP {
        string sp_id
        string sp_name
        string status
    }
  
    CHANNEL {
        string channel_id
        string channel_name
        json technical_params
    }
  
    TENANT {
        string tenant_id
        string tenant_name
        string contact_info
        json brand_info
    }
  
    TENANT_CONTRACT {
        string contract_id
        string tenant_id
        string product_id
        decimal rebate_rate
        json settlement_info
        string status
    }
  
    MERCHANT {
        string merchant_id
        string merchant_name
        string tenant_id
    }
  
    MERCHANT_CONTRACT {
        string contract_id
        string merchant_id
        string product_id
        string status
    }
```

## 7. 数据流转图

```mermaid
flowchart LR
    A[EX定义产品] --> B[产品库]
    C[SP维护渠道] --> D[渠道能力库]
    C --> E[SP上架产品]
    B --> E
    E --> F[可签约产品池]
  
    G[租户注册] --> H[租户信息库]
    H --> I[租户签约产品]
    F --> I
    I --> J[租户产品配置]
    J --> K[触发SP开通]
    D --> K
    K --> L[租户可用产品]
  
    M[商户注册] --> N[商户信息库]
    N --> O[商户签约产品]
    L --> O
    O --> P[商户可用产品]
  
    P --> Q[商户调用API]
    Q --> R[路由到SP]
    D --> R
    R --> S[返回结果]
```

## 使用说明

1. **时序图**：展示EX、SP、TE、ME四个角色在整个产品生命周期中的交互顺序
2. **流程图**：详细展示租户签约的5个步骤及审核流程
3. **状态图**：展示审核流程的状态转换
4. **关系图**：展示核心业务对象之间的关系
5. **数据流转图**：展示数据在系统中的流转路径

## 在Markdown编辑器中查看

推荐使用以下工具查看Mermaid图表：

- VS Code + Mermaid插件
- Typora
- 在线Mermaid编辑器：https://mermaid.live/
