<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EX Platform - User System</title>
    <style>
        :root {
            --primary: #5b6cf5;
            --primary-hover: #4a5ae0;
            --primary-light: #eef0ff;
            --bg: #f5f7fa;
            --white: #ffffff;
            --border: #e2e8f0;
            --border-light: #f1f3f5;
            --text-primary: #1a202c;
            --text-secondary: #4a5568;
            --text-muted: #a0aec0;
            --text-label: #6b7280;
            --success: #10b981;
            --success-bg: #d1fae5;
            --success-text: #065f46;
            --warning-bg: #fef3c7;
            --warning-text: #92400e;
            --danger: #ef4444;
            --danger-bg: #fee2e2;
            --danger-text: #991b1b;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
            --radius: 8px;
            --radius-lg: 12px;
            --font: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', 'PingFang SC', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font); background: var(--bg); color: var(--text-primary); -webkit-font-smoothing: antialiased; }

        /* ===== Header ===== */
        .header {
            background: var(--white);
            border-bottom: 1px solid var(--border);
            padding: 0 32px;
            height: 56px;
            display: flex;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .header-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-right: 32px;
        }
        .header-logo svg { flex-shrink: 0; }
        .header-logo-text { font-size: 15px; font-weight: 600; color: var(--text-primary); }
        .header-logo-sub { font-size: 11px; color: var(--text-muted); }

        .header-nav { display: flex; gap: 2px; }
        .header-nav-item {
            padding: 6px 14px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.15s;
            border: none;
            background: none;
        }
        .header-nav-item:hover { background: var(--bg); }
        .header-nav-item.active { background: var(--primary); color: #fff; }

        .header-right {
            margin-left: auto;
            display: flex;
            align-items: center;
            gap: 16px;
        }
        .header-account {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 5px 12px 5px 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-secondary);
            background: var(--white);
            transition: all 0.15s;
            position: relative;
        }
        .header-account:hover { border-color: #cbd5e0; background: #fafbfc; }
        .header-account .account-dot {
            width: 8px; height: 8px;
            border-radius: 50%;
            background: var(--success);
        }
        .header-account .caret { font-size: 10px; color: var(--text-muted); margin-left: 4px; }

        .account-dropdown {
            display: none;
            position: absolute;
            top: calc(100% + 6px);
            right: 0;
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            min-width: 260px;
            z-index: 200;
            overflow: hidden;
        }
        .account-dropdown.show { display: block; }
        .account-dropdown-header {
            padding: 10px 16px;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border-light);
        }
        .account-dropdown-item {
            padding: 10px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            font-size: 13px;
            color: var(--text-secondary);
            transition: background 0.1s;
        }
        .account-dropdown-item:hover { background: var(--bg); }
        .account-dropdown-item .account-item-name { font-weight: 500; }

        .header-avatar {
            display: none;
            width: 32px; height: 32px;
            border-radius: 50%;
            background: var(--primary);
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            align-items: center;
            justify-content: center;
        }

        /* ===== Badge ===== */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 500;
            line-height: 1.4;
        }
        .badge-success { background: var(--success-bg); color: var(--success-text); }
        .badge-warning { background: var(--warning-bg); color: var(--warning-text); }
        .badge-danger { background: var(--danger-bg); color: var(--danger-text); }
        .badge-primary { background: var(--primary-light); color: var(--primary); }
        .badge-muted { background: #f1f3f5; color: var(--text-muted); }

        /* ===== Module Container ===== */
        .module { display: none; min-height: calc(100vh - 56px); }
        .module.active { display: block; }

        /* ===== LOGIN ===== */
        .login-layout {
            display: flex;
            min-height: calc(100vh - 56px);
        }
        .login-brand {
            width: 420px;
            background: linear-gradient(160deg, #5b6cf5 0%, #8b5cf6 100%);
            padding: 60px 48px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            color: #fff;
            flex-shrink: 0;
        }
        .login-brand h1 { font-size: 28px; font-weight: 700; line-height: 1.3; margin-bottom: 12px; }
        .login-brand p { font-size: 15px; opacity: 0.8; line-height: 1.6; margin-bottom: 32px; }
        .login-brand-features { list-style: none; }
        .login-brand-features li {
            font-size: 13px;
            opacity: 0.75;
            padding: 6px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .login-brand-features li::before {
            content: '';
            width: 6px; height: 6px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            flex-shrink: 0;
        }

        .login-main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 48px;
            background: var(--white);
        }
        .login-form {
            width: 100%;
            max-width: 380px;
        }
        .login-form h2 { font-size: 22px; font-weight: 600; margin-bottom: 4px; }
        .login-form .form-subtitle { font-size: 14px; color: var(--text-muted); margin-bottom: 28px; }

        /* ===== Form ===== */
        .form-group { margin-bottom: 18px; }
        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        .form-input {
            width: 100%;
            padding: 9px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 14px;
            color: var(--text-primary);
            background: var(--white);
            outline: none;
            transition: border-color 0.15s, box-shadow 0.15s;
        }
        .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(91,108,245,0.1);
        }
        .form-input::placeholder { color: #cbd5e0; }
        .form-hint { font-size: 12px; color: var(--text-muted); margin-top: 4px; }

        .input-row { display: flex; gap: 8px; }
        .input-row .form-input { flex: 1; }

        .country-select {
            width: 100px;
            padding: 9px 8px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            color: var(--text-secondary);
            background: var(--white);
            outline: none;
            cursor: pointer;
        }
        .country-select:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(91,108,245,0.1); }

        /* ===== Tabs ===== */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 24px;
        }
        .tab {
            padding: 10px 0;
            margin-right: 24px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            transition: all 0.15s;
        }
        .tab:hover { color: var(--text-secondary); }
        .tab.active { color: var(--text-primary); border-bottom-color: var(--primary); }

        /* ===== Toggle Buttons ===== */
        .toggle-group {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }
        .toggle-btn {
            flex: 1;
            padding: 9px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            background: var(--white);
            cursor: pointer;
            text-align: center;
            transition: all 0.15s;
        }
        .toggle-btn:hover { border-color: #cbd5e0; }
        .toggle-btn.active {
            border-color: var(--primary);
            background: var(--primary-light);
            color: var(--primary);
        }

        /* ===== Buttons ===== */
        .btn {
            padding: 9px 18px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            font-family: var(--font);
        }
        .btn-primary { background: var(--primary); color: #fff; width: 100%; padding: 10px; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-primary:disabled { background: #cbd5e0; cursor: not-allowed; }
        .btn-secondary {
            background: var(--white);
            color: var(--text-secondary);
            border: 1px solid var(--border);
        }
        .btn-secondary:hover { background: var(--bg); }
        .btn-ghost {
            background: none;
            color: var(--primary);
            padding: 6px 10px;
            font-size: 13px;
        }
        .btn-ghost:hover { background: var(--primary-light); }
        .btn-sm { padding: 6px 12px; font-size: 13px; }
        .btn-danger { background: none; color: var(--danger); }
        .btn-danger:hover { background: var(--danger-bg); }

        /* ===== OTP ===== */
        .otp-row {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 20px 0;
        }
        .otp-box {
            width: 44px; height: 52px;
            text-align: center;
            font-size: 22px;
            font-weight: 600;
            border: 1.5px solid var(--border);
            border-radius: 8px;
            outline: none;
            color: var(--text-primary);
            transition: border-color 0.15s;
        }
        .otp-box:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(91,108,245,0.1); }

        /* ===== Password Rules ===== */
        .pw-rules { margin-top: 8px; }
        .pw-rule {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: var(--text-muted);
            padding: 2px 0;
        }
        .pw-rule .dot {
            width: 14px; height: 14px;
            border-radius: 50%;
            border: 1.5px solid var(--border);
            display: flex; align-items: center; justify-content: center;
            font-size: 9px;
            flex-shrink: 0;
        }
        .pw-rule.pass { color: var(--success); }
        .pw-rule.pass .dot { background: var(--success); border-color: var(--success); color: #fff; }

        /* ===== Step Dots ===== */
        .steps {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            margin-bottom: 28px;
        }
        .step-num {
            width: 28px; height: 28px;
            border-radius: 50%;
            font-size: 12px; font-weight: 600;
            display: flex; align-items: center; justify-content: center;
            background: #edf2f7;
            color: var(--text-muted);
        }
        .step-num.active { background: var(--primary); color: #fff; }
        .step-num.done { background: var(--success); color: #fff; }
        .step-bar { width: 48px; height: 2px; background: #edf2f7; }
        .step-bar.done { background: var(--success); }

        /* ===== Resend ===== */
        .resend { text-align: center; font-size: 13px; color: var(--text-muted); margin-top: 10px; }
        .resend a { color: var(--primary); font-weight: 500; cursor: pointer; text-decoration: none; }
        .resend a.off { color: var(--text-muted); pointer-events: none; }

        /* ===== Login Step ===== */
        .ls { display: none; }
        .ls.on { display: block; }

        /* ===== User Center ===== */
        .uc-layout { max-width: 720px; margin: 0 auto; padding: 36px 20px; }
        .uc-tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 28px;
        }
        .uc-tab {
            padding: 10px 0;
            margin-right: 28px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
            transition: all 0.15s;
        }
        .uc-tab:hover { color: var(--text-secondary); }
        .uc-tab.active { color: var(--text-primary); border-bottom-color: var(--primary); }

        .uc-panel { display: none; }
        .uc-panel.on { display: block; }

        /* ===== Card ===== */
        .card {
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px 24px;
            margin-bottom: 16px;
            box-shadow: var(--shadow-sm);
        }
        .card-head {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 2px;
        }
        .card-sub {
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 16px;
        }

        /* ===== Info Row ===== */
        .info-row {
            display: flex;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid var(--border-light);
        }
        .info-row:last-child { border-bottom: none; }
        .info-key {
            width: 130px;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-label);
            flex-shrink: 0;
        }
        .info-val {
            flex: 1;
            font-size: 14px;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .info-act { margin-left: auto; }

        /* ===== 2FA Row ===== */
        .tfa-row {
            display: flex;
            align-items: flex-start;
            padding: 14px 0;
            border-bottom: 1px solid var(--border-light);
        }
        .tfa-row:last-child { border-bottom: none; }
        .tfa-icon {
            width: 36px; height: 36px;
            border-radius: 8px;
            background: var(--primary-light);
            display: flex; align-items: center; justify-content: center;
            margin-right: 12px;
            flex-shrink: 0;
        }
        .tfa-icon svg { width: 18px; height: 18px; stroke: var(--primary); }
        .tfa-body { flex: 1; }
        .tfa-name { font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 8px; }
        .tfa-desc { font-size: 13px; color: var(--text-muted); margin-top: 1px; }
        .tfa-act { margin-left: 12px; flex-shrink: 0; }

        /* ===== Table ===== */
        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th {
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }
        .data-table td {
            padding: 14px 0;
            font-size: 14px;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-light);
        }
        .data-table .name-cell { font-weight: 500; color: var(--text-primary); }
        .data-table .sub-cell { font-size: 12px; color: var(--text-muted); }

        /* ===== Modal ===== */
        .overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(2px);
            z-index: 500;
            align-items: center;
            justify-content: center;
        }
        .overlay.show { display: flex; }
        .modal {
            background: var(--white);
            border-radius: var(--radius-lg);
            padding: 28px;
            width: 100%;
            max-width: 440px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            position: relative;
            animation: fadeUp 0.2s ease;
        }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-x {
            position: absolute;
            top: 16px; right: 16px;
            width: 28px; height: 28px;
            border: none;
            background: var(--bg);
            border-radius: 50%;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px;
            color: var(--text-muted);
        }
        .modal-x:hover { background: #e2e8f0; }
        .modal h3 { font-size: 17px; font-weight: 600; margin-bottom: 4px; }
        .modal .mdesc { font-size: 13px; color: var(--text-muted); margin-bottom: 20px; line-height: 1.5; }

        /* ===== QR ===== */
        .qr-box {
            width: 160px; height: 160px;
            margin: 0 auto 12px;
            background: var(--bg);
            border: 1px dashed var(--border);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            gap: 6px;
        }
        .qr-box svg { width: 40px; height: 40px; stroke: var(--text-muted); }
        .qr-box span { font-size: 11px; color: var(--text-muted); }

        .secret-box {
            background: var(--bg);
            padding: 10px 14px;
            border-radius: 6px;
            font-family: 'SF Mono', 'Fira Code', monospace;
            font-size: 14px;
            text-align: center;
            letter-spacing: 2px;
            margin-bottom: 16px;
            color: var(--text-primary);
        }

        /* ===== Recovery Codes ===== */
        .rc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 6px;
            margin: 14px 0;
        }
        .rc-item {
            background: var(--bg);
            padding: 8px;
            border-radius: 6px;
            font-family: 'SF Mono', monospace;
            font-size: 13px;
            text-align: center;
            letter-spacing: 1px;
            color: var(--text-secondary);
        }

        /* ===== Toast ===== */
        .toast {
            position: fixed;
            top: 68px;
            right: 20px;
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            color: #fff;
            z-index: 9999;
            transform: translateX(calc(100% + 40px));
            transition: transform 0.25s ease;
            box-shadow: var(--shadow-md);
        }
        .toast.show { transform: translateX(0); }
        .toast.ok { background: var(--success); }
        .toast.err { background: var(--danger); }
        .toast.inf { background: var(--primary); }

        /* ===== Welcome ===== */
        .welcome { text-align: center; padding: 40px 0; }
        .welcome h2 { font-size: 22px; font-weight: 600; margin: 12px 0 6px; }
        .welcome p { font-size: 14px; color: var(--text-muted); margin-bottom: 24px; }

        /* ===== Three-dot ===== */
        .dotmenu { position: relative; }
        .dotmenu-btn {
            width: 28px; height: 28px;
            border: 1px solid var(--border);
            background: var(--white);
            border-radius: 6px;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px;
            color: var(--text-muted);
            letter-spacing: 1px;
        }
        .dotmenu-btn:hover { background: var(--bg); }
        .dotmenu-dd {
            display: none;
            position: absolute;
            top: calc(100% + 4px);
            right: 0;
            background: var(--white);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            box-shadow: var(--shadow-md);
            min-width: 160px;
            z-index: 10;
            overflow: hidden;
        }
        .dotmenu-dd.show { display: block; }
        .dotmenu-item {
            padding: 8px 14px;
            font-size: 13px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: background 0.1s;
        }
        .dotmenu-item:hover { background: var(--bg); }
        .dotmenu-item.red { color: var(--danger); }

        /* ===== Helpers ===== */
        .link { color: var(--primary); font-weight: 500; cursor: pointer; text-decoration: none; font-size: 13px; }
        .link:hover { text-decoration: underline; }
        .center { text-align: center; }
        .mt-12 { margin-top: 12px; }
        .mt-20 { margin-top: 20px; }
        .mt-24 { margin-top: 24px; }
        .mb-16 { margin-bottom: 16px; }
        .flex-between { display: flex; align-items: center; justify-content: space-between; }
    </style>
</head>
<body>

<!-- ===== HEADER ===== -->
<div class="header">
    <div class="header-logo">
        <svg width="28" height="28" viewBox="0 0 32 32" fill="none"><rect width="32" height="32" rx="8" fill="#5b6cf5"/><path d="M16 8L22 12V20L16 24L10 20V12L16 8Z" fill="white"/></svg>
        <div>
            <div class="header-logo-text">EX Platform</div>
        </div>
    </div>
    <div class="header-nav">
        <button class="header-nav-item active" onclick="goModule('login',this)">Login</button>
        <button class="header-nav-item" onclick="goModule('uc',this)">User Center</button>
        <button class="header-nav-item" onclick="goModule('demo',this)" style="color:var(--primary);">Demo Scenarios</button>
    </div>
    <div class="header-right">
        <div class="header-account" id="hAccount" onclick="toggleAccDD()">
            <span class="account-dot"></span>
            <span id="hAccountName">ABC Trading</span>
            <span class="caret">‚ñæ</span>
            <div class="account-dropdown" id="accDD">
                <div class="account-dropdown-header">Switch account</div>
                <div class="account-dropdown-item" onclick="pickAccount('ABC Trading','Owner')"><span class="account-item-name">ABC Trading</span><span class="badge badge-primary">Owner</span></div>
                <div class="account-dropdown-item" onclick="pickAccount('XYZ Corp','Admin')"><span class="account-item-name">XYZ Corp</span><span class="badge badge-success">Admin</span></div>
                <div class="account-dropdown-item" onclick="pickAccount('Global Inc','Member')"><span class="account-item-name">Global Inc</span><span class="badge badge-muted">Member</span></div>
            </div>
        </div>
        <div class="header-avatar" id="hAvatar">J</div>
    </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- ========== MODULE: LOGIN ========== -->
<div class="module active" id="mod-login">
    <div class="login-layout">
        <div class="login-brand">
            <h1>Cross-border payments,<br>simplified.</h1>
            <p>Manage merchants, transactions, and settlements on one unified platform.</p>
            <ul class="login-brand-features">
                <li>Verification code login = auto registration</li>
                <li>Multi-credential support (Email + Mobile)</li>
                <li>Multi-merchant (MID) management</li>
                <li>2FA security protection</li>
            </ul>
        </div>
        <div class="login-main">
            <div class="login-form">

                <!-- S1: Credential -->
                <div class="ls on" id="s1">
                    <h2>Sign in</h2>
                    <p class="form-subtitle">Enter your email or mobile number to continue.</p>
                    <div class="tabs">
                        <div class="tab active" onclick="loginTab('email',this)">Email</div>
                        <div class="tab" onclick="loginTab('mobile',this)">Mobile</div>
                    </div>
                    <div id="f-email">
                        <div class="form-group">
                            <label class="form-label">Email address</label>
                            <input class="form-input" type="email" id="iEmail" placeholder="you@example.com">
                        </div>
                    </div>
                    <div id="f-mobile" style="display:none;">
                        <div class="form-group">
                            <label class="form-label">Mobile number</label>
                            <div class="input-row">
                                <select class="country-select" id="iCC">
                                    <option value="+1">üá∫üá∏ +1</option>
                                    <option value="+86">üá®üá≥ +86</option>
                                    <option value="+852">üá≠üá∞ +852</option>
                                    <option value="+81">üáØüáµ +81</option>
                                    <option value="+44">üá¨üáß +44</option>
                                    <option value="+65">üá∏üá¨ +65</option>
                                </select>
                                <input class="form-input" type="tel" id="iMobile" placeholder="Phone number">
                            </div>
                            <div class="form-hint">üìç Auto-detected: <strong id="ipCountry">United States (+1)</strong></div>
                        </div>
                    </div>
                    <div class="toggle-group">
                        <div class="toggle-btn active" onclick="verifyMode('code',this)">Verification code</div>
                        <div class="toggle-btn" onclick="verifyMode('pw',this)">Password</div>
                    </div>
                    <button class="btn btn-primary" onclick="doStep1()">Continue</button>
                    <p class="center mt-12" style="font-size:12px;color:var(--text-muted);">First time? Just sign in ‚Äî your account is created automatically.</p>
                </div>

                <!-- S2A: OTP -->
                <div class="ls" id="s2code">
                    <div class="steps">
                        <div class="step-num done">‚úì</div><div class="step-bar done"></div>
                        <div class="step-num active">2</div><div class="step-bar"></div>
                        <div class="step-num">3</div>
                    </div>
                    <h2>Enter verification code</h2>
                    <p class="form-subtitle">A 6-digit code was sent to <strong id="otpTarget"></strong></p>
                    <div class="otp-row" id="otpRow">
                        <input class="otp-box" maxlength="1" oninput="otpNext(this,0)">
                        <input class="otp-box" maxlength="1" oninput="otpNext(this,1)">
                        <input class="otp-box" maxlength="1" oninput="otpNext(this,2)">
                        <input class="otp-box" maxlength="1" oninput="otpNext(this,3)">
                        <input class="otp-box" maxlength="1" oninput="otpNext(this,4)">
                        <input class="otp-box" maxlength="1" oninput="otpNext(this,5)">
                    </div>
                    <div class="resend">Didn't receive it? <a id="resendA" class="off" onclick="resend()">Resend (<span id="resendT">60</span>s)</a></div>
                    <div class="mt-20"><button class="btn btn-primary" onclick="doVerifyOTP()">Verify & sign in</button></div>
                    <p class="center mt-12"><a class="link" onclick="goLS('s1')">‚Üê Back</a></p>
                </div>

                <!-- S2B: Password -->
                <div class="ls" id="s2pw">
                    <div class="steps">
                        <div class="step-num done">‚úì</div><div class="step-bar done"></div>
                        <div class="step-num active">2</div><div class="step-bar"></div>
                        <div class="step-num">3</div>
                    </div>
                    <h2>Enter your password</h2>
                    <p class="form-subtitle">Signing in as <strong id="pwTarget"></strong></p>
                    <div class="form-group">
                        <label class="form-label">Password</label>
                        <input class="form-input" type="password" id="iPW" placeholder="Enter password">
                    </div>
                    <div style="text-align:right;"><a class="link" onclick="doForgot()">Forgot password?</a></div>
                    <div class="mt-20"><button class="btn btn-primary" onclick="doPWLogin()">Sign in</button></div>
                    <p class="center mt-12"><a class="link" onclick="goLS('s1')">‚Üê Back</a></p>
                </div>

                <!-- S2C: 2FA -->
                <div class="ls" id="s2fa">
                    <div class="steps">
                        <div class="step-num done">‚úì</div><div class="step-bar done"></div>
                        <div class="step-num done">‚úì</div><div class="step-bar done"></div>
                        <div class="step-num active">3</div>
                    </div>
                    <div class="center mb-16">
                        <div style="width:52px;height:52px;margin:0 auto;background:var(--primary-light);border-radius:14px;display:flex;align-items:center;justify-content:center;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                        </div>
                    </div>
                    <h2 class="center">Two-factor authentication</h2>
                    <p class="form-subtitle center">Enter the 6-digit code from your authenticator app.</p>
                    <div class="otp-row" id="tfaRow">
                        <input class="otp-box" maxlength="1" oninput="otpNext2(this,0)">
                        <input class="otp-box" maxlength="1" oninput="otpNext2(this,1)">
                        <input class="otp-box" maxlength="1" oninput="otpNext2(this,2)">
                        <input class="otp-box" maxlength="1" oninput="otpNext2(this,3)">
                        <input class="otp-box" maxlength="1" oninput="otpNext2(this,4)">
                        <input class="otp-box" maxlength="1" oninput="otpNext2(this,5)">
                    </div>
                    <div class="mt-20"><button class="btn btn-primary" onclick="do2FA()">Verify</button></div>
                    <p class="center mt-12"><a class="link" onclick="doRecoveryInput()">Use a recovery code instead</a></p>
                    <p class="center mt-12"><a class="link" onclick="goLS('s1')">‚Üê Back to sign in</a></p>
                </div>

                <!-- S3: Welcome -->
                <div class="ls" id="s3welcome">
                    <div class="welcome">
                        <div style="font-size:40px;">üéâ</div>
                        <h2>Welcome to EX Platform</h2>
                        <p>Your account has been created. Set a password for future logins?</p>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password (optional)</label>
                        <input class="form-input" type="password" id="iNewPW" placeholder="Create a strong password" oninput="pwCheck(this.value)">
                        <div class="pw-rules" id="pwRules">
                            <div class="pw-rule" id="r-len"><span class="dot">‚óã</span> At least 8 characters</div>
                            <div class="pw-rule" id="r-up"><span class="dot">‚óã</span> At least 1 uppercase letter</div>
                            <div class="pw-rule" id="r-lo"><span class="dot">‚óã</span> At least 1 lowercase letter</div>
                            <div class="pw-rule" id="r-num"><span class="dot">‚óã</span> At least 1 number or symbol</div>
                        </div>
                        <div class="form-hint">For improved security, avoid passwords used with other websites.</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirm password</label>
                        <input class="form-input" type="password" id="iConfPW" placeholder="Re-enter password">
                    </div>
                    <div style="display:flex;gap:10px;">
                        <button class="btn btn-secondary" style="flex:1;" onclick="doSkipPW()">Skip</button>
                        <button class="btn btn-primary" style="flex:1;" onclick="doSetPW()">Set password</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- ========== MODULE: USER CENTER ========== -->
<div class="module" id="mod-uc">
    <div class="uc-layout">
        <div class="uc-tabs">
            <div class="uc-tab active" onclick="ucTab('profile',this)">Profile</div>
            <div class="uc-tab" onclick="ucTab('security',this)">Security</div>
            <div class="uc-tab" onclick="ucTab('accounts',this)">Accounts</div>
            <div class="uc-tab" onclick="ucTab('permissions',this)">Permissions</div>
        </div>

        <!-- PROFILE -->
        <div class="uc-panel on" id="p-profile">
            <div class="card">
                <div class="card-head">Contact & login method</div>
                <div class="card-sub">Manage your email, mobile, and preferred login method.</div>
                <div class="info-row">
                    <div class="info-key">Email</div>
                    <div class="info-val"><span id="dEmail">liuxiaoxiaoangie@gmail.com</span><span class="badge badge-success">Verified</span></div>
                    <div class="info-act"><button class="btn btn-ghost btn-sm" onclick="openM('mEditEmail')">Edit</button></div>
                </div>
                <div class="info-row">
                    <div class="info-key">Mobile</div>
                    <div class="info-val"><span id="dMobile">+852 96412374</span><span class="badge badge-success">Verified</span></div>
                    <div class="info-act"><button class="btn btn-ghost btn-sm" onclick="openM('mEditMobile')">Edit</button></div>
                </div>
                <div class="info-row">
                    <div class="info-key">Login method</div>
                    <div class="info-val"><span id="dLM">Email</span><span style="color:var(--text-muted);cursor:help;" title="Default input on the login page">‚ìò</span></div>
                    <div class="info-act"><button class="btn btn-ghost btn-sm" onclick="openM('mLM')">Edit</button></div>
                </div>
            </div>
            <div class="card">
                <div class="card-head">Basic info</div>
                <div class="card-sub">Your personal information.</div>
                <div class="info-row">
                    <div class="info-key">Nickname</div>
                    <div class="info-val"><span id="dNick">john</span></div>
                    <div class="info-act"><button class="btn btn-ghost btn-sm" onclick="openM('mNick')">Edit</button></div>
                </div>
                <div class="info-row">
                    <div class="info-key">Language</div>
                    <div class="info-val"><span id="dLang">English</span></div>
                    <div class="info-act"><button class="btn btn-ghost btn-sm" onclick="openM('mLang')">Edit</button></div>
                </div>
            </div>
        </div>

        <!-- SECURITY -->
        <div class="uc-panel" id="p-security">
            <div class="card">
                <div class="flex-between">
                    <div><div class="card-head">Password</div><div class="card-sub" style="margin-bottom:0;">Choose a strong password to keep your account safe.</div></div>
                    <button class="btn btn-secondary btn-sm" onclick="openM('mChgPW')">Change</button>
                </div>
            </div>
            <div class="card">
                <div class="card-head">Two-factor authentication (2FA)</div>
                <div class="card-sub">Adds a layer of security requiring an additional method to log in. <a class="link">Learn more</a></div>
                <div class="tfa-row">
                    <div class="tfa-icon"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><rect x="5" y="2" width="14" height="20" rx="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg></div>
                    <div class="tfa-body">
                        <div class="tfa-name">Authenticator app <span class="badge badge-primary" id="bAuthApp" style="display:none;">Default</span></div>
                        <div class="tfa-desc">Use a 3rd party authenticator app to generate codes.</div>
                    </div>
                    <div class="tfa-act" id="aAuthApp"><button class="btn btn-secondary btn-sm" onclick="openM('mAuthApp')">Set up</button></div>
                </div>
                <div class="tfa-row">
                    <div class="tfa-icon"><svg viewBox="0 0 24 24" fill="none" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg></div>
                    <div class="tfa-body">
                        <div class="tfa-name">SMS <span class="badge badge-muted" id="bSMS" style="display:none;">Enabled</span></div>
                        <div class="tfa-desc">Receive an authentication code via SMS.</div>
                    </div>
                    <div class="tfa-act" id="aSMS"><button class="btn btn-secondary btn-sm" onclick="openM('mSMS')">Set up</button></div>
                </div>
                <div style="border-top:1px solid var(--border-light);padding-top:14px;margin-top:4px;font-size:13px;color:var(--text-muted);">
                    <a class="link" onclick="openM('mRecovery')">Generate recovery codes</a> to log in if you lose 2FA access.
                </div>
            </div>
        </div>

        <!-- ACCOUNTS -->
        <div class="uc-panel" id="p-accounts">
            <div class="card">
                <div class="card-head">Your accounts</div>
                <div class="card-sub">View your associated accounts and roles. Go to <a class="link">Settings</a> for details.</div>
                <table class="data-table">
                    <thead><tr><th>Account name</th><th>Role</th><th>Owner type</th></tr></thead>
                    <tbody>
                        <tr><td><div class="name-cell">ABC Trading</div><div class="sub-cell">MID-001</div></td><td><span class="badge badge-primary">Owner</span></td><td><span class="badge badge-warning">ÂºÄÊà∑‰∫∫</span></td></tr>
                        <tr><td><div class="name-cell">XYZ Corp</div><div class="sub-cell">MID-002</div></td><td><span class="badge badge-success">Admin</span></td><td>‚Äî</td></tr>
                        <tr><td><div class="name-cell">Global Inc</div><div class="sub-cell">MID-003</div></td><td><span class="badge badge-muted">Member</span></td><td>‚Äî</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="card">
                <div class="card-head">Owner definition</div>
                <div class="card-sub">Owner requires identity verification. Only these types qualify:</div>
                <div class="tfa-row">
                    <div class="tfa-icon" style="background:var(--warning-bg);"><svg viewBox="0 0 24 24" fill="none" stroke="#92400e" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></div>
                    <div class="tfa-body"><div class="tfa-name" style="color:#92400e;">ÂºÄÊà∑‰∫∫ (Account Opener)</div><div class="tfa-desc">Created the MID and submitted KYC. Auto-assigned.</div></div>
                </div>
                <div class="tfa-row">
                    <div class="tfa-icon" style="background:var(--success-bg);"><svg viewBox="0 0 24 24" fill="none" stroke="#065f46" stroke-width="2"><path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="8.5" cy="7" r="4"/><path d="M20 8v6M23 11h-6"/></svg></div>
                    <div class="tfa-body"><div class="tfa-name" style="color:#065f46;">Ê≥ï‰∫∫ (Legal Representative)</div><div class="tfa-desc">Face recognition + mobile verification, or offline documents.</div></div>
                </div>
                <div class="tfa-row">
                    <div class="tfa-icon" style="background:#e0e7ff;"><svg viewBox="0 0 24 24" fill="none" stroke="#3730a3" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/></svg></div>
                    <div class="tfa-body"><div class="tfa-name" style="color:#3730a3;">Ëë£‰∫ã (Director)</div><div class="tfa-desc">Face recognition + mobile verification, or offline documents.</div></div>
                </div>
            </div>
        <!-- PERMISSIONS (Users.md 7.7 - MIDÁ∫ßÊìç‰ΩúÊùÉÈôêÊéàÊùÉ) -->
        <div class="uc-panel" id="p-permissions">
            <div class="card" style="background:var(--primary-light);border-color:var(--primary);border-style:dashed;">
                <div style="font-size:13px;color:var(--primary);font-weight:500;">You are viewing as <strong>Owner</strong> of <strong id="permMID">ABC Trading</strong>. You can configure which operations each user can perform independently.</div>
            </div>
            <div class="card">
                <div class="flex-between" style="margin-bottom:16px;">
                    <div><div class="card-head">MID operation permissions</div><div class="card-sub" style="margin-bottom:0;">Configure whether each user verifies with their own credential or requires Owner verification for sensitive operations.</div></div>
                </div>
                <table class="data-table">
                    <thead><tr><th>User</th><th>Initiate transaction</th><th>Fund operations</th><th>Merchant config</th><th>Add/remove members</th></tr></thead>
                    <tbody>
                        <tr>
                            <td><div class="name-cell">ÊùéÂõõ (Admin)</div><div class="sub-cell">li@test.com</div></td>
                            <td><span class="badge badge-success" style="cursor:pointer;" onclick="togglePerm(this)">Self</span></td>
                            <td><span class="badge badge-success" style="cursor:pointer;" onclick="togglePerm(this)">Self</span></td>
                            <td><span class="badge badge-danger" style="cursor:pointer;" onclick="togglePerm(this)">Owner</span></td>
                            <td><span class="badge badge-danger" style="cursor:pointer;" onclick="togglePerm(this)">Owner</span></td>
                        </tr>
                        <tr>
                            <td><div class="name-cell">Áéã‰∫î (Admin)</div><div class="sub-cell">wang@test.com</div></td>
                            <td><span class="badge badge-success" style="cursor:pointer;" onclick="togglePerm(this)">Self</span></td>
                            <td><span class="badge badge-danger" style="cursor:pointer;" onclick="togglePerm(this)">Owner</span></td>
                            <td><span class="badge badge-danger" style="cursor:pointer;" onclick="togglePerm(this)">Owner</span></td>
                            <td><span class="badge badge-danger" style="cursor:pointer;" onclick="togglePerm(this)">Owner</span></td>
                        </tr>
                        <tr>
                            <td><div class="name-cell">ËµµÂÖ≠ (Member)</div><div class="sub-cell">zhao@test.com</div></td>
                            <td><span class="badge badge-danger" style="cursor:pointer;" onclick="togglePerm(this)">Owner</span></td>
                            <td><span class="badge badge-danger" style="cursor:pointer;" onclick="togglePerm(this)">Owner</span></td>
                            <td><span class="badge badge-danger" style="cursor:pointer;" onclick="togglePerm(this)">Owner</span></td>
                            <td><span class="badge badge-danger" style="cursor:pointer;" onclick="togglePerm(this)">Owner</span></td>
                        </tr>
                    </tbody>
                </table>
                <div class="form-hint" style="margin-top:12px;">
                    <strong>Self</strong> = User verifies with their own credential. <strong>Owner</strong> = Verification code sent to Owner. Click badges to toggle. New users default to Owner for all operations.
                </div>
            </div>
        </div>

        </div>
    </div>
</div>

<!-- ========== MODULE: DEMO SCENARIOS ========== -->
<div class="module" id="mod-demo">
    <div class="uc-layout" style="max-width:680px;">
        <h2 style="margin-bottom:6px;">Demo Scenarios</h2>
        <p style="font-size:14px;color:var(--text-muted);margin-bottom:24px;">Click any scenario below to trigger the corresponding interaction flow.</p>

        <div class="card">
            <div class="card-head">Login flows</div>
            <div class="card-sub">Different login scenarios from Users.md.</div>
            <div style="display:flex;flex-direction:column;gap:8px;">
                <div class="toggle-btn" style="text-align:left;padding:14px 16px;cursor:pointer;" onclick="demoVerificationLogin()">
                    <strong>1. Verification code login (new user)</strong>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Email "new@test.com" ‚Üí OTP ‚Üí Auto-register ‚Üí Set password (optional)</div>
                </div>
                <div class="toggle-btn" style="text-align:left;padding:14px 16px;cursor:pointer;" onclick="demoVerificationLoginExisting()">
                    <strong>2. Verification code login (existing user)</strong>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Email "test@test.com" ‚Üí OTP ‚Üí Login success ‚Üí User Center</div>
                </div>
                <div class="toggle-btn" style="text-align:left;padding:14px 16px;cursor:pointer;" onclick="demoPasswordLogin()">
                    <strong>3. Password login (no 2FA)</strong>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Email ‚Üí Password ‚Üí Login success</div>
                </div>
                <div class="toggle-btn" style="text-align:left;padding:14px 16px;cursor:pointer;" onclick="demoPasswordLogin2FA()">
                    <strong style="color:var(--primary);">4. Password login + 2FA verification</strong>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Email ‚Üí Password ‚Üí Authenticator 2FA ‚Üí Login success. <em>Auto-enables 2FA for this demo.</em></div>
                </div>
                <div class="toggle-btn" style="text-align:left;padding:14px 16px;cursor:pointer;" onclick="demoMobileLogin()">
                    <strong>5. Mobile login (IP auto-detect)</strong>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Mobile tab ‚Üí Auto-detect country code ‚Üí OTP ‚Üí Login</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-head">MID-level operation verification (Users.md 7.7)</div>
            <div class="card-sub">Sensitive operations require verification. Code goes to User (authorized) or Owner (not authorized).</div>
            <div style="display:flex;flex-direction:column;gap:8px;">
                <div class="toggle-btn" style="text-align:left;padding:14px 16px;cursor:pointer;" onclick="demoMidOpAuthorized()">
                    <strong style="color:var(--success);">6. Sensitive operation ‚Äî User authorized (Self)</strong>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">User initiates a transaction ‚Üí Owner has authorized ‚Üí Verification code sent to User's own mobile</div>
                </div>
                <div class="toggle-btn" style="text-align:left;padding:14px 16px;cursor:pointer;" onclick="demoMidOpNotAuthorized()">
                    <strong style="color:var(--danger);">7. Sensitive operation ‚Äî Not authorized (Owner)</strong>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">User initiates a transaction ‚Üí Not authorized ‚Üí Verification code sent to Owner's mobile ‚Üí Owner must cooperate</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-head">Owner permission management</div>
            <div class="card-sub">Owner configures per-user operation permissions.</div>
            <div style="display:flex;flex-direction:column;gap:8px;">
                <div class="toggle-btn" style="text-align:left;padding:14px 16px;cursor:pointer;" onclick="demoOwnerConfig()">
                    <strong>8. Owner configures operation permissions</strong>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Go to User Center ‚Üí Permissions tab ‚Üí Toggle Self/Owner for each user and operation</div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-head">User Center interactions</div>
            <div class="card-sub">Profile and Security management flows.</div>
            <div style="display:flex;flex-direction:column;gap:8px;">
                <div class="toggle-btn" style="text-align:left;padding:14px 16px;cursor:pointer;" onclick="demoEditEmail()">
                    <strong>9. Change email (verify old ‚Üí verify new)</strong>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Profile ‚Üí Edit Email ‚Üí Verify old credential ‚Üí Enter new email ‚Üí Verify new</div>
                </div>
                <div class="toggle-btn" style="text-align:left;padding:14px 16px;cursor:pointer;" onclick="demoSetup2FA()">
                    <strong>10. Set up Authenticator App 2FA</strong>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Security ‚Üí Set up ‚Üí Scan QR ‚Üí Enter 6-digit code ‚Üí Enabled</div>
                </div>
                <div class="toggle-btn" style="text-align:left;padding:14px 16px;cursor:pointer;" onclick="demoRecovery()">
                    <strong>11. Generate recovery codes</strong>
                    <div style="font-size:12px;color:var(--text-muted);margin-top:2px;">Security ‚Üí Generate recovery codes ‚Üí Enter password ‚Üí View & save codes</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========== MODALS ========== -->

<!-- MID Operation Verification - Authorized (Self) -->
<div class="overlay" id="mMidOpSelf"><div class="modal"><button class="modal-x" onclick="closeM('mMidOpSelf')">√ó</button>
    <div class="center mb-16"><div style="width:52px;height:52px;margin:0 auto;background:var(--success-bg);border-radius:14px;display:flex;align-items:center;justify-content:center;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></div></div>
    <h3 class="center">Verify to continue</h3>
    <p class="mdesc center">You are <strong>authorized</strong> for this operation. A verification code has been sent to <strong>your mobile (+852 96412374)</strong>.</p>
    <div style="background:var(--bg);border-radius:var(--radius);padding:14px;margin-bottom:16px;">
        <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">Operation details</div>
        <div style="font-size:14px;font-weight:500;">Initiate Payin Transaction</div>
        <div style="font-size:13px;color:var(--text-secondary);">Amount: $5,000.00 USD ‚Üí MID-001</div>
    </div>
    <div class="form-group"><label class="form-label">Verification code</label><div class="input-row"><input class="form-input" placeholder="6-digit code" id="midSelfCode"><button class="btn btn-secondary btn-sm" onclick="toast('Code resent to your mobile','inf')">Resend</button></div></div>
    <button class="btn btn-primary" onclick="midSelfVerify()">Confirm operation</button>
</div></div>

<!-- MID Operation Verification - Not Authorized (Owner) -->
<div class="overlay" id="mMidOpOwner"><div class="modal"><button class="modal-x" onclick="closeM('mMidOpOwner')">√ó</button>
    <div class="center mb-16"><div style="width:52px;height:52px;margin:0 auto;background:var(--warning-bg);border-radius:14px;display:flex;align-items:center;justify-content:center;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#92400e" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></div></div>
    <h3 class="center">Owner verification required</h3>
    <p class="mdesc center">You are <strong>not authorized</strong> for this operation. A verification code has been sent to the <strong>Owner (Âº†‰∏â, +86 138xxxx1234)</strong>.</p>
    <div style="background:var(--bg);border-radius:var(--radius);padding:14px;margin-bottom:16px;">
        <div style="font-size:12px;color:var(--text-muted);margin-bottom:4px;">Operation details</div>
        <div style="font-size:14px;font-weight:500;">Initiate Payin Transaction</div>
        <div style="font-size:13px;color:var(--text-secondary);">Amount: $5,000.00 USD ‚Üí MID-001</div>
        <div style="font-size:13px;color:var(--text-secondary);">Requested by: ÊùéÂõõ (li@test.com)</div>
    </div>
    <div id="midOwnerWait">
        <div class="center" style="padding:20px 0;">
            <div style="font-size:14px;color:var(--text-secondary);margin-bottom:8px;">Waiting for Owner to enter verification code...</div>
            <div style="font-size:12px;color:var(--text-muted);">The Owner has been notified via SMS. This page will update automatically.</div>
            <div style="margin-top:16px;"><button class="btn btn-secondary btn-sm" onclick="toast('Notification resent to Owner','inf')">Resend to Owner</button></div>
        </div>
        <div style="border-top:1px solid var(--border-light);padding-top:14px;margin-top:8px;">
            <div style="font-size:12px;color:var(--text-muted);margin-bottom:8px;">Or, if the Owner is with you, they can enter the code here:</div>
            <div class="form-group"><div class="input-row"><input class="form-input" placeholder="Owner enters 6-digit code" id="midOwnerCode"><button class="btn btn-primary btn-sm" style="width:auto;" onclick="midOwnerVerify()">Verify</button></div></div>
        </div>
    </div>
    <div id="midOwnerTimeout" style="display:none;">
        <div class="center" style="padding:16px 0;color:var(--danger);">
            <div style="font-size:14px;font-weight:500;">Operation timed out</div>
            <div style="font-size:13px;color:var(--text-muted);margin-top:4px;">Owner did not verify within the time limit.</div>
        </div>
        <button class="btn btn-secondary" onclick="closeM('mMidOpOwner')">Close</button>
    </div>
</div></div>

<!-- Edit Email -->
<div class="overlay" id="mEditEmail"><div class="modal"><button class="modal-x" onclick="closeM('mEditEmail')">√ó</button>
    <h3>Change email</h3>
    <div id="ee1"><p class="mdesc">Verify your identity first.</p>
        <div class="form-group"><label class="form-label">Code sent to your mobile</label><div class="input-row"><input class="form-input" placeholder="6-digit code" id="eeOld"><button class="btn btn-secondary btn-sm" onclick="toast('Code sent to +852 96412374','inf')">Send</button></div></div>
        <button class="btn btn-primary" onclick="eeNext()">Verify & continue</button>
    </div>
    <div id="ee2" style="display:none"><p class="mdesc">Enter your new email address.</p>
        <div class="form-group"><label class="form-label">New email</label><input class="form-input" id="eeNew" placeholder="new@example.com"></div>
        <div class="form-group"><label class="form-label">Code sent to new email</label><div class="input-row"><input class="form-input" placeholder="6-digit code" id="eeNewCode"><button class="btn btn-secondary btn-sm" onclick="toast('Code sent','inf')">Send</button></div></div>
        <button class="btn btn-primary" onclick="eeSave()">Save</button>
    </div>
</div></div>

<!-- Edit Mobile -->
<div class="overlay" id="mEditMobile"><div class="modal"><button class="modal-x" onclick="closeM('mEditMobile')">√ó</button>
    <h3>Change mobile</h3>
    <div id="em1"><p class="mdesc">Verify your identity first.</p>
        <div class="form-group"><label class="form-label">Code sent to your email</label><div class="input-row"><input class="form-input" placeholder="6-digit code" id="emOld"><button class="btn btn-secondary btn-sm" onclick="toast('Code sent to email','inf')">Send</button></div></div>
        <button class="btn btn-primary" onclick="emNext()">Verify & continue</button>
    </div>
    <div id="em2" style="display:none"><p class="mdesc">Enter your new mobile number.</p>
        <div class="form-group"><label class="form-label">New mobile</label><div class="input-row"><select class="country-select" id="emCC"><option value="+852">üá≠üá∞ +852</option><option value="+86">üá®üá≥ +86</option><option value="+1">üá∫üá∏ +1</option></select><input class="form-input" id="emNum" placeholder="Phone number"></div></div>
        <div class="form-group"><label class="form-label">Code sent to new mobile</label><div class="input-row"><input class="form-input" placeholder="6-digit code" id="emNewCode"><button class="btn btn-secondary btn-sm" onclick="toast('Code sent','inf')">Send</button></div></div>
        <button class="btn btn-primary" onclick="emSave()">Save</button>
    </div>
</div></div>

<!-- Login Method -->
<div class="overlay" id="mLM"><div class="modal"><button class="modal-x" onclick="closeM('mLM')">√ó</button>
    <h3>Login method</h3><p class="mdesc">Choose the default input shown on the login page.</p>
    <div style="display:flex;flex-direction:column;gap:8px;">
        <div class="toggle-btn" id="lmE" onclick="pickLM('Email','lmE')" style="text-align:left;padding:14px 16px;"><strong>Email</strong><div style="font-size:12px;color:var(--text-muted);margin-top:2px;">liuxiaoxiaoangie@gmail.com</div></div>
        <div class="toggle-btn" id="lmM" onclick="pickLM('Mobile','lmM')" style="text-align:left;padding:14px 16px;"><strong>Mobile</strong><div style="font-size:12px;color:var(--text-muted);margin-top:2px;">+852 96412374</div></div>
    </div>
    <div class="mt-20"><button class="btn btn-primary" onclick="saveLM()">Save</button></div>
</div></div>

<!-- Nickname -->
<div class="overlay" id="mNick"><div class="modal"><button class="modal-x" onclick="closeM('mNick')">√ó</button>
    <h3>Change nickname</h3><p class="mdesc">2‚Äì30 characters. Letters, numbers, Chinese, underscores.</p>
    <div class="form-group"><label class="form-label">Nickname</label><input class="form-input" id="iNick" value="john"></div>
    <button class="btn btn-primary" onclick="saveNick()">Save</button>
</div></div>

<!-- Language -->
<div class="overlay" id="mLang"><div class="modal"><button class="modal-x" onclick="closeM('mLang')">√ó</button>
    <h3>Language</h3><p class="mdesc">Changes take effect immediately.</p>
    <div style="display:flex;flex-direction:column;gap:8px;">
        <div class="toggle-btn active" id="lgEn" onclick="pickLang('English','lgEn')">English</div>
        <div class="toggle-btn" id="lgCN" onclick="pickLang('ÁÆÄ‰Ωì‰∏≠Êñá','lgCN')">ÁÆÄ‰Ωì‰∏≠Êñá</div>
        <div class="toggle-btn" id="lgTW" onclick="pickLang('ÁπÅÈ´î‰∏≠Êñá','lgTW')">ÁπÅÈ´î‰∏≠Êñá</div>
    </div>
    <div class="mt-20"><button class="btn btn-primary" onclick="saveLang()">Save</button></div>
</div></div>

<!-- Change Password -->
<div class="overlay" id="mChgPW"><div class="modal"><button class="modal-x" onclick="closeM('mChgPW')">√ó</button>
    <h3>Change password</h3><p class="mdesc">Enter current password and choose a new one.</p>
    <div class="form-group"><label class="form-label">Current password</label><input class="form-input" type="password" id="cpOld" placeholder="Current password"></div>
    <div class="form-group"><label class="form-label">New password</label><input class="form-input" type="password" id="cpNew" placeholder="New password" oninput="pwCheckM(this.value)">
        <div class="pw-rules" id="pwRulesM">
            <div class="pw-rule" id="rm-len"><span class="dot">‚óã</span> At least 8 characters</div>
            <div class="pw-rule" id="rm-up"><span class="dot">‚óã</span> At least 1 uppercase letter</div>
            <div class="pw-rule" id="rm-lo"><span class="dot">‚óã</span> At least 1 lowercase letter</div>
            <div class="pw-rule" id="rm-num"><span class="dot">‚óã</span> At least 1 number or symbol</div>
        </div>
    </div>
    <div class="form-group"><label class="form-label">Confirm new password</label><input class="form-input" type="password" id="cpConf" placeholder="Re-enter new password"></div>
    <button class="btn btn-primary" onclick="saveChgPW()">Save</button>
</div></div>

<!-- Auth App -->
<div class="overlay" id="mAuthApp"><div class="modal"><button class="modal-x" onclick="closeM('mAuthApp')">√ó</button>
    <div id="aa1">
        <h3>Set up authenticator app</h3><p class="mdesc">Scan the QR code with your authenticator app (Google Authenticator, Authy, etc).</p>
        <div class="qr-box"><svg viewBox="0 0 24 24" fill="none" stroke-width="1.5"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="3" height="3"/><rect x="18" y="18" width="3" height="3"/></svg><span>QR Code</span></div>
        <p class="center" style="font-size:12px;color:var(--text-muted);margin-bottom:8px;">Or enter manually:</p>
        <div class="secret-box">JBSW Y3DP EHPK 3PXP <a class="link" onclick="toast('Copied!','inf')" style="margin-left:8px;font-size:12px;">Copy</a></div>
        <button class="btn btn-primary" onclick="aaStep2()">Next</button>
    </div>
    <div id="aa2" style="display:none;">
        <div class="center mb-16"><div style="width:52px;height:52px;margin:0 auto;background:var(--primary-light);border-radius:14px;display:flex;align-items:center;justify-content:center;"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2"><rect x="5" y="2" width="14" height="20" rx="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg></div></div>
        <h3 class="center">Verify your authenticator</h3><p class="mdesc center">Enter the 6-digit code from your app.</p>
        <div class="form-group"><input class="form-input" id="aaCode" placeholder="6-digit code" style="text-align:center;font-size:18px;letter-spacing:6px;"></div>
        <div class="flex-between"><a class="link" onclick="toast('Choose another method','inf')">Different method</a><button class="btn btn-primary" style="width:auto;" onclick="aaVerify()">Continue</button></div>
    </div>
</div></div>

<!-- SMS -->
<div class="overlay" id="mSMS"><div class="modal"><button class="modal-x" onclick="closeM('mSMS')">√ó</button>
    <h3>Set up SMS authentication</h3><p class="mdesc">We'll send a code to your registered mobile.</p>
    <div class="card" style="background:var(--bg);border:none;padding:14px;margin-bottom:16px;"><div class="flex-between"><div><div style="font-size:12px;color:var(--text-muted);">Registered mobile</div><div style="font-weight:500;">+852 96412374</div></div><span class="badge badge-success">Verified</span></div></div>
    <div class="form-group"><label class="form-label">Verification code</label><div class="input-row"><input class="form-input" id="smsCode" placeholder="6-digit code"><button class="btn btn-secondary btn-sm" onclick="toast('Code sent','inf')">Send</button></div></div>
    <button class="btn btn-primary" onclick="smsVerify()">Enable SMS 2FA</button>
</div></div>

<!-- Recovery -->
<div class="overlay" id="mRecovery"><div class="modal"><button class="modal-x" onclick="closeM('mRecovery')">√ó</button>
    <div id="rc1"><h3>Generate recovery codes</h3><p class="mdesc">Verify your identity first.</p>
        <div class="form-group"><label class="form-label">Password</label><input class="form-input" type="password" id="rcPW" placeholder="Your password"></div>
        <button class="btn btn-primary" onclick="rcGen()">Generate</button>
    </div>
    <div id="rc2" style="display:none;"><h3>Recovery codes</h3><p class="mdesc">Save these codes securely. Each can only be used once.</p>
        <div class="rc-grid"><div class="rc-item">a1b2-c3d4</div><div class="rc-item">e5f6-g7h8</div><div class="rc-item">i9j0-k1l2</div><div class="rc-item">m3n4-o5p6</div><div class="rc-item">q7r8-s9t0</div><div class="rc-item">u1v2-w3x4</div><div class="rc-item">y5z6-a7b8</div><div class="rc-item">c9d0-e1f2</div><div class="rc-item">g3h4-i5j6</div><div class="rc-item">k7l8-m9n0</div></div>
        <div style="display:flex;gap:8px;"><button class="btn btn-secondary" style="flex:1;" onclick="toast('Copied!','ok')">Copy all</button><button class="btn btn-secondary" style="flex:1;" onclick="toast('Downloading...','inf')">Download</button></div>
        <div class="mt-12"><button class="btn btn-primary" onclick="closeM('mRecovery')">Done</button></div>
    </div>
</div></div>


<script>
let vMode='code', lTab='email', curLM='Email', curLang='English', authOn=false, smsOn=false;

// === Nav ===
function goModule(m,el){
    document.querySelectorAll('.module').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.header-nav-item').forEach(x=>x.classList.remove('active'));
    document.getElementById('mod-'+m).classList.add('active');
    el.classList.add('active');
}
function toggleAccDD(){ document.getElementById('accDD').classList.toggle('show'); }
function pickAccount(n,r){
    document.getElementById('hAccountName').textContent=n;
    document.getElementById('accDD').classList.remove('show');
    toast('Switched to '+n+' ('+r+')','ok');
}
document.addEventListener('click',e=>{
    if(!e.target.closest('.header-account')) document.getElementById('accDD').classList.remove('show');
    if(!e.target.closest('.dotmenu')) document.querySelectorAll('.dotmenu-dd').forEach(d=>d.classList.remove('show'));
});

// === Toast ===
function toast(msg,t){const el=document.getElementById('toast');el.textContent=msg;el.className='toast '+t+' show';setTimeout(()=>el.classList.remove('show'),2500);}

// === Login ===
function loginTab(t,el){
    lTab=t;
    document.querySelectorAll('#s1 .tab').forEach(x=>x.classList.remove('active'));
    el.classList.add('active');
    document.getElementById('f-email').style.display=t==='email'?'block':'none';
    document.getElementById('f-mobile').style.display=t==='mobile'?'block':'none';
    if(t==='mobile'){const d=document.getElementById('ipCountry');d.innerHTML='<em>Detecting...</em>';setTimeout(()=>{d.textContent='Hong Kong (+852)';document.getElementById('iCC').value='+852';},600);}
}
function verifyMode(m,el){vMode=m;document.querySelectorAll('.toggle-btn').forEach(x=>x.classList.remove('active'));el.classList.add('active');}
function goLS(id){document.querySelectorAll('.ls').forEach(x=>x.classList.remove('on'));document.getElementById(id).classList.add('on');}

function doStep1(){
    let cred='';
    if(lTab==='email'){cred=document.getElementById('iEmail').value;if(!cred||!cred.includes('@')){toast('Enter a valid email','err');return;}}
    else{cred=document.getElementById('iCC').value+' '+document.getElementById('iMobile').value;if(!document.getElementById('iMobile').value){toast('Enter phone number','err');return;}}
    if(vMode==='code'){document.getElementById('otpTarget').textContent=cred;goLS('s2code');startTimer();toast('Code sent to '+cred,'inf');}
    else{document.getElementById('pwTarget').textContent=cred;goLS('s2pw');}
}

function otpNext(el,i){if(el.value.length===1){const a=document.querySelectorAll('#otpRow .otp-box');if(i<5)a[i+1].focus();}}
function otpNext2(el,i){if(el.value.length===1){const a=document.querySelectorAll('#tfaRow .otp-box');if(i<5)a[i+1].focus();}}

let tmr;
function startTimer(){let s=60;const a=document.getElementById('resendA'),t=document.getElementById('resendT');a.classList.add('off');a.innerHTML='Resend (<span id="resendT">60</span>s)';clearInterval(tmr);tmr=setInterval(()=>{s--;const el=document.getElementById('resendT');if(el)el.textContent=s;if(s<=0){clearInterval(tmr);a.classList.remove('off');a.textContent='Resend';}},1000);}
function resend(){toast('Code resent','inf');startTimer();}

function doVerifyOTP(){
    const a=document.querySelectorAll('#otpRow .otp-box');let c='';a.forEach(x=>c+=x.value);
    if(c.length<6){toast('Enter the 6-digit code','err');return;}
    const e=document.getElementById('iEmail').value;
    if(e.toLowerCase().startsWith('new')){toast('Account created!','ok');goLS('s3welcome');}
    else{toast('Login successful','ok');loginDone();}
}
function doPWLogin(){
    if(!document.getElementById('iPW').value){toast('Enter password','err');return;}
    if(authOn||smsOn){goLS('s2fa');}else{toast('Login successful','ok');loginDone();}
}
function do2FA(){const a=document.querySelectorAll('#tfaRow .otp-box');let c='';a.forEach(x=>c+=x.value);if(c.length<6){toast('Enter 6-digit code','err');return;}toast('2FA verified','ok');loginDone();}
function doRecoveryInput(){const c=prompt('Enter recovery code:');if(c){toast('Recovery code accepted','ok');loginDone();}}
function doForgot(){toast('Use verification code to sign in','inf');goLS('s1');vMode='code';document.querySelectorAll('.toggle-btn').forEach(x=>x.classList.remove('active'));document.querySelectorAll('.toggle-btn')[0].classList.add('active');}

function pwCheck(v){ruleChk('r-len',v.length>=8);ruleChk('r-up',/[A-Z]/.test(v));ruleChk('r-lo',/[a-z]/.test(v));ruleChk('r-num',/[0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(v));}
function pwCheckM(v){ruleChk('rm-len',v.length>=8);ruleChk('rm-up',/[A-Z]/.test(v));ruleChk('rm-lo',/[a-z]/.test(v));ruleChk('rm-num',/[0-9!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(v));}
function ruleChk(id,ok){const el=document.getElementById(id);if(ok){el.classList.add('pass');el.querySelector('.dot').textContent='‚úì';}else{el.classList.remove('pass');el.querySelector('.dot').textContent='‚óã';}}

function doSkipPW(){toast('You can set a password later','inf');loginDone();}
function doSetPW(){const p=document.getElementById('iNewPW').value,c=document.getElementById('iConfPW').value;if(p.length<8){toast('Min 8 characters','err');return;}if(p!==c){toast('Passwords don\'t match','err');return;}toast('Password set!','ok');loginDone();}

function loginDone(){
    document.getElementById('hAvatar').style.display='flex';
    document.getElementById('hAccount').style.display='flex';
    document.querySelectorAll('.ls').forEach(x=>x.classList.remove('on'));
    setTimeout(()=>{
        document.querySelectorAll('.module').forEach(x=>x.classList.remove('active'));
        document.getElementById('mod-uc').classList.add('active');
        document.querySelectorAll('.header-nav-item').forEach(x=>x.classList.remove('active'));
        document.querySelectorAll('.header-nav-item')[1].classList.add('active');
    },200);
}

// === User Center ===
function ucTab(t,el){
    document.querySelectorAll('.uc-tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.uc-panel').forEach(x=>x.classList.remove('on'));
    el.classList.add('active');
    document.getElementById('p-'+t).classList.add('on');
}

// === Modals ===
function openM(id){document.getElementById(id).classList.add('show');}
function closeM(id){document.getElementById(id).classList.remove('show');}
document.querySelectorAll('.overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('show');}));

// Edit Email
function eeNext(){if(!document.getElementById('eeOld').value){toast('Enter code','err');return;}toast('Verified','ok');document.getElementById('ee1').style.display='none';document.getElementById('ee2').style.display='block';}
function eeSave(){const e=document.getElementById('eeNew').value;if(!e||!e.includes('@')){toast('Enter valid email','err');return;}if(!document.getElementById('eeNewCode').value){toast('Enter code','err');return;}document.getElementById('dEmail').textContent=e;toast('Email updated','ok');closeM('mEditEmail');document.getElementById('ee1').style.display='block';document.getElementById('ee2').style.display='none';}

// Edit Mobile
function emNext(){if(!document.getElementById('emOld').value){toast('Enter code','err');return;}toast('Verified','ok');document.getElementById('em1').style.display='none';document.getElementById('em2').style.display='block';}
function emSave(){const n=document.getElementById('emNum').value;if(!n){toast('Enter number','err');return;}if(!document.getElementById('emNewCode').value){toast('Enter code','err');return;}document.getElementById('dMobile').textContent=document.getElementById('emCC').value+' '+n;toast('Mobile updated','ok');closeM('mEditMobile');document.getElementById('em1').style.display='block';document.getElementById('em2').style.display='none';}

// Login Method
function pickLM(m,id){curLM=m;document.querySelectorAll('#mLM .toggle-btn').forEach(x=>x.classList.remove('active'));document.getElementById(id).classList.add('active');}
function saveLM(){document.getElementById('dLM').textContent=curLM;toast('Login method: '+curLM,'ok');closeM('mLM');}

// Nickname
function saveNick(){const n=document.getElementById('iNick').value;if(n.length<2||n.length>30){toast('2-30 characters','err');return;}document.getElementById('dNick').textContent=n;document.getElementById('hAvatar').textContent=n.charAt(0).toUpperCase();toast('Nickname updated','ok');closeM('mNick');}

// Language
function pickLang(l,id){curLang=l;document.querySelectorAll('#mLang .toggle-btn').forEach(x=>x.classList.remove('active'));document.getElementById(id).classList.add('active');}
function saveLang(){document.getElementById('dLang').textContent=curLang;toast('Language: '+curLang,'ok');closeM('mLang');}

// Change PW
function saveChgPW(){const o=document.getElementById('cpOld').value,n=document.getElementById('cpNew').value,c=document.getElementById('cpConf').value;if(!o){toast('Enter current password','err');return;}if(n.length<8){toast('Min 8 characters','err');return;}if(n!==c){toast('Passwords don\'t match','err');return;}if(n===o){toast('Must differ from current','err');return;}toast('Password changed','ok');closeM('mChgPW');}

// Auth App
function aaStep2(){document.getElementById('aa1').style.display='none';document.getElementById('aa2').style.display='block';}
function aaVerify(){const c=document.getElementById('aaCode').value;if(!c||c.length<6){toast('Enter 6-digit code','err');return;}authOn=true;document.getElementById('bAuthApp').style.display='inline-flex';document.getElementById('aAuthApp').innerHTML='<div class="dotmenu"><button class="dotmenu-btn" onclick="toggleDM(this)">¬∑¬∑¬∑</button><div class="dotmenu-dd"><div class="dotmenu-item" onclick="toast(\'Set as default\',\'inf\')">Set as Default</div><div class="dotmenu-item" onclick="toast(\'Regenerating\',\'inf\')">Regenerate</div><div class="dotmenu-item red" onclick="disableAuth()">Disable</div></div></div>';toast('Authenticator enabled','ok');closeM('mAuthApp');document.getElementById('aa1').style.display='block';document.getElementById('aa2').style.display='none';}
function disableAuth(){authOn=false;document.getElementById('bAuthApp').style.display='none';document.getElementById('aAuthApp').innerHTML='<button class="btn btn-secondary btn-sm" onclick="openM(\'mAuthApp\')">Set up</button>';toast('Authenticator disabled','inf');}

// SMS
function smsVerify(){const c=document.getElementById('smsCode').value;if(!c||c.length<6){toast('Enter code','err');return;}smsOn=true;document.getElementById('bSMS').style.display='inline-flex';document.getElementById('aSMS').innerHTML='<div class="dotmenu"><button class="dotmenu-btn" onclick="toggleDM(this)">¬∑¬∑¬∑</button><div class="dotmenu-dd"><div class="dotmenu-item" onclick="toast(\'Set as default\',\'inf\')">Set as Default</div><div class="dotmenu-item red" onclick="disableSMS()">Disable</div></div></div>';toast('SMS 2FA enabled','ok');closeM('mSMS');}
function disableSMS(){smsOn=false;document.getElementById('bSMS').style.display='none';document.getElementById('aSMS').innerHTML='<button class="btn btn-secondary btn-sm" onclick="openM(\'mSMS\')">Set up</button>';toast('SMS disabled','inf');}

// Recovery
function rcGen(){if(!document.getElementById('rcPW').value){toast('Enter password','err');return;}document.getElementById('rc1').style.display='none';document.getElementById('rc2').style.display='block';toast('Codes generated','ok');}

// Dot menu
function toggleDM(btn){const dd=btn.nextElementSibling;document.querySelectorAll('.dotmenu-dd').forEach(d=>{if(d!==dd)d.classList.remove('show');});dd.classList.toggle('show');}

// === Permission toggle (Users.md 7.7) ===
function togglePerm(el){
    if(el.textContent==='Self'){
        el.textContent='Owner';el.className='badge badge-danger';el.style.cursor='pointer';
        toast('Changed to Owner verification','inf');
    } else {
        el.textContent='Self';el.className='badge badge-success';el.style.cursor='pointer';
        toast('Changed to Self verification','ok');
    }
}

// === MID Operation Verification ===
function midSelfVerify(){
    const c=document.getElementById('midSelfCode').value;
    if(!c||c.length<6){toast('Enter 6-digit code','err');return;}
    toast('Operation confirmed successfully!','ok');
    closeM('mMidOpSelf');
    document.getElementById('midSelfCode').value='';
}
function midOwnerVerify(){
    const c=document.getElementById('midOwnerCode').value;
    if(!c||c.length<6){toast('Enter 6-digit code','err');return;}
    toast('Owner verified! Operation confirmed.','ok');
    closeM('mMidOpOwner');
    document.getElementById('midOwnerCode').value='';
}

// === Demo Scenario Functions ===
function activateUC(){
    document.getElementById('hAvatar').style.display='flex';
    document.getElementById('hAccount').style.display='flex';
}
function switchToModule(mod){
    document.querySelectorAll('.module').forEach(x=>x.classList.remove('active'));
    document.getElementById('mod-'+mod).classList.add('active');
    document.querySelectorAll('.header-nav-item').forEach(x=>x.classList.remove('active'));
    const btns=document.querySelectorAll('.header-nav-item');
    if(mod==='login') btns[0].classList.add('active');
    else if(mod==='uc') btns[1].classList.add('active');
    else if(mod==='demo') btns[2].classList.add('active');
}

// 1. Verification code login (new user)
function demoVerificationLogin(){
    switchToModule('login');
    document.getElementById('iEmail').value='new@test.com';
    vMode='code';
    lTab='email';
    document.getElementById('f-email').style.display='block';
    document.getElementById('f-mobile').style.display='none';
    goLS('s1');
    toast('Scenario 1: Enter any email starting with "new" ‚Üí Continue ‚Üí Enter 6 digits','inf');
}

// 2. Verification code login (existing user)
function demoVerificationLoginExisting(){
    switchToModule('login');
    document.getElementById('iEmail').value='test@test.com';
    vMode='code';
    lTab='email';
    document.getElementById('f-email').style.display='block';
    document.getElementById('f-mobile').style.display='none';
    goLS('s1');
    toast('Scenario 2: Click Continue ‚Üí Enter 6 digits ‚Üí Login success','inf');
}

// 3. Password login (no 2FA)
function demoPasswordLogin(){
    authOn=false; smsOn=false;
    switchToModule('login');
    document.getElementById('iEmail').value='test@test.com';
    vMode='pw';
    lTab='email';
    document.getElementById('f-email').style.display='block';
    document.getElementById('f-mobile').style.display='none';
    goLS('s1');
    // auto-select password toggle
    document.querySelectorAll('#s1 .toggle-btn').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('#s1 .toggle-btn')[1].classList.add('active');
    toast('Scenario 3: Click Continue ‚Üí Enter any password ‚Üí Login success','inf');
}

// 4. Password login + 2FA
function demoPasswordLogin2FA(){
    authOn=true; smsOn=false;
    document.getElementById('bAuthApp').style.display='inline-flex';
    switchToModule('login');
    document.getElementById('iEmail').value='test@test.com';
    vMode='pw';
    lTab='email';
    document.getElementById('f-email').style.display='block';
    document.getElementById('f-mobile').style.display='none';
    goLS('s1');
    document.querySelectorAll('#s1 .toggle-btn').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('#s1 .toggle-btn')[1].classList.add('active');
    toast('Scenario 4: 2FA enabled! Continue ‚Üí Password ‚Üí 2FA code ‚Üí Login','inf');
}

// 5. Mobile login
function demoMobileLogin(){
    switchToModule('login');
    vMode='code';
    lTab='mobile';
    document.getElementById('f-email').style.display='none';
    document.getElementById('f-mobile').style.display='block';
    document.querySelectorAll('#s1 .tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('#s1 .tab')[1].classList.add('active');
    document.querySelectorAll('#s1 .toggle-btn').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('#s1 .toggle-btn')[0].classList.add('active');
    goLS('s1');
    // trigger IP detection
    const d=document.getElementById('ipCountry');
    d.innerHTML='<em>Detecting...</em>';
    setTimeout(()=>{d.textContent='Hong Kong (+852)';document.getElementById('iCC').value='+852';},800);
    toast('Scenario 5: Country auto-detected ‚Üí Enter phone ‚Üí Continue','inf');
}

// 6. MID operation - authorized (Self)
function demoMidOpAuthorized(){
    activateUC();
    document.getElementById('midSelfCode').value='';
    openM('mMidOpSelf');
    toast('Scenario 6: You are authorized ‚Üí Code sent to YOUR mobile','ok');
}

// 7. MID operation - not authorized (Owner)
function demoMidOpNotAuthorized(){
    activateUC();
    document.getElementById('midOwnerCode').value='';
    document.getElementById('midOwnerWait').style.display='block';
    document.getElementById('midOwnerTimeout').style.display='none';
    openM('mMidOpOwner');
    toast('Scenario 7: Not authorized ‚Üí Code sent to OWNER\'s mobile','err');
}

// 8. Owner config permissions
function demoOwnerConfig(){
    activateUC();
    switchToModule('uc');
    document.querySelectorAll('.header-nav-item').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.header-nav-item')[1].classList.add('active');
    // switch to permissions tab
    document.querySelectorAll('.uc-tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.uc-panel').forEach(x=>x.classList.remove('on'));
    document.querySelectorAll('.uc-tab')[3].classList.add('active');
    document.getElementById('p-permissions').classList.add('on');
    toast('Scenario 8: Click Self/Owner badges to toggle permissions','inf');
}

// 9. Edit email
function demoEditEmail(){
    activateUC();
    switchToModule('uc');
    document.querySelectorAll('.header-nav-item').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.header-nav-item')[1].classList.add('active');
    document.querySelectorAll('.uc-tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.uc-panel').forEach(x=>x.classList.remove('on'));
    document.querySelectorAll('.uc-tab')[0].classList.add('active');
    document.getElementById('p-profile').classList.add('on');
    setTimeout(()=>openM('mEditEmail'),300);
    toast('Scenario 9: Verify old credential ‚Üí Enter new email ‚Üí Verify','inf');
}

// 10. Setup 2FA
function demoSetup2FA(){
    activateUC();
    switchToModule('uc');
    document.querySelectorAll('.header-nav-item').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.header-nav-item')[1].classList.add('active');
    document.querySelectorAll('.uc-tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.uc-panel').forEach(x=>x.classList.remove('on'));
    document.querySelectorAll('.uc-tab')[1].classList.add('active');
    document.getElementById('p-security').classList.add('on');
    setTimeout(()=>{
        document.getElementById('aa1').style.display='block';
        document.getElementById('aa2').style.display='none';
        openM('mAuthApp');
    },300);
    toast('Scenario 10: Scan QR ‚Üí Next ‚Üí Enter 6-digit code ‚Üí Enabled','inf');
}

// 11. Recovery codes
function demoRecovery(){
    activateUC();
    switchToModule('uc');
    document.querySelectorAll('.header-nav-item').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.header-nav-item')[1].classList.add('active');
    document.querySelectorAll('.uc-tab').forEach(x=>x.classList.remove('active'));
    document.querySelectorAll('.uc-panel').forEach(x=>x.classList.remove('on'));
    document.querySelectorAll('.uc-tab')[1].classList.add('active');
    document.getElementById('p-security').classList.add('on');
    setTimeout(()=>{
        document.getElementById('rc1').style.display='block';
        document.getElementById('rc2').style.display='none';
        document.getElementById('rcPW').value='';
        openM('mRecovery');
    },300);
    toast('Scenario 11: Enter password ‚Üí Generate ‚Üí Save codes','inf');
}
</script>
</body>
</html>
