# 账户中心与司库中心业务逻辑说明

## 📋 核心判断规则

### **简化规则**
```
if (在SP有资金账户) {
    显示司库中心
} else {
    显示账户中心  // 只有佣金账户
}
```

---

## 🎯 业务场景分类

### **场景1：纯TP角色（代理推客模式）**

**业务模式：**
- TP只是代理SP的能力
- 将客户推荐给SP，由SP直接服务
- TP赚取推荐佣金

**资金账户：**
- ❌ 无资金账户
- ✅ 只有佣金账户

**显示中心：**
- ✅ **账户中心**（佣金账户管理）
- ❌ 司库中心

---

### **场景2：TP+SP角色（持牌机构，VA入金模式）**

**业务模式：**
- 持牌机构通过SP的VA接受客资
- VA只是入金方式，资金进入持牌机构在SP的资金账户
- 持牌机构用自己牌照直接服务客户

**资金账户：**
- ✅ 在SP有资金账户（通过VA入金）
- ✅ 需要管理资金、做资金运营

**显示中心：**
- ❌ 账户中心
- ✅ **司库中心**（资金账户管理）

---

### **场景3：TP+SP角色（持牌机构，直接开户模式）**

**业务模式：**
- 持牌机构在多个银行（作为SP）开设自己的账户
- 客户资金到持牌机构账户
- 可以在多个账户间调拨资金

**资金账户：**
- ✅ 在多个SP/银行有资金账户
- ✅ 需要资金运营、汇率运营

**显示中心：**
- ❌ 账户中心
- ✅ **司库中心**（资金账户管理）

---

### **场景4：纯SP角色**

**业务模式：**
- 提供渠道给TP
- 管理在下游渠道的资金账户
- 给TP分佣结算

**资金账户：**
- ✅ 在多个下游渠道有资金账户
- ✅ 需要资金运营

**显示中心：**
- ❌ 账户中心
- ✅ **司库中心**（资金账户管理）

---

### **场景5：复杂混合模式**

**业务模式：**
- 收款侧：SP1给持牌机构开VA，持牌机构有资金账户
- 付款侧：SP2不允许直接付款，需要推送商户入网

**资金账户：**
- ✅ 在SP1有资金账户（VA入金）
- ❌ 在SP2无资金账户（推客模式）

**显示中心：**
- ❌ 账户中心
- ✅ **司库中心**（因为有资金账户需要管理）

---

## 📊 两个中心的功能对比

### **账户中心（Account Center）- 佣金账户管理**

**适用角色：** 纯TP（代理推客）

**核心功能：**
```
├── 佣金账户
│   ├── 佣金余额查询
│   ├── 可提现金额
│   └── 冻结资金
├── 交易数据
│   ├── 推荐客户列表
│   ├── 客户交易统计
│   └── 佣金明细
├── 资金操作
│   ├── 充值
│   ├── 提现
│   └── 充值提现记录
└── 分佣收益
    ├── 分佣账单
    └── 收益统计
```

**特点：**
- 只管理佣金收入
- 不涉及客户资金
- 功能相对简单

---

### **司库中心（Treasury Center）- 资金账户管理**

**适用角色：** 有资金账户的TP/SP

**核心功能：**
```
├── 资金账户
│   ├── 账户总览（多个SP/渠道的资金账户）
│   ├── 多渠道账户
│   ├── 资金流水
│   └── 可用余额/冻结余额
├── 资金调拨
│   ├── 跨账户调拨
│   ├── 调拨记录
│   └── 调拨审核
├── 清结算
│   ├── 清算管理
│   ├── 结算管理
│   └── 对账管理
├── 资金运营
│   ├── 头寸管理
│   ├── 流动性管理
│   └── 资金预测
├── 汇率运营
│   ├── 汇率监控
│   ├── 套利管理
│   └── 对冲管理
└── 分佣结算
    ├── TP分佣账单
    └── TP结算付款
```

**特点：**
- 管理客户资金
- 需要资金运营能力
- 功能复杂，企业级

---

## 🔄 销售中心合并逻辑

### **TP+SP角色时的销售中心**

**合并方案：** 显示一个销售中心，包含两个tab

```
销售中心
├── 机构代理管理（原TP销售中心）
│   ├── 代理商列表
│   ├── 新建代理商
│   ├── 代理商层级
│   └── 代理商授权
├── 销售代理管理（原SP销售中心）
│   ├── TP合作伙伴列表
│   ├── TP层级管理
│   └── TP合作协议
├── 分佣管理
│   ├── 分佣规则配置
│   ├── 分佣账单生成
│   └── 分佣明细
└── 结算管理
    ├── 结算单
    ├── 付款单
    └── 结算记录
```

---

## 🛒 采购中心逻辑

### **TP+SP角色时的采购中心**

**显示规则：** 显示采购中心，但只显示其他SP的产品

**原因：**
- 自己的产品不需要"采购"
- 但可能需要采购其他SP的产品来补充能力
- 用标签区分"自有产品"和"第三方产品"

---

## 📈 业务演进路径

### **从推客模式到直接服务模式**

```
阶段1：推客模式
├── 持牌机构有牌照
├── 但SP不接受nesting
├── 只能推荐客户给SP
└── 使用：账户中心（佣金管理）

        ↓ SP开始支持nesting

阶段2：VA入金模式
├── SP给持牌机构开VA
├── 持牌机构有资金账户
├── 可以直接服务客户
└── 使用：司库中心（资金管理）

        ↓ 业务扩大

阶段3：多账户模式
├── 在多个SP/银行开户
├── 需要跨账户调拨
├── 需要资金运营
└── 使用：司库中心（高级功能）
```

---

## 🎯 关键概念解释

### **VA（Virtual Account）虚拟账户**
- VA是入金方式，不是账户类型
- 通过VA入金后，资金进入实际的资金账户
- VA模式 = 有资金账户 = 使用司库中心

### **资金账户 vs 佣金账户**
- **资金账户**：客户的钱，需要管理和运营
- **佣金账户**：自己的佣金收入，相对简单

### **代理关系 vs 直接开户**
- **代理关系**：推荐客户，赚佣金，无资金账户
- **直接开户**：服务客户，有资金账户，需要运营

---

## ✅ 实施检查清单

### **Dashboard更新**
- [x] 账户中心：`data-role="tp"`（仅TP角色）
- [x] 司库中心：`data-role="sp"`（有资金账户的角色）
- [x] 销售中心：`data-role="both"`（合并后的销售中心）
- [x] 采购中心：TP+SP时只显示其他SP产品

### **菜单配置更新**
- [x] 账户中心菜单：专注佣金账户管理
- [x] 司库中心菜单：完整的资金管理功能
- [x] 销售中心菜单：包含机构代理和销售代理

### **功能清单更新**
- [x] TP账户中心：11个功能（佣金管理）
- [x] SP司库中心：19个功能（资金管理）
- [x] 销售中心：合并后的功能

---

## 📝 总结

**核心原则：**
> 有资金账户 = 司库中心  
> 无资金账户 = 账户中心

**判断依据：**
- 不看角色名称（TP/SP）
- 只看是否有需要管理的资金账户
- VA入金 = 有资金账户

**业务灵活性：**
- 支持从推客模式演进到直接服务模式
- 支持混合模式（部分代理，部分直接服务）
- 界面自动适配业务模式

---

*最后更新：2026-02-02*
*文档版本：v1.0*
