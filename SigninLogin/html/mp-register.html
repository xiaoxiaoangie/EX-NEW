<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>åˆ›å»ºè´¦æˆ·</title>
<style>
:root {
    --bg: #f8f9fa;
    --card: #ffffff;
    --text: #1a1a1a;
    --text2: #5f6368;
    --text3: #9aa0a6;
    --border: #dadce0;
    --border-light: #e8eaed;
    --accent: #1a73e8;
    --accent-hover: #1557b0;
    --accent-light: rgba(26,115,232,.08);
    --green: #34a853;
    --orange: #f9ab00;
    --red: #ea4335;
    --radius: 8px;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
    font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'Google Sans', 'PingFang SC', 'Helvetica Neue', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    -webkit-font-smoothing: antialiased;
}

/* ===== Top navigation bar ===== */
.topbar {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 64px;
    background: var(--card);
    border-bottom: 1px solid var(--border-light);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 40px;
    z-index: 100;
}
.topbar-logo {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    color: var(--text);
}
.topbar-logo .mark {
    width: 36px; height: 36px;
    background: var(--text);
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    color: #fff; font-size: 14px; font-weight: 800; letter-spacing: -.5px;
}
.topbar-logo .brand {
    font-size: 18px;
    font-weight: 700;
    letter-spacing: -.3px;
}
.topbar-right {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
    color: var(--text2);
}
.topbar-right a {
    color: var(--accent);
    text-decoration: none;
    font-weight: 600;
    padding: 8px 20px;
    border: 1.5px solid var(--accent);
    border-radius: var(--radius);
    transition: all .15s;
}
.topbar-right a:hover {
    background: var(--accent);
    color: #fff;
    box-shadow: 0 2px 6px rgba(26,115,232,.25);
}

/* ===== Main layout ===== */
.main {
    min-height: 100vh;
    padding-top: 64px;
    display: flex;
    align-items: center;
    justify-content: center;
}
.container {
    width: 100%;
    max-width: 520px;
    padding: 48px 24px 60px;
}

/* ===== Card ===== */
.card {
    background: var(--card);
    border: 1px solid var(--border-light);
    border-radius: 16px;
    padding: 40px 44px;
    box-shadow: 0 1px 2px rgba(0,0,0,.04), 0 4px 16px rgba(0,0,0,.04), 0 12px 32px rgba(0,0,0,.02);
}

/* ===== Typography ===== */
h1 {
    font-size: 26px;
    font-weight: 700;
    letter-spacing: -.4px;
    margin-bottom: 8px;
    color: var(--text);
}
.desc {
    font-size: 14px;
    color: var(--text2);
    line-height: 1.6;
    margin-bottom: 32px;
}
.desc b { color: var(--text); font-weight: 600; }

/* ===== Tabs (email / phone) ===== */
.tabs {
    display: flex;
    border-bottom: 2px solid var(--border-light);
    margin-bottom: 24px;
    gap: 0;
}
.tab {
    padding: 10px 20px;
    font-size: 14px;
    font-weight: 600;
    color: var(--text3);
    cursor: pointer;
    border: none;
    background: none;
    font-family: inherit;
    position: relative;
    transition: color .2s;
}
.tab:hover { color: var(--text2); }
.tab.on { color: var(--accent); }
.tab.on::after {
    content: '';
    position: absolute;
    bottom: -2px; left: 0; right: 0;
    height: 2px;
    background: var(--accent);
    border-radius: 1px 1px 0 0;
}

/* ===== Form fields ===== */
.field { margin-bottom: 20px; }
.field-label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: var(--text);
    margin-bottom: 6px;
}
.field-input {
    width: 100%;
    padding: 12px 14px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    font-size: 14px;
    color: var(--text);
    background: var(--card);
    outline: none;
    font-family: inherit;
    transition: border-color .15s, box-shadow .15s;
}
.field-input:hover { border-color: #bdc1c6; }
.field-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-light);
    background: #fff;
}
.field-input::placeholder { color: #bdc1c6; }

/* Phone composite */
.phone-row { display: flex; }
.phone-row select {
    width: 88px;
    padding: 12px 10px;
    border: 1px solid var(--border);
    border-radius: var(--radius) 0 0 var(--radius);
    border-right: none;
    font-size: 14px;
    color: var(--text);
    background: #f8f9fa;
    outline: none;
    font-family: inherit;
    appearance: none;
    cursor: pointer;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%239aa0a6' d='M5 6L0 0h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 10px center;
    font-weight: 500;
}
.phone-row .field-input { border-radius: 0 var(--radius) var(--radius) 0; }

/* ===== OTP 6-digit ===== */
.otp-row { display: flex; gap: 10px; justify-content: center; margin: 12px 0 20px; }
.otp-row input {
    width: 52px; height: 56px;
    text-align: center;
    font-size: 22px;
    font-weight: 700;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    outline: none;
    color: var(--text);
    font-family: inherit;
    transition: border-color .15s, box-shadow .15s;
    font-variant-numeric: tabular-nums;
    background: var(--card);
}
.otp-row input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-light);
}

/* ===== Resend ===== */
.resend-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 28px;
}
.resend-row span { font-size: 13px; color: var(--text3); }
.resend-row button {
    font-size: 13px;
    color: var(--accent);
    background: none;
    border: none;
    cursor: pointer;
    font-family: inherit;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 6px;
    transition: background .15s;
}
.resend-row button:hover { background: var(--accent-light); }
.resend-row button:disabled { color: var(--text3); cursor: default; background: none; }

/* ===== Password rules checklist ===== */
.pwd-rules { margin-top: 10px; display: flex; flex-direction: column; gap: 4px; }
.pwd-rule {
    display: flex; align-items: center; gap: 6px;
    font-size: 12px; color: var(--text3); font-weight: 500;
    transition: color .2s;
}
.pwd-rule .rule-icon {
    width: 16px; height: 16px; border-radius: 50%;
    border: 1.5px solid var(--border); display: flex;
    align-items: center; justify-content: center;
    font-size: 10px; transition: all .2s; flex-shrink: 0;
}
.pwd-rule.pass { color: var(--green); }
.pwd-rule.pass .rule-icon {
    border-color: var(--green); background: var(--green); color: #fff;
}

/* ===== Method card selector ===== */
.methods { margin-bottom: 24px; display: flex; flex-direction: column; gap: 10px; }
.mth {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 18px;
    cursor: pointer;
    border-radius: 10px;
    transition: all .2s cubic-bezier(.4,0,.2,1);
    border: 1.5px solid var(--border-light);
    background: var(--card);
    position: relative;
}
.mth:hover {
    border-color: #c4c9cf;
    box-shadow: 0 2px 8px rgba(0,0,0,.04);
}
.mth.on {
    border-color: var(--accent);
    background: linear-gradient(135deg, rgba(26,115,232,.04), rgba(26,115,232,.08));
    box-shadow: 0 0 0 3px rgba(26,115,232,.1), 0 2px 8px rgba(26,115,232,.06);
}
.mth .mth-icon {
    width: 40px; height: 40px;
    border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    background: #f1f3f4;
    transition: all .2s;
}
.mth .mth-icon svg { width: 20px; height: 20px; stroke: var(--text2); stroke-width: 1.8; fill: none; transition: stroke .2s; }
.mth.on .mth-icon {
    background: var(--accent);
}
.mth.on .mth-icon svg { stroke: #fff; }
.mth .mth-check {
    width: 20px; height: 20px;
    border-radius: 50%;
    border: 2px solid var(--border);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    transition: all .2s;
    margin-left: auto;
}
.mth.on .mth-check {
    border-color: var(--accent);
    background: var(--accent);
}
.mth.on .mth-check::after {
    content: '';
    width: 5px; height: 9px;
    border: solid #fff;
    border-width: 0 2px 2px 0;
    transform: rotate(45deg) translateY(-1px);
}
.mth .mth-body { flex: 1; min-width: 0; }
.mth .mth-title { font-size: 14px; font-weight: 600; color: var(--text); line-height: 1.3; }
.mth .mth-desc { font-size: 12px; color: var(--text3); margin-top: 3px; line-height: 1.4; }

/* ===== Agreement ===== */
.agree {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 28px;
}
.agree input[type=checkbox] {
    margin-top: 2px;
    accent-color: var(--accent);
    width: 18px; height: 18px;
    flex-shrink: 0;
    cursor: pointer;
    border-radius: 4px;
}
.agree label {
    font-size: 13px;
    color: var(--text2);
    line-height: 1.6;
}
.agree label a {
    color: var(--accent);
    text-decoration: none;
    font-weight: 500;
}
.agree label a:hover { text-decoration: underline; }

/* ===== Buttons ===== */
.btn {
    width: 100%;
    padding: 13px 24px;
    border-radius: 10px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    border: none;
    font-family: inherit;
    transition: all .2s cubic-bezier(.4,0,.2,1);
}
.btn-primary {
    background: var(--accent);
    color: #fff;
    box-shadow: 0 1px 2px rgba(26,115,232,.2);
}
.btn-primary:hover { background: var(--accent-hover); box-shadow: 0 2px 8px rgba(26,115,232,.35); transform: translateY(-0.5px); }
.btn-primary:active { transform: translateY(0) scale(.995); box-shadow: 0 1px 2px rgba(26,115,232,.2); }
.btn-text {
    background: none;
    color: var(--accent);
    margin-top: 8px;
}
.btn-text:hover { background: var(--accent-light); }

/* ===== Action row (two buttons side by side) ===== */
.action-row {
    display: flex;
    gap: 12px;
    margin-top: 4px;
}
.action-row .btn { flex: 1; }
.btn-outline {
    background: var(--card);
    color: var(--text);
    border: 1px solid var(--border);
}
.btn-outline:hover { background: #f1f3f4; }

/* ===== QR code area ===== */
.qr-area {
    text-align: center;
    margin-bottom: 24px;
}
.qr-box {
    width: 200px; height: 200px;
    margin: 0 auto 16px;
    border-radius: 12px;
    background: #f1f3f4;
    border: 1px solid var(--border-light);
    display: flex; align-items: center; justify-content: center;
    flex-direction: column; gap: 8px;
    color: var(--text3); font-size: 13px;
}
.qr-box .qr-icon { font-size: 48px; opacity: .3; }
.secret-row {
    font-size: 13px;
    color: var(--text2);
    line-height: 1.6;
}
.secret-row code {
    display: inline-block;
    background: #f1f3f4;
    padding: 5px 14px;
    border-radius: 6px;
    font-family: 'SF Mono', 'Roboto Mono', Menlo, monospace;
    font-size: 14px;
    color: var(--text);
    letter-spacing: 2px;
    font-weight: 600;
    margin-top: 4px;
    border: 1px solid var(--border-light);
}

/* ===== Email verification banner ===== */
.verify-banner {
    background: #e8f0fe;
    border: 1px solid #aecbfa;
    border-radius: var(--radius);
    padding: 28px 24px;
    text-align: center;
    margin-bottom: 24px;
}
.verify-banner .vb-icon { font-size: 40px; margin-bottom: 12px; }
.verify-banner p { font-size: 14px; color: var(--text); line-height: 1.6; }
.verify-banner .vb-addr { font-weight: 700; color: var(--accent); }

/* ===== Success ===== */
.success-icon {
    width: 64px; height: 64px;
    margin: 0 auto 20px;
    border-radius: 50%;
    background: var(--green);
    display: flex; align-items: center; justify-content: center;
    color: #fff; font-size: 28px; font-weight: 700;
    animation: popIn .4s cubic-bezier(.175,.885,.32,1.275);
}
@keyframes popIn {
    0% { transform: scale(0); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}
.success-body { text-align: center; }
.success-body h2 { font-size: 22px; font-weight: 700; margin-bottom: 8px; }
.success-body p { font-size: 14px; color: var(--text2); line-height: 1.5; }
.success-body .countdown { font-size: 13px; color: var(--text3); margin-top: 24px; }
.success-body .countdown b { color: var(--accent); font-weight: 700; }

/* ===== Views ===== */
.v { display: none; animation: fadeUp .25s ease; }
.v.on { display: block; }
@keyframes fadeUp {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ===== Footer ===== */
.page-footer {
    text-align: center;
    padding: 24px;
    padding-bottom: 120px;
    font-size: 12px;
    color: var(--text3);
}
.page-footer a { color: var(--text3); text-decoration: none; margin: 0 12px; }
.page-footer a:hover { color: var(--text2); }

/* ===== Error message ===== */
.err-msg {
    display: none;
    align-items: center;
    gap: 8px;
    padding: 10px 14px;
    background: rgba(234,67,53,.08);
    border: 1px solid rgba(234,67,53,.2);
    border-radius: var(--radius);
    margin-bottom: 20px;
    font-size: 13px;
    color: var(--red);
    line-height: 1.5;
}
.err-msg.show { display: flex; }
.err-msg .err-icon { font-size: 16px; flex-shrink: 0; }

/* ===== Demo bar ===== */
.demo-bar {
    position: fixed;
    bottom: 0; left: 0; right: 0;
    background: var(--card);
    border-top: 1px solid var(--border-light);
    padding: 10px 32px;
    z-index: 100;
    box-shadow: 0 -2px 8px rgba(0,0,0,.04);
}
.demo-row {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 6px;
}
.demo-row:last-child { margin-bottom: 0; }
.demo-label {
    font-size: 11px;
    font-weight: 700;
    color: var(--text3);
    text-transform: uppercase;
    letter-spacing: .5px;
    white-space: nowrap;
    min-width: 64px;
}
.demo-btns { display: flex; gap: 6px; flex-wrap: wrap; }
.demo-btn {
    padding: 5px 12px;
    border-radius: 6px;
    font-size: 11px;
    font-weight: 600;
    cursor: pointer;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--text2);
    font-family: inherit;
    transition: all .15s;
    white-space: nowrap;
}
.demo-btn:hover { border-color: var(--accent); color: var(--accent); }
.demo-btn.on {
    background: var(--accent);
    color: #fff;
    border-color: var(--accent);
}
.demo-desc {
    font-size: 11px;
    color: var(--text3);
    line-height: 1.4;
    margin-left: 8px;
}
</style>
</head>
<body>

<!-- ===== Top bar ===== -->
<div class="topbar">
    <a class="topbar-logo" href="#">
        <div class="mark" id="logoMark"></div>
        <span class="brand" id="logoBrand"></span>
    </a>
    <div class="topbar-right">
        å·²æœ‰è´¦æˆ·ï¼Ÿ
        <a href="#" onclick="return false;">ç™»å½•</a>
    </div>
</div>

<!-- ===== Main ===== -->
<div class="main">
    <div class="container">

        <!-- ==================== 1. æ³¨å†Œé¦–é¡µï¼ˆå«å†…è”éªŒè¯ï¼‰ ==================== -->
        <div class="v on" id="v-start">
            <div class="card">
                <h1 id="startTitle">æ³¨å†Œ</h1>
                <div class="desc" id="startDesc"></div>

                <div class="err-msg" id="errDup">
                    <span class="err-icon">âš </span>
                    <span id="errDupText">è¯¥é‚®ç®±å·²æ³¨å†Œï¼Œè¯·ç›´æ¥ç™»å½•</span>
                </div>

                <!-- Phase 1: è¾“å…¥é‚®ç®±/æ‰‹æœºå· -->
                <div id="phase-input">
                    <div class="tabs">
                        <button class="tab on" onclick="sw(this,'email')">é‚®ç®±</button>
                        <button class="tab" onclick="sw(this,'phone')">æ‰‹æœºå·</button>
                    </div>

                    <div id="f-email">
                        <div class="field">
                            <label class="field-label">é‚®ç®±åœ°å€</label>
                            <input class="field-input" type="email" placeholder="name@company.com" id="inEmail">
                        </div>
                    </div>
                    <div id="f-phone" style="display:none">
                        <div class="field">
                            <label class="field-label">æ‰‹æœºå·</label>
                            <div class="phone-row">
                                <select id="ccSel"><option>+86</option><option>+852</option><option>+1</option><option>+44</option><option>+81</option><option>+65</option></select>
                                <input class="field-input" type="tel" placeholder="è¾“å…¥æ‰‹æœºå·" id="inPhone">
                            </div>
                        </div>
                    </div>

                    <div class="agree">
                        <input type="checkbox" id="ck" checked>
                        <label for="ck">æˆ‘å·²é˜…è¯»å¹¶åŒæ„ <a href="#">ã€Šä¼šå‘˜æœåŠ¡åè®®ã€‹</a>ã€<a href="#">ã€Šæ”¯ä»˜æœåŠ¡åè®®ã€‹</a> å’Œ <a href="#">ã€Šæˆæƒåè®®ã€‹</a></label>
                    </div>

                    <button class="btn btn-primary" onclick="goNext()">ç»§ç»­</button>
                </div>

                <!-- Phase 2: å†…è”éªŒè¯ç ï¼ˆåŒä¸€å¡ç‰‡å†…ï¼‰ -->
                <div id="phase-verify" style="display:none">
                    <div class="err-msg" id="errCodeInline">
                        <span class="err-icon">âš </span>
                        <span>éªŒè¯ç é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥</span>
                    </div>

                    <div class="otp-row" id="otpInline"></div>
                    <div class="resend-row">
                        <span>æœ‰æ•ˆæœŸ 10 åˆ†é’Ÿ</span>
                        <button id="rsInline" onclick="cd(this)">é‡æ–°å‘é€</button>
                    </div>

                    <div class="action-row">
                        <button class="btn btn-outline" onclick="backToInput()">è¿”å›</button>
                        <button class="btn btn-primary" id="verifyBtn" onclick="verifyAndContinue()">éªŒè¯å¹¶ç»§ç»­</button>
                    </div>
                </div>

                <!-- Phase 3-A: è®¾ç½®å¯†ç ï¼ˆå¯†ç æ³¨å†Œï¼ŒåŒä¸€å¡ç‰‡å†…ï¼‰ -->
                <div id="phase-pwd" style="display:none">
                    <div class="field">
                        <label class="field-label">å¯†ç </label>
                        <input class="field-input" type="password" placeholder="è‡³å°‘ 8 ä½ï¼Œå«å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦" id="inPwd" oninput="meter(this.value)">
                        <div class="pwd-rules">
                            <div class="pwd-rule" id="r-len"><span class="rule-icon">âœ“</span>è‡³å°‘ 8 ä½å­—ç¬¦</div>
                            <div class="pwd-rule" id="r-letter"><span class="rule-icon">âœ“</span>åŒ…å«å­—æ¯ (a-z)</div>
                            <div class="pwd-rule" id="r-digit"><span class="rule-icon">âœ“</span>åŒ…å«æ•°å­— (0-9)</div>
                            <div class="pwd-rule" id="r-special"><span class="rule-icon">âœ“</span>åŒ…å«ç‰¹æ®Šå­—ç¬¦ (!@#$%...)</div>
                        </div>
                    </div>
                    <div class="field">
                        <label class="field-label">ç¡®è®¤å¯†ç </label>
                        <input class="field-input" type="password" placeholder="å†æ¬¡è¾“å…¥å¯†ç " id="inPwd2">
                    </div>

                    <div class="action-row">
                        <button class="btn btn-outline" onclick="backToInput()">è¿”å›</button>
                        <button class="btn btn-primary" onclick="pwdSubmit()">æ³¨å†Œ</button>
                    </div>
                </div>

                <!-- Phase 3-B: ç»‘å®šåŠ¨æ€ä»¤ç‰Œï¼ˆOTP æ³¨å†Œï¼ŒåŒä¸€å¡ç‰‡å†…ï¼‰ -->
                <div id="phase-otp" style="display:none">
                    <div class="qr-area">
                        <div class="qr-box">
                            <div class="qr-icon">ğŸ“±</div>
                            <span>æ‰«æç»‘å®š</span>
                        </div>
                        <div class="secret-row">
                            æ— æ³•æ‰«ç ï¼Ÿæ‰‹åŠ¨è¾“å…¥å¯†é’¥<br>
                            <code>JBSW Y3DP EHPK 3PXP</code>
                        </div>
                    </div>

                    <div class="field">
                        <label class="field-label">éªŒè¯ç </label>
                        <input class="field-input" type="text" placeholder="è¾“å…¥ Authenticator ä¸Šçš„ 6 ä½åŠ¨æ€ç " id="inTotp" maxlength="6" style="text-align:center;letter-spacing:6px;font-size:18px;font-weight:700">
                    </div>

                    <div class="action-row">
                        <button class="btn btn-outline" onclick="backToInput()">è¿”å›</button>
                        <button class="btn btn-primary" onclick="finish()">éªŒè¯å¹¶æ³¨å†Œ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ==================== 2. æ³¨å†ŒæˆåŠŸ ==================== -->
        <div class="v" id="v-done">
            <div class="card">
                <div class="success-icon">âœ“</div>
                <div class="success-body">
                    <h2>æ³¨å†ŒæˆåŠŸ</h2>
                    <p>è´¦æˆ·å·²åˆ›å»ºï¼Œç™»å½•åå³å¯å¼€é€šäº§å“</p>
                    <div class="countdown"><b id="sec">5</b> ç§’åè‡ªåŠ¨è·³è½¬</div>
                </div>
                <div style="margin-top:28px">
                    <button class="btn btn-primary" onclick="goLogin()">å‰å¾€ç™»å½•</button>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- ===== Footer ===== -->
<div class="page-footer">
    <span id="footerBrand">&copy; 2026</span>
    <a href="#">éšç§æ”¿ç­–</a>
    <a href="#">æœåŠ¡æ¡æ¬¾</a>
    <a href="#">å¸®åŠ©ä¸­å¿ƒ</a>
</div>

<!-- ===== Demo bar (prototype only) ===== -->
<div class="demo-bar">
    <div class="demo-row">
        <span class="demo-label">åœ°åŒºæ¨¡æ‹Ÿ</span>
        <div class="demo-btns">
            <button class="demo-btn" onclick="demoRegion('CN',this)">ğŸ‡¨ğŸ‡³ ä¸­å›½å¤§é™†</button>
            <button class="demo-btn" onclick="demoRegion('HK',this)">ğŸ‡­ğŸ‡° é¦™æ¸¯</button>
            <button class="demo-btn" onclick="demoRegion('US',this)">ğŸŒ æµ·å¤–</button>
        </div>
        <span class="demo-desc" id="demoRegionDesc">å½“å‰ï¼šè‡ªåŠ¨æ£€æµ‹</span>
    </div>
    <div class="demo-row">
        <span class="demo-label">æ³¨å†Œæ–¹å¼</span>
        <div class="demo-btns">
            <button class="demo-btn on" id="dmPwd" onclick="demoMethod('pwd',this)">å¯†ç æ³¨å†Œ</button>
            <button class="demo-btn" id="dmOtp" onclick="demoMethod('otp',this)">OTP åŠ¨æ€ä»¤ç‰Œ</button>
            <button class="demo-btn" id="dmCode" onclick="demoMethod('code',this)">éªŒè¯ç æ³¨å†Œ</button>
        </div>
        <span class="demo-desc" id="demoMethodDesc">æ‰‹æœºå·â†’å¯†ç æ³¨å†Œï¼ˆCN/HKé»˜è®¤ï¼‰</span>
    </div>
    <div class="demo-row">
        <span class="demo-label">å¼‚å¸¸åœºæ™¯</span>
        <div class="demo-btns">
            <button class="demo-btn on" onclick="demoEdge('none',this)">æ­£å¸¸æµç¨‹</button>
            <button class="demo-btn" onclick="demoEdge('dup',this)">é‚®ç®±/æ‰‹æœºå·²æ³¨å†Œ</button>
            <button class="demo-btn" onclick="demoEdge('code_err',this)">éªŒè¯ç é”™è¯¯</button>
            <button class="demo-btn" onclick="demoEdge('pwd_weak',this)">å¯†ç å¼ºåº¦ä¸è¶³</button>
        </div>
    </div>
</div>

<script>
/* ===== State ===== */
let ct = 'email', rm = 'otp';
let edgeCase = 'none'; // none | dup | code_err | pwd_weak

/* ===== IP-based region detection â†’ auto-select tab & method ===== */
(function initRegion() {
    const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || '';
    let region = 'other';
    if (tz.startsWith('Asia/Shanghai') || tz.startsWith('Asia/Chongqing') || tz.startsWith('Asia/Urumqi')) region = 'CN';
    else if (tz.startsWith('Asia/Hong_Kong')) region = 'HK';

    if (region === 'CN' || region === 'HK') {
        ct = 'phone'; rm = 'pwd';
    } else {
        ct = 'email'; rm = 'otp';
    }

    setTimeout(() => {
        applyTabAndMethod(region);
        syncDemoBar();
    }, 0);
})();

function applyTabAndMethod(region) {
    const tabs = document.querySelectorAll('.tab');
    tabs.forEach(t => t.classList.remove('on'));
    if (ct === 'phone') {
        tabs[1].classList.add('on');
        document.getElementById('f-email').style.display = 'none';
        document.getElementById('f-phone').style.display = '';
    } else {
        tabs[0].classList.add('on');
        document.getElementById('f-email').style.display = '';
        document.getElementById('f-phone').style.display = 'none';
    }
    if (region === 'CN') document.getElementById('ccSel').value = '+86';
    else if (region === 'HK') document.getElementById('ccSel').value = '+852';
}

/* ===== Navigation ===== */
function go(id) {
    document.querySelectorAll('.v').forEach(v => v.classList.remove('on'));
    document.getElementById(id).classList.add('on');
    clearAllErrors();
}

function sw(el, m) {
    ct = m;
    el.parentElement.querySelectorAll('.tab').forEach(b => b.classList.remove('on'));
    el.classList.add('on');
    document.getElementById('f-email').style.display = m === 'email' ? '' : 'none';
    document.getElementById('f-phone').style.display = m === 'phone' ? '' : 'none';
    rm = (m === 'phone') ? 'pwd' : 'otp';
    syncDemoBar();
}

function val() {
    return ct === 'email'
        ? (document.getElementById('inEmail').value || 'name@company.com')
        : (document.getElementById('inPhone').value || 'æ‰‹æœºå·');
}

/* ===== OTP input builder ===== */
function buildOtp(id) {
    const w = document.getElementById(id);
    if (w.children.length) return;
    for (let i = 0; i < 6; i++) {
        const inp = document.createElement('input');
        inp.maxLength = 1; inp.type = 'text';
        inp.oninput = function() { if (this.value && i < 5) w.children[i + 1].focus(); };
        inp.onkeydown = function(e) { if (e.key === 'Backspace' && !this.value && i > 0) w.children[i - 1].focus(); };
        w.appendChild(inp);
    }
    setTimeout(() => w.children[0].focus(), 100);
}

/* ===== Phase switching (inline on v-start) ===== */
function showVerifyPhase() {
    const c = val();
    hideAllPhases();
    document.getElementById('phase-verify').style.display = '';

    // Update title and description based on method
    document.getElementById('startTitle').textContent = 'éªŒè¯æ‚¨çš„è´¦æˆ·';
    document.getElementById('startDesc').innerHTML = '6 ä½éªŒè¯ç å·²å‘é€è‡³ <b>' + c + '</b>';

    // Update button text based on method
    const btn = document.getElementById('verifyBtn');
    if (rm === 'code') {
        btn.textContent = 'éªŒè¯å¹¶æ³¨å†Œ';
    } else {
        btn.textContent = 'éªŒè¯å¹¶ç»§ç»­';
    }

    buildOtp('otpInline');
    cd(document.getElementById('rsInline'));
}

function hideAllPhases() {
    ['phase-input', 'phase-verify', 'phase-pwd', 'phase-otp'].forEach(id => {
        document.getElementById(id).style.display = 'none';
    });
}

function backToInput() {
    hideAllPhases();
    document.getElementById('phase-input').style.display = '';
    document.getElementById('startTitle').textContent = 'æ³¨å†Œ';
    document.getElementById('startDesc').innerHTML = '';
    clearAllErrors();
}

/* ===== Main flow ===== */
function goNext() {
    clearAllErrors();

    // Edge case: duplicate account
    if (edgeCase === 'dup') {
        const errEl = document.getElementById('errDup');
        const errText = document.getElementById('errDupText');
        errText.textContent = ct === 'email'
            ? 'è¯¥é‚®ç®±å·²æ³¨å†Œï¼Œè¯·ç›´æ¥ç™»å½•'
            : 'è¯¥æ‰‹æœºå·å·²æ³¨å†Œï¼Œè¯·ç›´æ¥ç™»å½•';
        errEl.classList.add('show');
        return;
    }

    // All methods: step 1 = input + inline verification on same card
    showVerifyPhase();
}

/* ===== After inline verification ===== */
function verifyAndContinue() {
    // Edge case: verification code error
    if (edgeCase === 'code_err') {
        document.getElementById('errCodeInline').classList.add('show');
        return;
    }

    if (rm === 'code') {
        // éªŒè¯ç æ³¨å†Œ: verify â†’ done
        finish();
    } else if (rm === 'pwd') {
        // å¯†ç æ³¨å†Œ: verify â†’ set password (step 2)
        hideAllPhases();
        document.getElementById('phase-pwd').style.display = '';
        document.getElementById('startTitle').textContent = 'è®¾ç½®å¯†ç ';
        document.getElementById('startDesc').innerHTML = 'ä¸º <b>' + val() + '</b> è®¾ç½®ç™»å½•å¯†ç ';
        if (edgeCase === 'pwd_weak') {
            setTimeout(() => {
                document.getElementById('inPwd').value = '123';
                meter('123');
            }, 200);
        }
    } else if (rm === 'otp') {
        // OTPæ³¨å†Œ: verify â†’ bind authenticator (step 2)
        hideAllPhases();
        document.getElementById('phase-otp').style.display = '';
        document.getElementById('startTitle').textContent = 'ç»‘å®šåŠ¨æ€ä»¤ç‰Œ';
        document.getElementById('startDesc').textContent = 'ä½¿ç”¨ Google Authenticator æˆ–å…¶ä»– TOTP åº”ç”¨æ‰«æä¸‹æ–¹äºŒç»´ç ';
    }
}

function pwdSubmit() {
    const p = document.getElementById('inPwd').value || '';
    meter(p);
    // Check all 4 rules pass
    const allPass = p.length >= 8 && /[a-zA-Z]/.test(p) && /\d/.test(p) && /[^a-zA-Z0-9]/.test(p);
    if (!allPass) return;
    // Password set â†’ finish
    finish();
}

function cd(btn) {
    btn.disabled = true; let s = 60; btn.textContent = s + 's';
    const t = setInterval(() => {
        if (--s <= 0) { clearInterval(t); btn.disabled = false; btn.textContent = 'é‡æ–°å‘é€'; }
        else btn.textContent = s + 's';
    }, 1000);
}

function finish() {
    go('v-done');
    let s = 5; const el = document.getElementById('sec');
    const t = setInterval(() => {
        if (--s <= 0) { clearInterval(t); goLogin(); }
        else el.textContent = s;
    }, 1000);
}

function goLogin() { alert('è·³è½¬åˆ°ç™»å½•é¡µâ€¦'); }

/* ===== Password rules checker ===== */
function meter(p) {
    const rules = [
        { id: 'r-len',     test: p => p.length >= 8 },
        { id: 'r-letter',  test: p => /[a-zA-Z]/.test(p) },
        { id: 'r-digit',   test: p => /\d/.test(p) },
        { id: 'r-special', test: p => /[^a-zA-Z0-9]/.test(p) }
    ];
    rules.forEach(r => {
        const el = document.getElementById(r.id);
        if (!el) return;
        if (p && r.test(p)) {
            el.classList.add('pass');
        } else {
            el.classList.remove('pass');
        }
    });
}

/* ===== Error helpers ===== */
function clearAllErrors() {
    document.querySelectorAll('.err-msg').forEach(e => e.classList.remove('show'));
}

/* ===== Demo bar: Region ===== */
function demoRegion(region, btn) {
    btn.parentElement.querySelectorAll('.demo-btn').forEach(b => b.classList.remove('on'));
    btn.classList.add('on');

    if (region === 'CN') {
        ct = 'phone'; rm = 'pwd';
        document.getElementById('demoRegionDesc').textContent = 'ä¸­å›½å¤§é™† â†’ æ‰‹æœºå· + å¯†ç æ³¨å†Œ';
    } else if (region === 'HK') {
        ct = 'phone'; rm = 'pwd';
        document.getElementById('demoRegionDesc').textContent = 'é¦™æ¸¯ â†’ æ‰‹æœºå· + å¯†ç æ³¨å†Œ';
    } else {
        ct = 'email'; rm = 'otp';
        document.getElementById('demoRegionDesc').textContent = 'æµ·å¤– â†’ é‚®ç®± + OTP åŠ¨æ€ä»¤ç‰Œæ³¨å†Œ';
    }

    applyTabAndMethod(region);
    syncDemoBar();
    backToInput();
}

/* ===== Demo bar: Method ===== */
function demoMethod(method, btn) {
    btn.parentElement.querySelectorAll('.demo-btn').forEach(b => b.classList.remove('on'));
    btn.classList.add('on');
    rm = method;

    const descs = {
        pwd: 'Step1 è¾“å…¥+éªŒè¯ â†’ Step2 è®¾ç½®å¯†ç  â†’ å®Œæˆï¼ˆ2æ­¥ï¼‰',
        otp: 'Step1 è¾“å…¥+éªŒè¯ â†’ Step2 ç»‘å®š Authenticator â†’ å®Œæˆï¼ˆ2æ­¥ï¼‰',
        code: 'Step1 è¾“å…¥+éªŒè¯ â†’ ç›´æ¥å®Œæˆï¼ˆ1æ­¥ï¼‰'
    };
    document.getElementById('demoMethodDesc').textContent = descs[method];
    backToInput();
}

/* ===== Demo bar: Edge cases ===== */
function demoEdge(edge, btn) {
    btn.parentElement.querySelectorAll('.demo-btn').forEach(b => b.classList.remove('on'));
    btn.classList.add('on');
    edgeCase = edge;
    clearAllErrors();
    backToInput();
}

/* ===== Sync demo bar buttons with current state ===== */
function syncDemoBar() {
    document.getElementById('dmPwd').classList.toggle('on', rm === 'pwd');
    document.getElementById('dmOtp').classList.toggle('on', rm === 'otp');
    document.getElementById('dmCode').classList.toggle('on', rm === 'code');

    const descs = {
        pwd: 'Step1 è¾“å…¥+éªŒè¯ â†’ Step2 è®¾ç½®å¯†ç  â†’ å®Œæˆï¼ˆ2æ­¥ï¼‰',
        otp: 'Step1 è¾“å…¥+éªŒè¯ â†’ Step2 ç»‘å®š Authenticator â†’ å®Œæˆï¼ˆ2æ­¥ï¼‰',
        code: 'Step1 è¾“å…¥+éªŒè¯ â†’ ç›´æ¥å®Œæˆï¼ˆ1æ­¥ï¼‰'
    };
    document.getElementById('demoMethodDesc').textContent = descs[rm];
}
</script>
</body>
</html>
