<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>TP Portal v3</title>
  <style>
    :root {
      --bg: #f6f8fc;
      --surface: #ffffff;
      --surface-2: #f8fafc;
      --line: #e2e8f0;
      --text: #0f172a;
      --text-2: #475569;
      --text-3: #64748b;
      --brand: #0b5fff;
      --brand-soft: #e8f0ff;
      --ok: #0f9d58;
      --warn: #b45309;
      --danger: #b91c1c;
      --radius: 14px;
      --shadow: 0 10px 30px rgba(15, 23, 42, 0.08);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: "SF Pro Text", "Google Sans", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at 10% -20%, #dbeafe 0, transparent 40%), var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    .app {
      min-height: 100vh;
      display: grid;
      grid-template-columns: 64px 280px 1fr;
      grid-template-rows: 72px 1fr;
      grid-template-areas:
        "top top top"
        "rail panel content";
      transition: grid-template-columns 0.2s ease;
    }

    .app.panel-collapsed {
      grid-template-columns: 64px 0 1fr;
    }

    .topbar {
      grid-area: top;
      position: sticky;
      top: 0;
      z-index: 20;
      height: 72px;
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 16px;
      gap: 10px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      min-width: 240px;
    }

    .logo {
      width: 34px;
      height: 34px;
      border-radius: 10px;
      background: linear-gradient(145deg, #1a73e8, #0b5fff);
      box-shadow: 0 6px 16px rgba(11, 95, 255, 0.35);
    }

    .brand h1 { font-size: 17px; font-weight: 650; }
    .chip {
      font-size: 11px;
      color: #0b4bb3;
      background: #dbeafe;
      border-radius: 999px;
      padding: 4px 8px;
      font-weight: 600;
    }

    .primary-tabs {
      display: flex;
      align-items: center;
      gap: 6px;
      flex: 1;
      min-width: 0;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .primary-tabs::-webkit-scrollbar { display: none; }

    .tab {
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-2);
      font-size: 13px;
      font-weight: 560;
      padding: 8px 10px;
      border-radius: 9px;
      white-space: nowrap;
      cursor: pointer;
    }

    .tab:hover { background: var(--surface-2); }
    .tab.active {
      background: var(--brand-soft);
      color: #0b4bb3;
      border-color: #cfe0ff;
    }

    .actions {
      display: flex;
      align-items: center;
      gap: 8px;
      min-width: 330px;
      justify-content: flex-end;
    }

    .btn {
      border: 1px solid var(--line);
      background: var(--surface);
      color: var(--text-2);
      border-radius: 10px;
      padding: 8px 11px;
      font-size: 13px;
      cursor: pointer;
    }

    .mode-switch {
      display: flex;
      gap: 6px;
      padding: 4px;
      border: 1px solid var(--line);
      background: var(--surface-2);
      border-radius: 10px;
    }

    .mode-switch button {
      border: 0;
      background: transparent;
      color: var(--text-3);
      border-radius: 8px;
      padding: 5px 9px;
      font-size: 12px;
      cursor: pointer;
    }

    .mode-switch button.active {
      background: var(--surface);
      color: var(--text);
      box-shadow: 0 1px 2px rgba(15, 23, 42, 0.12);
    }

    .rail {
      grid-area: rail;
      border-right: 1px solid var(--line);
      background: #fbfcff;
      padding: 10px 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
    }

    .icon-btn {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-2);
      cursor: pointer;
      display: grid;
      place-items: center;
      font-size: 18px;
    }

    .icon-btn:hover { background: var(--surface-2); }
    .icon-btn.active {
      background: var(--brand-soft);
      color: #0b4bb3;
      border-color: #cfe0ff;
    }

    .panel {
      grid-area: panel;
      border-right: 1px solid var(--line);
      background: var(--surface);
      padding: 16px;
      overflow: auto;
    }

    .panel.hidden { display: none; }

    .panel-title { font-size: 18px; font-weight: 650; }
    .panel-sub { font-size: 12px; color: var(--text-3); margin-top: 4px; margin-bottom: 14px; }

    .group { margin-bottom: 14px; }
    .group h4 {
      font-size: 11px;
      color: var(--text-3);
      text-transform: uppercase;
      letter-spacing: .08em;
      margin-bottom: 6px;
    }

    .leaf {
      width: 100%;
      text-align: left;
      border: 1px solid transparent;
      background: transparent;
      color: var(--text-2);
      border-radius: 9px;
      padding: 9px 10px;
      font-size: 13px;
      margin-bottom: 4px;
      cursor: pointer;
    }

    .leaf:hover { background: var(--surface-2); }

    .content {
      grid-area: content;
      padding: 20px;
      overflow: auto;
    }

    .header {
      border: 1px solid #dce8ff;
      background: linear-gradient(155deg, #ffffff, #f8fbff);
      border-radius: 18px;
      padding: 16px;
      box-shadow: var(--shadow);
      margin-bottom: 12px;
    }

    .crumb { font-size: 12px; color: var(--text-3); margin-bottom: 8px; }
    .head-row { display: flex; justify-content: space-between; gap: 10px; align-items: end; }
    .head-row h2 { font-size: 26px; line-height: 1.1; }
    .head-row p { font-size: 13px; color: var(--text-2); margin-top: 4px; }

    .kpis {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
      margin-bottom: 12px;
    }

    .kpi {
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: var(--surface);
      padding: 12px;
    }

    .kpi .k { font-size: 12px; color: var(--text-3); }
    .kpi .v { font-size: 24px; font-weight: 680; margin-top: 4px; }
    .kpi .d { font-size: 12px; margin-top: 2px; }
    .up { color: var(--ok); }
    .down { color: var(--danger); }

    .split {
      display: grid;
      grid-template-columns: 1.25fr 1fr;
      gap: 12px;
    }

    .card {
      border: 1px solid var(--line);
      border-radius: var(--radius);
      background: var(--surface);
      padding: 14px;
    }

    .card h3 { font-size: 15px; margin-bottom: 8px; }

    .task {
      border: 1px solid var(--line);
      border-radius: 10px;
      padding: 10px;
      display: flex;
      justify-content: space-between;
      font-size: 13px;
      margin-bottom: 8px;
    }

    .pill { font-size: 11px; border-radius: 999px; padding: 4px 8px; }
    .pill.warn { background: #fff7ed; color: var(--warn); }
    .pill.danger { background: #fef2f2; color: var(--danger); }

    .table-wrap { margin-top: 10px; overflow: auto; border: 1px solid var(--line); border-radius: 12px; }
    table { width: 100%; border-collapse: collapse; background: var(--surface); }
    th, td { padding: 12px 10px; border-bottom: 1px solid var(--line); text-align: left; font-size: 13px; }
    th { font-size: 12px; color: var(--text-3); background: #f8fafc; }

    .focus-mode .app {
      grid-template-columns: 64px 0 1fr;
    }

    .focus-mode .panel { display: none; }

    .cmdk {
      position: fixed;
      inset: 0;
      z-index: 40;
      background: rgba(15, 23, 42, 0.45);
      display: none;
      align-items: flex-start;
      justify-content: center;
      padding-top: 10vh;
    }

    .cmdk.show { display: flex; }

    .cmdk-box {
      width: min(760px, 92vw);
      border: 1px solid var(--line);
      border-radius: 14px;
      background: var(--surface);
      box-shadow: 0 26px 60px rgba(15, 23, 42, 0.26);
      overflow: hidden;
    }

    .cmdk-box input {
      width: 100%; border: 0; border-bottom: 1px solid var(--line);
      padding: 14px 16px; font-size: 14px; outline: none;
    }

    .cmd-item { padding: 10px 12px; display: flex; justify-content: space-between; font-size: 13px; }
    .cmd-item:hover { background: var(--surface-2); }

    @media (max-width: 1200px) {
      .actions { min-width: auto; }
      .kpis { grid-template-columns: repeat(2, minmax(0, 1fr)); }
      .split { grid-template-columns: 1fr; }
    }

    @media (max-width: 900px) {
      .app { grid-template-columns: 64px 1fr; grid-template-areas: "top top" "rail content"; }
      .panel { display: none; }
      .primary-tabs { display: none; }
      .mode-switch { display: none; }
      .head-row h2 { font-size: 22px; }
    }

    @media (max-width: 640px) {
      .kpis { grid-template-columns: 1fr; }
      .actions .btn:nth-child(3) { display: none; }
    }
  </style>
</head>
<body>
  <div class="app" id="app">
    <header class="topbar">
      <div class="brand">
        <div class="logo"></div>
        <h1>EX TP Portal</h1>
        <span class="chip">Institution</span>
      </div>

      <nav class="primary-tabs" id="primaryTabs"></nav>

      <div class="actions">
        <button class="btn" id="openCmd">Search / Command ⌘K</button>
        <div class="mode-switch" id="modeSwitch">
          <button data-mode="web2" class="active">Web2</button>
          <button data-mode="web3">Web3</button>
          <button data-mode="hybrid">Hybrid</button>
        </div>
        <button class="btn" id="focusToggle">Focus</button>
      </div>
    </header>

    <aside class="rail" id="rail">
      <button class="icon-btn" id="panelToggle" title="Toggle panel">≡</button>
      <button class="icon-btn active" title="Overview">⌂</button>
      <button class="icon-btn" title="Tasks">✓</button>
      <button class="icon-btn" title="Alerts">⚑</button>
      <button class="icon-btn" title="Exports">↓</button>
    </aside>

    <aside class="panel" id="panel">
      <div class="panel-title" id="panelTitle">Overview</div>
      <div class="panel-sub">Core IA + dynamic capability packs</div>
      <div id="panelMenu"></div>
    </aside>

    <main class="content">
      <section class="header">
        <div class="crumb" id="crumb">Overview / Executive Summary</div>
        <div class="head-row">
          <div>
            <h2 id="pageTitle">Executive Summary</h2>
            <p id="pageDesc">Institution-level visibility across transactions, treasury, and compliance.</p>
          </div>
          <button class="btn">Export Snapshot</button>
        </div>
      </section>

      <section class="kpis" id="kpis"></section>

      <section class="split">
        <article class="card">
          <h3>Priority Queue</h3>
          <div class="task"><span>Settlement batch #SB-10291 awaiting release</span><span class="pill warn">T+0</span></div>
          <div class="task"><span>High-risk payout flagged (rule KYT-17)</span><span class="pill danger">Risk</span></div>
          <div class="task"><span>Fee template update pending approval</span><span class="pill warn">Approval</span></div>

          <div class="table-wrap">
            <table>
              <thead>
                <tr><th>Batch ID</th><th>Rail</th><th>Status</th><th>Amount</th><th>Action</th></tr>
              </thead>
              <tbody>
                <tr><td>SB-10291</td><td>Bank</td><td>Pending Release</td><td>$1,240,550</td><td><a href="#">Review</a></td></tr>
                <tr><td>SB-10285</td><td>Chain</td><td>Reconciliation</td><td>$382,700</td><td><a href="#">Inspect</a></td></tr>
                <tr><td>SB-10277</td><td>Hybrid</td><td>Exception</td><td>$93,200</td><td><a href="#">Resolve</a></td></tr>
              </tbody>
            </table>
          </div>
        </article>

        <article class="card">
          <h3>Design Notes</h3>
          <p style="color:var(--text-3);font-size:13px;line-height:1.6;">
            This version prioritizes content space by moving primary IA to top tabs, reducing left navigation to a compact rail, and making secondary navigation collapsible.
            Web2/Web3/Hybrid differences are injected as capability packs, not separate systems.
          </p>
        </article>
      </section>
    </main>
  </div>

  <div class="cmdk" id="cmdk">
    <div class="cmdk-box">
      <input placeholder="Type a page, action, MID, order, or batch ID..." />
      <div class="cmd-item"><span>Go to Treasury / Settlement Batches</span><span>Page</span></div>
      <div class="cmd-item"><span>Create payout order</span><span>Action</span></div>
      <div class="cmd-item"><span>Open Download Center</span><span>Page</span></div>
      <div class="cmd-item"><span>Search MID: CLT20250001</span><span>Lookup</span></div>
    </div>
  </div>

  <script>
    const PRIMARY = [
      ['overview', 'Overview'],
      ['customers', 'Customers'],
      ['transactions', 'Transactions'],
      ['treasury', 'Treasury & Settlement'],
      ['risk', 'Risk & Compliance'],
      ['reports', 'Reports'],
      ['settings', 'Settings']
    ];

    const BASE_MENU = {
      overview: [{ title: 'Summary', items: ['Executive Summary', 'Alerts', 'SLA Health'] }],
      customers: [{ title: 'Customer Ops', items: ['Customer Profiles', 'Product Enablement', 'Rate Plans'] }],
      transactions: [{ title: 'Processing', items: ['Payins', 'Payouts', 'Exceptions'] }],
      treasury: [{ title: 'Financial Operations', items: ['Accounts', 'Balances', 'Settlement Batches', 'Reconciliation'] }],
      risk: [{ title: 'Controls', items: ['Rules', 'Screening', 'Case Management'] }],
      reports: [{ title: 'Insights', items: ['Analytics', 'Download Center', 'Scheduled Exports'] }],
      settings: [{ title: 'Administration', items: ['Users & Roles', 'Approval Policy', 'API Credentials'] }]
    };

    const PACK = {
      web2: {
        transactions: ['Card Acquiring', 'Chargebacks'],
        treasury: ['Bank Settlement', 'Fee Invoicing']
      },
      web3: {
        transactions: ['On-chain Transfers', 'Address Screening'],
        treasury: ['Wallet Treasury', 'Gas & Network Fees']
      },
      hybrid: {
        transactions: ['On/Off Ramp Orders', 'Cross-rail Routing'],
        treasury: ['Liquidity Bridge', 'Cross-rail Reconciliation']
      }
    };

    const KPI = {
      web2: [
        ['Daily Processing Volume', '$182.4M', '+6.3% WoW', 'up'],
        ['Success Rate', '99.12%', '+0.21%', 'up'],
        ['Pending Settlement', '$12.7M', '-3.4%', 'up'],
        ['Chargeback Ratio', '0.42%', '-0.08%', 'up']
      ],
      web3: [
        ['Daily Processing Volume', '$74.8M', '+4.8% WoW', 'up'],
        ['On-chain Success', '98.43%', '+0.31%', 'up'],
        ['Wallet Liquidity Buffer', '$18.2M', '+1.2%', 'up'],
        ['KYT Alerts', '37', '+9', 'down']
      ],
      hybrid: [
        ['Daily Processing Volume', '$231.6M', '+8.1% WoW', 'up'],
        ['Cross-rail Conversion', '96.74%', '+0.44%', 'up'],
        ['Pending Settlement', '$19.1M', '-2.8%', 'up'],
        ['Exception Queue', '21', '-5', 'up']
      ]
    };

    let mode = 'web2';
    let primary = 'overview';

    const tabs = document.getElementById('primaryTabs');
    const menu = document.getElementById('panelMenu');
    const panelTitle = document.getElementById('panelTitle');

    function buildTabs() {
      tabs.innerHTML = PRIMARY.map(([k, l]) =>
        `<button class="tab ${k === primary ? 'active' : ''}" data-key="${k}">${l}</button>`
      ).join('');
    }

    function getMenu(key) {
      const groups = JSON.parse(JSON.stringify(BASE_MENU[key] || []));
      const extra = PACK[mode][key];
      if (extra && groups[0]) groups.push({ title: mode.toUpperCase() + ' Pack', items: extra });
      return groups;
    }

    function buildMenu() {
      const currentLabel = PRIMARY.find(([k]) => k === primary)[1];
      panelTitle.textContent = currentLabel;
      const groups = getMenu(primary);
      menu.innerHTML = groups.map(g =>
        `<div class="group"><h4>${g.title}</h4>${g.items.map(i => `<button class="leaf" data-item="${i}">${i}</button>`).join('')}</div>`
      ).join('');
    }

    function buildKpi() {
      document.getElementById('kpis').innerHTML = KPI[mode].map(([k, v, d, t]) =>
        `<div class="kpi"><div class="k">${k}</div><div class="v">${v}</div><div class="d ${t}">${d}</div></div>`
      ).join('');
    }

    function setHeader(item = 'Executive Summary') {
      const label = PRIMARY.find(([k]) => k === primary)[1];
      document.getElementById('crumb').textContent = `${label} / ${item}`;
      document.getElementById('pageTitle').textContent = item;
      document.getElementById('pageDesc').textContent = `Professional institutional workflow for ${label.toLowerCase()} in ${mode.toUpperCase()} mode.`;
    }

    tabs.addEventListener('click', (e) => {
      const t = e.target.closest('[data-key]');
      if (!t) return;
      primary = t.dataset.key;
      buildTabs();
      buildMenu();
      setHeader();
    });

    menu.addEventListener('click', (e) => {
      const item = e.target.closest('[data-item]');
      if (!item) return;
      setHeader(item.dataset.item);
    });

    document.getElementById('modeSwitch').addEventListener('click', (e) => {
      const b = e.target.closest('[data-mode]');
      if (!b) return;
      mode = b.dataset.mode;
      document.querySelectorAll('#modeSwitch button').forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      buildMenu();
      buildKpi();
      setHeader();
    });

    document.getElementById('panelToggle').addEventListener('click', () => {
      document.getElementById('app').classList.toggle('panel-collapsed');
    });

    document.getElementById('focusToggle').addEventListener('click', () => {
      document.body.classList.toggle('focus-mode');
    });

    const cmdk = document.getElementById('cmdk');
    document.getElementById('openCmd').addEventListener('click', () => cmdk.classList.add('show'));
    cmdk.addEventListener('click', (e) => { if (e.target === cmdk) cmdk.classList.remove('show'); });

    window.addEventListener('keydown', (e) => {
      if ((e.metaKey || e.ctrlKey) && e.key.toLowerCase() === 'k') {
        e.preventDefault();
        cmdk.classList.add('show');
      }
      if (e.key === 'Escape') cmdk.classList.remove('show');
      if (e.key === '[') document.getElementById('app').classList.add('panel-collapsed');
      if (e.key === ']') document.getElementById('app').classList.remove('panel-collapsed');
    });

    buildTabs();
    buildMenu();
    buildKpi();
    setHeader();
  </script>
</body>
</html>
